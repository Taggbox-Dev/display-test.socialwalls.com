"use strict";(self.webpackChunkembed_widget=self.webpackChunkembed_widget||[]).push([[411,9430],{56214:(e,t,a)=>{a.r(t),a.d(t,{default:()=>B});var n=a(9950),l=a(22332),i=a(80415),o=a(44414);function s(e){let{uploadFile:t}=e;return(0,o.jsxs)("div",{className:"pb_cards",children:[(0,o.jsx)("h2",{className:"subtext",children:"Lorem ipsum dolor sit amet"}),(0,o.jsxs)("div",{className:"pb_cards_box",children:[(0,o.jsxs)("div",{onClick:()=>t(3),className:"pb_card",children:[(0,o.jsx)("div",{className:"pb_card_icon",children:(0,o.jsx)("img",{src:`${i.th}/media/images/photobooth/camera.svg`,alt:"camera"})}),(0,o.jsx)("h3",{className:"pb_card-title",children:"Photo Booth"}),(0,o.jsxs)("p",{className:"pb_card-description",children:[" Click, Customize & Upload Fully Branded ",(0,o.jsx)("br",{})," Experience Instant Display"]})]}),(0,o.jsxs)("div",{onClick:()=>t(2),className:"pb_card",children:[(0,o.jsx)("div",{className:"pb_card_icon",children:(0,o.jsx)("img",{src:`${i.th}/media/images/photobooth/snapup.svg`,alt:"snapup"})}),(0,o.jsx)("h3",{className:"pb_card-title",children:"SnapUp"}),(0,o.jsxs)("p",{className:"pb_card-description",children:["Click or Upload No Social Media Required ",(0,o.jsx)("br",{})," Instant Display"]})]})]})]})}const r=e=>{let{className:t,children:a,icon:n,onClick:l}=e;return(0,o.jsxs)("button",{className:t,onClick:l,children:[n&&(0,o.jsx)("img",{src:`${i.th}/media/images/photobooth/${n}.svg`,alt:n}),a]})};var c=a(11766),d=a.n(c);const h=304,u=304,g=[{id:"background",label:"Background"},{id:"frame",label:"Frames"},{id:"sticker",label:"Stickers"},{id:"text",label:"Text"}],m=e=>{let{capturedImage:t,mode:a,counter:l,canvasRef:s,canvasCursor:r,webcamRef:c,onMouseDown:g,onMouseMove:m,onMouseUp:x,canvasElements:f,activeTextIndex:p,setCanvasElements:v,loading:b}=e;const w=e=>e?e.split("\n").length:1,y=e=>{const t=e.target.value;if((null===t||void 0===t?void 0:t.length)<=35){const e=(e=>{if(!s.current||!f[p])return e;const t=f[p],a=document.createElement("canvas").getContext("2d"),n=t.fontSize||16,l=t.fontFamily||"Arial";a.font=`${n}px ${l}`;const i=e.split(/\s+/);let o="",r="";for(let s=0;s<i.length;s++){const e=i[s],t=o?o+" "+e:e,{width:n}=a.measureText(t);n>280&&o?(r+=o+"\n",o=e):o=t}return o&&(r+=o),r})(t);v(t=>t.map((t,a)=>a===p?{...t,text:e}:t))}},k=(0,n.useCallback)(e=>{if(!e||!e.text)return 0;const t=document.createElement("canvas").getContext("2d"),a=e.fontSize||16,n=e.fontFamily||"Arial",l=e.scale||1;t.font=`${a}px ${n}`;const i=e.text.split("\n");let o=0;for(const s of i){const e=t.measureText(s).width;e>o&&(o=e)}return o*l},[f]);return(0,o.jsxs)("div",{className:"pb_user_photo "+(b?"active_blur":""),style:{position:"relative"},children:["capture"!==a||t?t?(0,o.jsx)("canvas",{ref:s,style:{cursor:r},width:h,height:u,onMouseDown:g,onMouseMove:m,onMouseUp:x,onMouseLeave:x}):(0,o.jsx)("img",{src:`${i.th}/media/images/photobooth/avatar.png`,alt:"default-avatar",width:h,height:u}):(0,o.jsx)(d(),{ref:c,screenshotFormat:"image/png",width:h,height:u,videoConstraints:{width:h,height:u,facingMode:"user"},style:{objectFit:"cover",borderRadius:"8px"}}),null===f||void 0===f?void 0:f.map((e,t)=>p===t&&(0,o.jsx)("textarea",{id:`text-${t}`,name:`text-${t}`,value:e.text,onChange:y,wrap:"hard",ref:e=>{e&&e.focus()},style:{position:"absolute",top:e.y-(e.fontSize*e.scale*w(e.text)+5)/2+"px",left:e.x-k(e)/2+"px",width:`${k(e)}px`,height:e.fontSize*e.scale*w(e.text)+6+"px",fontSize:e.fontSize*e.scale+"px",fontFamily:e.fontFamily||"Arial",transform:`rotate(${e.rotation||0}deg)`,textAlign:e.align||"center",transformOrigin:"center center",background:e.backgroundColor||"transparent",color:e.color||"#000",overflow:"hidden",border:"none",outline:"none",padding:0,maxWidth:"300px",wordBreak:"break-word",whiteSpace:"pre-wrap",overflowWrap:"break-word",resize:"vertical"}},t)),l?(0,o.jsxs)("div",{className:"pb_viewframe",children:[(0,o.jsx)("img",{src:`${i.th}/media/images/photobooth/viewframe-white@3x.svg`,alt:"viewframe"})," ",(0,o.jsx)("span",{children:l})]}):null]})},x=e=>{let{addSticker:t,loading:a,stickers:n,selectedStickers:l}=e;return(0,o.jsx)("div",{className:"pb_stickers",children:n.map((e,n)=>{const i=null===l||void 0===l?void 0:l.find(t=>(null===t||void 0===t?void 0:t.url)==e);return(0,o.jsx)("img",{onClick:a?null:()=>t(e),style:{cursor:a?"not-allowed":"pointer"},className:i?"active":"",src:e,alt:"sticker",width:64,height:64},n)})})},f=["font","align","color","bg"],p=["Arial","Helvetica","Times New Roman","Georgia","Courier New","Verdana","Tahoma","Trebuchet MS","Comic Sans MS","Impact","Lucida Console","Roboto","Open Sans"],v=["left","center","right"],b=["black","white","red","blue","green","yellow","orange","purple","pink","brown","gray","silver","gold"],w=["white","black","red","blue","green","yellow","orange","purple","pink","brown","gray","silver","gold"],y=e=>{let{canvasElements:t,setCanvasElements:a,activeTextIndex:n}=e;return(0,o.jsx)("div",{className:"pb_text",children:f.map(e=>(0,o.jsxs)("div",{className:"pb_text_box",children:[(0,o.jsx)("img",{src:`${i.th}/media/images/photobooth/text/${e}.png?v=1`,alt:e,onClick:()=>(e=>{if(null!==n){const u={};if("align"===e){var l,i;const e=null!==(l=null===(i=t[n])||void 0===i?void 0:i.align)&&void 0!==l?l:"center",a=v.find(t=>t===e);u.align=v[(v.indexOf(a)+1)%v.length]}else if("color"===e){var o,s;const e=null!==(o=null===(s=t[n])||void 0===s?void 0:s.color)&&void 0!==o?o:"black",a=b.find(t=>t===e);u.color=b[(b.indexOf(a)+1)%b.length]}else if("bg"===e){var r,c;const e=null!==(r=null===(c=t[n])||void 0===c?void 0:c.backgroundColor)&&void 0!==r?r:"transparent",a=w.find(t=>t===e);u.backgroundColor=w[(w.indexOf(a)+1)%w.length]}else if("font"===e){var d,h;const e=null!==(d=null===(h=t[n])||void 0===h?void 0:h.fontFamily)&&void 0!==d?d:"Arial",a=p.find(t=>t===e);u.fontFamily=p[(p.indexOf(a)+1)%p.length]}a(e=>e.map((e,t)=>t===n?{...e,...u}:e))}})(e)}),(0,o.jsx)("p",{children:e})]},e))})},k=e=>{let{loading:t,imgUrl:a,imgList:n,setImgUrl:l,tabKey:s}=e;return(0,o.jsx)("div",{className:`pb_${s}`,children:[`${i.th}/media/images/photobooth/${s}/none.png`,...n].map((e,n)=>{const i=a?a===e:0===n;return(0,o.jsx)("img",{style:{cursor:t?"not-allowed":"pointer"},src:e,alt:`img-${n}`,className:i?"active":"",width:64,height:64,onClick:t?null:()=>l(0==n?null:e)},n)})})};var S=a(52867);const M=e=>{let{capturedImage:t,uploadFile:a,canvasRef:l,canvasCursor:i,selectedBg:s,setSelectedBg:c,selectedFrame:d,setSelectedFrame:h,addSticker:u,addTextElement:f,onMouseDown:p,onMouseMove:v,onMouseUp:b,canvasElements:w,setCanvasElements:M,activeTextIndex:j,loading:_,selectedStickers:C,photoBoothSettings:I}=e;const[N,R]=(0,n.useState)("background"),[E,A]=(0,n.useState)([]),[P,F]=(0,n.useState)([]),[T,$]=(0,n.useState)([]);return(0,n.useEffect)(()=>{"text"===N&&f()},[N]),(0,n.useEffect)(()=>{F((0,S.S3)((null===I||void 0===I?void 0:I.photo_booth_frames)||[])),A((0,S.S3)((null===I||void 0===I?void 0:I.photo_booth_backgrounds)||[])),$((0,S.S3)((null===I||void 0===I?void 0:I.photo_booth_stickers)||[]))},[]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"pb_customization",children:[(0,o.jsx)(m,{loading:_,capturedImage:t,canvasRef:l,canvasCursor:i,onMouseDown:p,onMouseMove:v,onMouseUp:b,canvasElements:w,activeTextIndex:j,setCanvasElements:M}),(0,o.jsxs)("div",{className:"pb_tabs",children:[(0,o.jsx)("div",{className:"pb_tabs_list",children:g.map(e=>(0,o.jsx)("button",{onClick:()=>R(e.id),className:N===e.id?"active":"",children:e.label},e.id))}),(0,o.jsx)("div",{className:"pb_tabs_content",children:(0,o.jsx)("div",{className:"pb_tabs_content_box",children:"background"===N?(0,o.jsx)(k,{loading:_,imgUrl:s,imgList:E,setImgUrl:c,tabKey:"backgrounds"}):"frame"===N?(0,o.jsx)(k,{imgUrl:d,imgList:P,setImgUrl:h,tabKey:"frames"}):"sticker"===N?(0,o.jsx)(x,{stickers:T,addSticker:u,loading:_,selectedStickers:C}):"text"===N?(0,o.jsx)(y,{canvasElements:w,setCanvasElements:M,activeTextIndex:j}):null})})]})]}),(0,o.jsx)(r,{className:"pb_continue_buttons",children:"Continue",onClick:()=>{if(null!==l&&void 0!==l&&l.current){const e=l.current,t=(e.getContext("2d"),e.toDataURL("image/png"));t&&a(2,t)}}})]})};function j(e){return(0,o.jsxs)("div",{className:"pb_header_bar",children:[(0,o.jsx)("img",{src:`${i.th}/media/images/photobooth/arrow-back.svg`,alt:"arrow-back",onClick:e.backAction}),2==e.uploadType&&e.uploadImg?(0,o.jsx)("img",{className:"pb_header_logo",src:e.wall.UgcSettings.onsite_logo,height:20,width:130,alt:""}):(0,o.jsx)("span",{className:"header-title",children:"Create a New Post"})]})}const _=(e,t,a)=>{let n="blob"==t?((e,t)=>{try{const a=e.split(","),n=a[0].match(/:(.*?);/)[1],l=atob(a[1]);let i=l.length;const o=new Uint8Array(i);for(;i--;)o[i]=l.charCodeAt(i);return new File([o],t,{type:n})}catch(a){return console.error("Error converting base64 data to file:",a),null}})(e,"camera.png"):e;if(n){const e=URL.createObjectURL(n);e&&a&&a(e)}},C=(e,t,a)=>{const n=e.img.width*e.scale,l=e.img.height*e.scale;return t>e.x+n-15&&t<e.x+n&&a>e.y+l-15&&a<e.y+l},I=(e,t,a)=>{const n=e.img.width*e.scale,l=e.img.height*e.scale;return t>e.x&&t<e.x+n&&a>e.y&&a<e.y+l},N=(e,t,a)=>{const{img:n,scale:l,x:i,y:o,rotation:s=0}=e,r=n.width*l,c=n.height*l,d=i+r/2,h=o+c/2,u=r/2,g=-c/2-5,m=s*Math.PI/180,x=t-(d+u*Math.cos(m)-g*Math.sin(m)),f=a-(h+u*Math.sin(m)+g*Math.cos(m));return Math.sqrt(x*x+f*f)<=7},R=(e,t,a,n)=>{const l=e.scale||1,i=e.fontSize||20,o=20*n,s=e.text.split("\n").length*i*l+20,r=t-e.x,c=a-e.y,d=(e.rotation||0)*Math.PI/180,h=Math.cos(-d),u=Math.sin(-d),g=(r*h-c*u)/l,m=(r*u+c*h)/l;return g>=-o/(2*l)&&g<=o/(2*l)&&m>=-s/(2*l)&&m<=s/(2*l)},E=(e,t,a,n)=>{var l;const i=e.scale||1,o=e.fontSize||20,s=(null===(l=e.text)||void 0===l?void 0:l.split("\n"))||[],r=1.2*o*Math.max(s.length,1)*i+20,c=n*i+20,d=e.x,h=e.y,u=c/2,g=r/2,m=(e.rotation||0)*Math.PI/180,x=t-(d+u*Math.cos(m)-g*Math.sin(m)),f=a-(h+u*Math.sin(m)+g*Math.cos(m));return x*x+f*f<64},A=(e,t,a,n)=>{var l;const i=e.scale||1,o=e.fontSize||20,s=e.x,r=e.y,c=(null===(l=e.text)||void 0===l?void 0:l.split("\n"))||[],d=(n*i+20)/2,h=-(1.2*o*Math.max(c.length,1)*i+20)/2,u=(e.rotation||0)*Math.PI/180,g=t-(s+d*Math.cos(u)-h*Math.sin(u)),m=a-(r+d*Math.sin(u)+h*Math.cos(u));return g*g+m*m<64};var P=a(69522);const F=e=>{let{imageUrl:t,photoBtnRef:a,customiseImage:l}=e;const s=(0,n.useRef)(null),r=(0,n.useRef)(null),[c,d]=(0,n.useState)(!0),[h,u]=(0,n.useState)({width:200,height:200}),[g,m]=(0,n.useState)({x:0,y:0}),[x,f]=(0,n.useState)(1),p=304,v=304,b=(0,n.useCallback)(()=>{const e=r.current;if(!e)return console.error("Original image not loaded."),null;const t=document.createElement("canvas");t.width=p,t.height=v;const a=t.getContext("2d"),n=e.naturalWidth/h.width,i=e.naturalHeight/h.height,o=-g.x/x*n,s=-g.y/x*i,c=p/x*n,d=v/x*i;a.drawImage(e,o,s,c,d,0,0,p,v);const u=t.toDataURL("image/png");l(u)},[g,x,h,p,v]);(0,n.useEffect)(()=>{const e=new Image;e.crossOrigin="anonymous",e.onload=()=>{const t=e.width/e.height;let a=p,n=a/t;n>v&&(n=v,a=n*t),u({width:a,height:n}),m({x:(p-a)/2,y:(v-n)/2})},e.src=t},[t]);const w=h.width*x,y=h.height*x;return(0,n.useEffect)(()=>{const e=setTimeout(()=>{d(!1)},2500);return()=>clearTimeout(e)},[]),(0,o.jsxs)("div",{ref:s,style:{width:p,height:v,border:"2px dashed #aaa",position:"relative",overflow:"hidden",margin:"0px auto 30px",background:"#f9f9f9",touchAction:"none",borderRadius:"8px"},onWheel:e=>{e.preventDefault();const t=e.deltaY<0?.05:-.05,a=Math.max(1,x+t);if(a<=1.01&&w<=p&&y<=v){f(1);const e=(p-h.width)/2,t=(v-h.height)/2;m({x:e,y:t})}else f(a)},children:[(0,o.jsx)(P.p,{size:{width:w,height:y},position:g,enableResizing:!1,disableDragging:!1,onDragStop:(e,t)=>{let a=t.x,n=t.y;const l=Math.max(0,w-p),i=Math.max(0,y-v);a=Math.min(Math.max(a,-l),0),n=Math.min(Math.max(n,-i),0),m({x:a,y:n})},style:{zIndex:2,pointerEvents:"auto"},children:(0,o.jsx)("img",{ref:r,src:t,alt:"Editable",style:{width:"100%",height:"100%",objectFit:"cover",userSelect:"none",pointerEvents:"none"}})}),(0,o.jsx)("button",{ref:a,style:{display:"none",position:"absolute",top:10,right:10,zIndex:400},onClick:b,children:"Capture"}),c?(0,o.jsxs)("div",{className:"pb_take_photo_crop",children:[(0,o.jsx)("img",{src:`${i.th}/media/images/photobooth/arrow-left.svg`,alt:"arrow-left",width:50,height:50}),(0,o.jsx)("img",{src:`${i.th}/media/images/photobooth/arrow-right.svg`,alt:"arrow-right",width:50,height:50})]}):null]})},T=e=>{var t;let{rawImage:a,takePhoto:l,canvasRef:i,canvasCursor:s,setRawImage:c,customisePhoto:d}=e;const h=(0,n.useRef)(null),u=(0,n.useRef)(null),g=(0,n.useRef)(null),[x,f]=(0,n.useState)(null),[p,v]=(0,n.useState)("capture"),[b,w]=(0,n.useState)(0),y=(0,n.useCallback)(async()=>{for(let e=0;e<4;e++)setTimeout(()=>f(e+1),1e3*e)},[]),k=(0,n.useCallback)(()=>{v("capture"),c(null)},[]),S=(0,n.useCallback)(e=>{var t,a;const n=null===e||void 0===e||null===(t=e.target)||void 0===t||null===(a=t.files)||void 0===a?void 0:a[0];w(b+1),_(n,"file",e=>l(e,!0))},[b]),M=(0,n.useCallback)(async e=>{var t;v(e),"capture"===e&&await y(),"upload"===e&&null!==h&&void 0!==h&&h.current&&await(null===h||void 0===h||null===(t=h.current)||void 0===t?void 0:t.click())},[]);return(0,n.useEffect)(async()=>{if(4==x&&null!==u&&void 0!==u&&u.current){var e;f(null);const t=await(null===u||void 0===u||null===(e=u.current)||void 0===e?void 0:e.getScreenshot());_(t,"blob",e=>l(e,!0))}},[x]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"pb_user_photo_box",children:[a?(0,o.jsx)(F,{photoBtnRef:g,imageUrl:null!==(t=null===a||void 0===a?void 0:a.src)&&void 0!==t?t:"",customiseImage:e=>{_(e,"blob",e=>l(e,!1)),setTimeout(d,100)}}):(0,o.jsx)(m,{mode:p,rawImage:a,canvasRef:i,canvasCursor:s,webcamRef:u,counter:x}),a?(0,o.jsxs)("div",{className:"pb_take_photo",children:[(0,o.jsx)(r,{className:"pb_buttons_transparent",icon:"retake",children:"Retake",onClick:k}),(0,o.jsx)(r,{className:"pb_buttons heighlight",children:"Use Photo",onClick:()=>{var e;return null===g||void 0===g||null===(e=g.current)||void 0===e?void 0:e.click()}})]}):(0,o.jsxs)("div",{className:"pb_user_buttons",children:[(0,o.jsx)(r,{className:"pb_buttons heighlight",icon:"camera",children:"Capture Photo",onClick:()=>M("capture")}),(0,o.jsx)(r,{className:"pb_buttons",icon:"upload",children:"Upload From Gallery",onClick:()=>M("upload")})]})]}),(0,o.jsx)("input",{ref:h,type:"file",accept:"image/*",style:{display:"none"},onChange:S},b)]})};var $=a(48768);const z="Your Text Here",B=e=>{var t,a,i,r;const c=(0,n.useRef)(null),d=(0,n.useRef)({}),g=(0,n.useRef)({}),[m,x]=(0,n.useState)(!1),[f,p]=(0,n.useState)(null),[v,b]=(0,n.useState)(null),[w,y]=(0,n.useState)(!1),[k,S]=(0,n.useState)(null),[_,P]=(0,n.useState)(null),[F,B]=(0,n.useState)(null),[U,O]=(0,n.useState)([]),[D,L]=(0,n.useState)([]),[Y,W]=(0,n.useState)(null),[X,q]=(0,n.useState)(null),[H,K]=(0,n.useState)(null),[G,V]=(0,n.useState)(null===e||void 0===e?void 0:e.snapType),[J,Q]=(0,n.useState)(null),[Z,ee]=(0,n.useState)(null),[te,ae]=(0,n.useState)(null),[ne,le]=(0,n.useState)(null),[ie,oe]=(0,n.useState)("default"),[se,re]=(0,n.useState)({width:h,height:u}),ce=e=>{x(e)},de=e=>{const t=c.current,a=t.getBoundingClientRect();return{x:(e.clientX-a.left)*(t.width/a.width),y:(e.clientY-a.top)*(t.height/a.height)}},he=e=>{const t=null===c||void 0===c?void 0:c.current;if(!t||null===e||void 0===e||!e.text)return 0;const a=t.getContext("2d");if(!a)return 0;a.save(),a.font=`${e.fontSize||20}px ${e.fontFamily||"Arial"}`;const n=e.text.split("\n"),l=Math.max(...n.map(e=>a.measureText(e).width));return a.restore(),l};(0,n.useEffect)(()=>{if(!v||!k)return;const e=c.current;if(!e)return;const t=e.getContext("2d"),a=se.width,n=se.height;e.width=a,e.height=n;const l=document.createElement("canvas");l.width=a,l.height=n;const i=l.getContext("2d");if(i.clearRect(0,0,a,n),Y&&F){const e=document.createElement("canvas");e.width=a,e.height=n;const t=e.getContext("2d");t.drawImage(v,0,0,a,n),t.globalCompositeOperation="destination-in",t.drawImage(k,0,0,a,n),t.globalCompositeOperation="source-over",i.drawImage(F,0,0,a,n),i.drawImage(e,0,0,a,n)}else i.drawImage(v,0,0,a,n);i.globalCompositeOperation="source-over",_&&i.drawImage(_,0,0,a,n),U.forEach((e,t)=>{const a=e.img.width*e.scale,n=e.img.height*e.scale,l=e.x+a/2,o=e.y+n/2;if(i.save(),i.translate(l,o),i.rotate((e.rotation||0)*Math.PI/180),i.drawImage(e.img,-a/2,-n/2,a,n),t===Z){i.strokeStyle="#2b2b2b",i.lineWidth=2,i.setLineDash([5,3]),i.strokeRect(-a/2,-n/2,a,n),i.setLineDash([]);const s=8,r="\u2921",c=a/2,h=n/2;i.fillStyle="#000",i.beginPath(),i.arc(c,h,s,0,2*Math.PI),i.fill(),i.fillStyle="white",i.font="bold 16px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText(r,c,h);const u=a/2,g=-n/2-20+20,m=8;i.beginPath(),i.fillStyle="#000",i.arc(u,g,m,0,2*Math.PI),i.fill(),i.fillStyle="#fff",i.font="bold 16px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("\u27f3",u,g);const x=22,f=-a/2-x/2+5,p=-n/2-x/2+8;d.current[t]={x:l+f*Math.cos(e.rotation*Math.PI/180)-p*Math.sin(e.rotation*Math.PI/180),y:o+f*Math.sin(e.rotation*Math.PI/180)+p*Math.cos(e.rotation*Math.PI/180),size:x},i.beginPath(),i.arc(f,p,8,0,2*Math.PI),i.fillStyle="black",i.fill(),i.fillStyle="#fff",i.font="bold 9px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("\u2715",f,p)}i.restore()}),D.forEach((e,t)=>{var a;i.save(),i.translate(e.x,e.y),i.rotate(e.rotation*Math.PI/180),i.scale(e.scale,e.scale),i.font=`${e.fontSize}px ${e.fontFamily||"Arial"}`,i.textAlign=e.align||"center",i.textBaseline="middle";const n=(null===(a=e.text)||void 0===a?void 0:a.split("\n"))||[""],l=Math.max(...n.map(e=>i.measureText(e).width)),o=n.length,s=e.fontSize*e.scale,r=l+20,c=s*o+10,d=1.2*s,h=l+20,u=s*n.length+30,m=-h/2;if(e.backgroundColor&&(i.fillStyle=e.backgroundColor,i.fillRect(m,-u/2,h,u)),t!==J&&(i.fillStyle=e.color||"#000000",n.forEach((e,t)=>{let a=0;"center"==i.textAlign?a=0:"left"==i.textAlign?a=-h/2+10:"right"==i.textAlign&&(a=h/2-10),i.fillText(e,a,t*d-(n.length-1)*d/2)})),t===J){const a=document.getElementById(`text-${J}`);a&&e.text==z&&(a.focus(),a.select()),i.strokeStyle="#2b2b2b",i.lineWidth=2,i.setLineDash([5,3]),i.strokeRect(m,-u/2,h,u),i.setLineDash([]);const n=22,l=(e.rotation||0)*Math.PI/180,o=-r/2-n/2,s=-c/2-n/2,d=e.x+o*Math.cos(l)-s*Math.sin(l),x=e.y+o*Math.sin(l)+s*Math.cos(l);g.current[t]={x:d,y:x,size:Math.max(10,n*e.scale)},i.fillStyle="black",i.beginPath(),i.arc(m,-u/2,8,0,2*Math.PI),i.fill(),i.fillStyle="#fff",i.font="bold 10px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("\u2715",m,-u/2),i.fillStyle="black",i.beginPath(),i.arc(m+h,-u/2,8,0,2*Math.PI),i.fill(),i.fillStyle="white",i.font="bold 14px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("\u27f3",m+h,-u/2),i.fillStyle="black",i.beginPath(),i.arc(m+h,u/2,8,0,2*Math.PI),i.fill(),i.fillStyle="white",i.font="bold 14px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("\u2921",m+h,u/2)}i.restore()}),t.clearRect(0,0,a,n),t.drawImage(l,0,0)},[v,k,_,U,Z,D,J,F,w,se]),(0,n.useEffect)(()=>{if(!Y)return void B(null);const e=new Image;e.crossOrigin="anonymous",e.src=`https://cdn.taggbox.com/v7/${Y}`,ce(!0),e.onload=()=>{B(e),ce(!1)},e.onerror=()=>{console.error(`Failed to load background image: ${Y}`),ce(!1)}},[Y]),(0,n.useEffect)(()=>{if(!X)return void P(null);const e=new Image;e.crossOrigin="anonymous",e.src=`https://cdn.taggbox.com/v7/${X}`,ce(!0),e.onload=()=>{P(e),ce(!1)},e.onerror=()=>{console.error(`Failed to load frame image: ${X}`),ce(!1)}},[X]);const ue=(e,t)=>{V(e),K(t)};return(0,o.jsxs)("div",{className:"pb_photo_booth_main",children:[console.log(G,"uploadTypeuploadType",H),(0,o.jsxs)("div",{className:"pb_photo_booth_box",children:[(0,o.jsx)(j,{uploadImg:H,uploadType:G,wall:null===e||void 0===e?void 0:e.wall,backAction:()=>{if(w&&!H)return p(v),y(!1);if(f&&!H)return p(null);const t=1===(null===e||void 0===e?void 0:e.snapType)&&!H&&[2,3].includes(G)?1:H&&2===G?3:null===e||void 0===e?void 0:e.snapType;V(t),H&&(K(null),y(!1))}}),(0,o.jsx)("div",{className:"pb_photo_booth_h",children:1==G?(0,o.jsx)(s,{uploadFile:ue}):(0,o.jsx)(o.Fragment,{children:2===G?(0,o.jsx)($.default,{isPhotoBooth:H,photoBoothInterface:1,wall:null===e||void 0===e?void 0:e.wall,wallId:null===e||void 0===e||null===(t=e.wall)||void 0===t||null===(a=t.Wall)||void 0===a?void 0:a.id,feeds:null===e||void 0===e?void 0:e.feeds,isFreeAdsStatus:null===e||void 0===e?void 0:e.isFreeAdsStatus}):w?(0,o.jsx)(M,{loading:m,capturedImage:v,uploadFile:ue,canvasRef:c,canvasCursor:ie,selectedBg:Y,setSelectedBg:W,selectedFrame:X,setSelectedFrame:q,addSticker:e=>{const t=new Image;t.crossOrigin="anonymous",ce(!0),t.src=`https://cdn.taggbox.com/v7/${e}`,t.onload=()=>{ce(!1);const a=se.width,n=se.height,l=t.height/t.width*100,i=100/t.width;O(o=>{const s=[...o,{img:t,x:a/2-50,y:n/2-l/2,scale:i,url:e,rotation:0}];return ee(s.length-1),s})},t.onerror=()=>{ce(!1),console.error(`Failed to load sticker image: ${e}`)}},addTextElement:()=>{const e=se.width,t=se.height,a={text:z,x:e/2,y:t/2,scale:1,rotation:0,fontSize:28,fontFamily:"Arial",color:"#000000",backgroundColor:"white",align:"center"};L(e=>{const t=[...e,a];return Q(t.length-1),t})},onMouseDown:e=>{const{x:t,y:a}=de(e);let n=!1,l=!1;for(let o=U.length-1;o>=0;o--){const e=U[o],l=d.current[o];if(l){const{x:e,y:n,size:i}=l,s=t-e,r=a-n;if(Math.sqrt(s*s+r*r)<i/2)return O(e=>e.filter((e,t)=>t!==o)),void ee(null)}if(N(e,t,a)){ee(o),ae("rotate"),le({x:t,y:a,centerX:e.x+e.img.width*e.scale/2,centerY:e.y+e.img.height*e.scale/2,initialAngle:e.rotation||0}),n=!0;break}if(C(e,t,a)){ee(o),ae("resize"),le({x:t,y:a,initialScale:e.scale,initialWidth:e.img.width}),n=!0;break}if(I(e,t,a)){ee(o),ae("move"),le({x:t,y:a,initialX:e.x,initialY:e.y}),n=!0;break}}if(!n)for(let o=D.length-1;o>=0;o--){var i;const e=D[o],n=he(e),s=null===(i=g.current)||void 0===i?void 0:i[o];if(s){const{x:e,y:l}=s,i=D[o].scale||1,r=t-e,c=a-l;let d=.9;i<.5?d=3.5:i<.6?d=3:i<.7?d=2.4:i<.8?d=1.9:i<.93&&(d=1.6);if(Math.sqrt(r*r+c*c)/d<Math.max(20,.01*n*i))return L(e=>e.filter((e,t)=>t!==o)),void Q(null)}if(A(e,t,a,n)){Q(o),ae("rotate-text"),le({x:t,y:a,centerX:e.x,centerY:e.y,initialAngle:e.rotation||0}),l=!0;break}if(E(e,t,a,n)){Q(o),ee(null),ae("resize-text"),le({x:t,y:a,initialScale:e.scale,initialWidth:n}),l=!0;break}if(R(e,t,a,n)){Q(o),ae("move-text"),le({x:t,y:a,initialX:e.x,initialY:e.y}),l=!0;break}}n||l||(ee(null),Q(null),ae(null),le(null))},onMouseMove:e=>{const{x:t,y:a}=de(e);let n="default",l=!1;for(let s=D.length-1;s>=0;s--){const e=D[s],i=he(e);if(A(e,t,a,i)){n="crosshair",l=!0;break}if(E(e,t,a,i)){n="nwse-resize",l=!0;break}if(R(e,t,a,i)){n="grab",l=!0;break}}if(!l)for(let s=U.length-1;s>=0;s--){const e=U[s];if(N(e,t,a)){n="crosshair",l=!0;break}if(C(e,t,a)){n="nwse-resize",l=!0;break}if(I(e,t,a)){n="grab",l=!0;break}}if("move"!==te||null===Z&&null===J||(n="grabbing"),oe(n),!te||!ne)return;const i=t-ne.x,o=a-ne.y;null!==Z&&O(e=>{const n=[...e],l={...n[Z]};if("move"===te)l.x=ne.initialX+i,l.y=ne.initialY+o;else if("resize"===te){const e=ne.initialWidth*ne.initialScale+i,t=Math.max(.05,e/l.img.width);l.scale=t}else if("rotate"===te){const e=Math.atan2(ne.y-ne.centerY,ne.x-ne.centerX),n=180*(Math.atan2(a-ne.centerY,t-ne.centerX)-e)/Math.PI;l.rotation=(ne.initialAngle+n)%360}return n[Z]=l,n}),null!==J&&L(e=>{const n=[...e],l={...n[J]};if("move-text"===te)l.x=ne.initialX+i,l.y=ne.initialY+o;else if("resize-text"===te){const e=ne.initialWidth*ne.initialScale+i,t=Math.max(.1,e/he(l));l.scale=t}else if("rotate-text"===te){const e=Math.atan2(ne.y-ne.centerY,ne.x-ne.centerX),n=180*(Math.atan2(a-ne.centerY,t-ne.centerX)-e)/Math.PI;l.rotation=(ne.initialAngle+n)%360}return n[J]=l,n})},onMouseUp:()=>{ae(null),le(null),oe("default")},canvasElements:D,setCanvasElements:L,activeTextIndex:J,photoBoothSettings:null!==(i=null===e||void 0===e||null===(r=e.wall)||void 0===r?void 0:r.PhotoBoothSettings)&&void 0!==i?i:{},selectedStickers:U}):(0,o.jsx)(T,{rawImage:f,takePhoto:async(e,t)=>{if(!e)return void console.error("Failed to capture screenshot from webcam.");const a=new Image;a.crossOrigin="anonymous",a.src=e,a.onload=async()=>{t?p(a):b(a),re({width:a.width,height:a.height}),await(async e=>{const t=new l.SelfieSegmentation({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${e}`});t.setOptions({modelSelection:1}),t.onResults(e=>{S(e.segmentationMask)});const a=document.createElement("canvas");a.width=e.width,a.height=e.height,a.getContext("2d").drawImage(e,0,0,e.width,e.height);try{await t.send({image:a})}catch(n){console.error("Error sending image to MediaPipe:",n)}})(a)},a.onerror=()=>{console.error("Failed to load captured image.")}},canvasRef:c,canvasCursor:ie,setRawImage:p,customisePhoto:()=>{p(null),P(null),B(null),O([]),L([]),W(null),q(null),Q(null),ee(null),y(!0)}})})})]})]})}}}]);