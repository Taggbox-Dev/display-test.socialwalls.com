"use strict";(self.webpackChunkembed_widget=self.webpackChunkembed_widget||[]).push([[4296,9430],{33111:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Y});var n=a(9950),i=a(80415),o=a(44414);function l(e){let{uploadFile:t}=e;return(0,o.jsx)("div",{className:"pb_cards",children:(0,o.jsxs)("div",{className:"pb_cards_box",children:[(0,o.jsxs)("div",{onClick:()=>t(3),className:"pb_card",children:[(0,o.jsx)("div",{className:"pb_card_icon",children:(0,o.jsx)("img",{src:`${i.on}images/photobooth/camera.svg`,alt:"camera"})}),(0,o.jsx)("h3",{className:"pb_card-title",children:"Photobooth"}),(0,o.jsx)("p",{className:"pb_card-description",children:" Add fun stickers and backgrounds before sharing your masterpiece."})]}),(0,o.jsxs)("div",{onClick:()=>t(2),className:"pb_card",children:[(0,o.jsx)("div",{className:"pb_card_icon",children:(0,o.jsx)("img",{src:`${i.on}images/photobooth/snapup.svg`,alt:"snapup"})}),(0,o.jsx)("h3",{className:"pb_card-title",children:"Snap & Share"}),(0,o.jsx)("p",{className:"pb_card-description",children:"Upload your photos in one go without logging into your social media accounts."})]})]})})}const s=e=>{let{className:t,children:a,icon:n,onClick:l}=e;return(0,o.jsxs)("button",{className:t,onClick:l,children:[n&&(0,o.jsx)("img",{src:`${i.on}images/photobooth/${n}.svg`,alt:n}),a]})};var r=a(11766),c=a.n(r);const d=320,u=320,h=[{id:"background",label:"Background"},{id:"frame",label:"Frames"},{id:"sticker",label:"Stickers"},{id:"text",label:"Text"}];var m=a(52867),g=a(66345),v=a(14313);const x=async(e,t)=>{const a=await fetch(e),n=await a.blob();return new File([n],t,{type:n.type,lastModified:Date.now()})},p=(e,t,a)=>{let n="blob"==t?((e,t)=>{try{const[a,n]=e.split(","),i=a.match(/:(.*?);/)[1],o=atob(n),l=o.length,s=new Uint8Array(l);for(let e=0;e<l;e++)s[e]=o.charCodeAt(e);return new File([s],t,{type:i})}catch(a){return console.error("Error converting base64 data to file:",a),null}})(e,"camera.png"):e;if(n){const e=URL.createObjectURL(n);e&&a&&a(e)}},f=(e,t,a,n)=>{const i=e.img.width*e.scale,o=e.img.height*e.scale,{initialWidthRatio:l,initialHeightRatio:s}=M(n),r=Math.max(l,s),c=(e.rotation||0)*Math.PI/180,d=e.x+i/2,u=e.y+o/2,h=i/2,m=o/2,g=t-(d+(h*Math.cos(c)-m*Math.sin(c))),v=a-(u+(h*Math.sin(c)+m*Math.cos(c)));return Math.sqrt(g*g+v*v)<=k(15,7)/2*r},b=(e,t,a)=>{const n=e.img.width*e.scale,i=e.img.height*e.scale;return t>e.x&&t<e.x+n&&a>e.y&&a<e.y+i},w=(e,t,a,n)=>{const{img:i,scale:o,x:l,y:s,rotation:r=0}=e,{initialWidthRatio:c,initialHeightRatio:d}=M(n),u=Math.max(c,d),h=i.width*o,m=i.height*o,g=l+h/2,v=s+m/2,x=h/2,p=-m/2-3,f=r*Math.PI/180,b=t-(g+x*Math.cos(f)-p*Math.sin(f)),w=a-(v+x*Math.sin(f)+p*Math.cos(f));return Math.sqrt(b*b+w*w)<=k(15,7)*u},y=(e,t,a,n,i)=>{var o;const{initialWidthRatio:l,initialHeightRatio:s}=M(i),r=e.scale||1,c=e.fontSize||20,d=e.x,u=e.y,h=(n*r+20)*l,g=(((null===(o=e.text)||void 0===o?void 0:o.split("\n"))||[]).length*c*r+20)*s,v=(0,m.qs)()?r>0?20/r:20:0,x=t-d,p=a-u,f=(e.rotation||0)*Math.PI/180,b=Math.cos(-f),w=Math.sin(-f),y=(x*b-p*w)/r,_=(x*w+p*b)/r;return y>=-h/(2*r)&&y<=h/(2*r)&&_>=-g/(2*r)-v&&_<=g/(2*r)+v},_=(e,t,a,n,i)=>{var o;const{initialWidthRatio:l,initialHeightRatio:s}=M(i),r=Math.max(l,s),c=e.scale||1,d=e.fontSize||20,u=(null===(o=e.text)||void 0===o?void 0:o.split("\n"))||[],h=1.2*d*Math.max(u.length,1)*c+20,m=n*c+20,g=k(16),v=e.x,x=e.y,p=m/2*l,f=h/2*s,b=(e.rotation||0)*Math.PI/180,w=t-(v+p*Math.cos(b)-f*Math.sin(b)),y=a-(x+p*Math.sin(b)+f*Math.cos(b));return w*w+y*y<(g/2)**2*r**2},j=(e,t,a,n,i)=>{var o;const{initialWidthRatio:l,initialHeightRatio:s}=M(i),r=Math.max(l,s),c=e.scale||1,d=e.fontSize||20,u=k(16),h=e.x,m=e.y,g=(null===(o=e.text)||void 0===o?void 0:o.split("\n"))||[],v=(n*c+20)/2*l,x=-(1.2*d*Math.max(g.length,1)*c+20)/2*s,p=(e.rotation||0)*Math.PI/180,f=t-(h+v*Math.cos(p)-x*Math.sin(p)),b=a-(m+v*Math.sin(p)+x*Math.cos(p));return f*f+b*b<(u/2)**2*r**2},k=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,m.qs)()?2*e+t:e},M=e=>({initialWidthRatio:Math.max(1,e?e.width/d:1),initialHeightRatio:Math.max(1,e?e.height/u:1)}),S=e=>{let{rawImage:t,cameraPermission:a,capturedImage:l,mode:s,counter:r,canvasRef:h,canvasCursor:g,webcamRef:v,onMouseDown:x,onMouseMove:p,onMouseUp:f,canvasElements:b,activeTextIndex:w,setCanvasElements:y,loading:_}=e;const[j,k]=(0,n.useState)("environment"),[S,I]=(0,n.useState)(Math.random()),C=e=>e?e.split("\n").length:1,R=(0,n.useMemo)(m.qs,[]),{initialWidthRatio:E,initialHeightRatio:$}=(0,n.useMemo)(()=>M(l),[l]),T=e=>{const t=e.target.value;if((null===t||void 0===t?void 0:t.length)<=35){const e=(e=>{if(!h.current||!b[w])return e;const t=b[w],a=document.createElement("canvas").getContext("2d"),n=t.fontSize||16,i=t.fontFamily||"Arial";a.font=`${n}px ${i}`;const o=e.split(/\s+/);let l="",s="";const r=e=>{let t="";for(let n of e){const e=t+n;a.measureText(e).width>270&&t?(s+=t+"\n",t=n):t=e}return t};for(let c of o){let e=l?l+" "+c:c;a.measureText(e).width>270?l?(s+=l+"\n",l=a.measureText(c).width>270?r(c):c):l=r(c):l=e}return l&&(s+=l),s})(t);y(t=>t.map((t,a)=>a===w?{...t,text:e}:t))}},N=(0,n.useCallback)(e=>{if(!e||!e.text)return 0;const t=document.createElement("canvas").getContext("2d"),a=e.fontSize||16,n=e.fontFamily||"Arial",i=e.scale||1;t.font=`${a}px ${n}`;const o=e.text.split("\n");return Math.max(...o.map(e=>t.measureText(e).width))*i},[]);(0,n.useEffect)(()=>((async()=>{try{setTimeout(()=>{I(Date.now())},2e3)}catch(e){console.error("Error starting camera:",e)}})(),()=>A()),[]);const A=()=>{setTimeout(()=>{var e;null!==v&&void 0!==v&&v.current&&((null===v||void 0===v||null===(e=v.current)||void 0===e?void 0:e.stream)&&v.current.stream.getTracks().forEach(e=>e.stop()))},1e3)},F=(0,n.useCallback)(()=>{k(e=>"user"===e?"environment":"user"),I(e=>e+1)},[]);return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)("div",{className:"pb_user_photo "+(_?"active_blur":""),style:{position:"relative",display:t?"none":l||"granted"===a?"flex":"none"},children:["capture"!==s||l?l?(0,o.jsx)("canvas",{ref:h,style:{cursor:g,width:"320px",height:"320px"},onMouseDown:x,onMouseMove:p,onMouseUp:f,onMouseLeave:f,onTouchStart:function(e){const t=e.type.startsWith("touch");e.preventDefault();const a=e.touches[0],n={clientX:a.clientX,clientY:a.clientY};x(n,t)},onTouchMove:function(e){e.preventDefault();const t=e.touches[0],a={clientX:t.clientX,clientY:t.clientY};p(a)},onTouchEnd:function(e){e.preventDefault(),f()}}):(0,o.jsx)("img",{src:`${i.on}images/photobooth/avatar.png?v=1.0.1`,alt:"default-avatar",width:d,height:u}):(0,o.jsx)(c(),{ref:v,screenshotFormat:"image/png",width:d,height:u,videoConstraints:{facingMode:j,width:{min:640,ideal:1920,max:3840},height:{min:480,ideal:1080,max:2160}},mirrored:"user"===j,style:{objectFit:"cover",borderRadius:"8px"}},`${S}-${j}`),null===b||void 0===b?void 0:b.map((e,t)=>w===t&&(0,o.jsx)("textarea",{id:`text-${t}`,name:`text-${t}`,value:e.text,onChange:T,wrap:"hard",style:{position:"absolute",top:e.y/$-(e.fontSize*e.scale*C(e.text)+e.scale*$)/2+"px",left:e.x/E-N(e)/2-(R?3:0)+"px",width:`${N(e)}px`,height:e.fontSize*e.scale*C(e.text)+5+"px",fontSize:e.fontSize*e.scale+"px",fontFamily:e.fontFamily||"Arial",transform:`rotate(${e.rotation||0}deg)`,textAlign:e.align||"center",transformOrigin:"center center",background:e.backgroundColor||"transparent",color:e.color||"#000",overflow:"hidden",border:"none",outline:"none",padding:0,maxWidth:"300px",wordBreak:"break-word",whiteSpace:"pre-wrap",overflowWrap:"break-word",resize:"none"}},t)),R&&!l?(0,o.jsx)("button",{onClick:F,children:(0,o.jsx)("img",{src:`${i.on}images/photobooth/camera-flip.svg`,alt:"flip-camera"})}):null,r?(0,o.jsxs)("div",{className:"pb_viewframe",children:[(0,o.jsx)("img",{src:`${i.on}images/photobooth/viewframe-white@3x.svg`,alt:"viewframe"})," ",(0,o.jsx)("span",{children:r})]}):null]})})},I=n.memo(S),C=e=>{let{addSticker:t,loading:a,stickers:n,selectedStickers:i}=e;return(0,o.jsx)("div",{className:"pb_tabs_content_box",children:(0,o.jsx)("div",{className:"pb_list_items pb_stickers",children:n.map((e,n)=>{const l=null===i||void 0===i?void 0:i.find(t=>(null===t||void 0===t?void 0:t.url)==e);return(0,o.jsx)("img",{onClick:a?null:()=>t(e),style:{cursor:a?"not-allowed":"pointer"},className:l?"active":"",src:`${e}?v=2.3`,alt:"sticker",width:64,height:64},n)})})})};var R=a(25825);const E=["font","align","color","bg"],$=["Georgia","Arial","Helvetica","Times New Roman","Courier New","Verdana","Tahoma","Trebuchet MS","Comic Sans MS","Impact","Lucida Console","Roboto","Open Sans"],T=["left","center","right"],N=["white","black","transparent"],A=e=>{var t,a;let{canvasElements:l,setCanvasElements:s,activeTextIndex:r,addTextElement:c}=e;const[d,u]=(0,n.useState)(0),h=(0,n.useRef)(null);return(0,n.useEffect)(()=>{const e=e=>{h.current&&!h.current.contains(e.target)&&u(!1)};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}},[]),(0,o.jsxs)(o.Fragment,{children:[d?(0,o.jsx)("div",{ref:h,children:(0,o.jsx)(R.xk,{color:null!==(t=null===(a=l[r])||void 0===a?void 0:a.color)&&void 0!==t?t:"black",onChange:e=>s(t=>t.map((t,a)=>a===r?{...t,color:e.hex}:t))})}):null,(0,o.jsxs)("div",{className:"pb_tabs_content_box",children:[(0,o.jsx)("div",{className:"pb_text",children:E.map(e=>(0,o.jsxs)("div",{className:"pb_text_box",onClick:()=>(e=>{if(null!==r){const d={};if("color"===e)return void u(1);if("align"===e){var t,a;const e=null!==(t=null===(a=l[r])||void 0===a?void 0:a.align)&&void 0!==t?t:"center",n=T.find(t=>t===e);d.align=T[(T.indexOf(n)+1)%T.length]}else if("bg"===e){var n,i;const e=null!==(n=null===(i=l[r])||void 0===i?void 0:i.backgroundColor)&&void 0!==n?n:"transparent",t=N.find(t=>t===e);d.backgroundColor=N[(N.indexOf(t)+1)%N.length]}else if("font"===e){var o,c;const e=null!==(o=null===(c=l[r])||void 0===c?void 0:c.fontFamily)&&void 0!==o?o:"Arial",t=Math.max(0,$.indexOf(e));d.fontFamily=$[(t+1)%$.length]}s(e=>e.map((e,t)=>t===r?{...e,...d}:e))}})(e),children:[(0,o.jsx)("img",{src:`${i.th}/media/images/photobooth/text/${e}.png?v=1`,alt:e}),(0,o.jsx)("p",{children:e})]},e))}),(0,o.jsx)("div",{className:"pb_add_text",children:(0,o.jsx)("p",{onClick:c,children:"Add Text"})})]})]})},F=e=>{let{loading:t,imgUrl:a,imgList:n,setImgUrl:l,tabKey:s,capturedImage:r=null}=e;return(0,o.jsx)("div",{className:"pb_tabs_content_box",children:(0,o.jsx)("div",{className:`pb_list_items pb_${s}`,children:[`${i.th}/media/images/photobooth/${s}/none.png`,...n].map((e,n)=>{const i=a?a===e:0===n;return(0,o.jsxs)("div",{className:"pb_list_images "+(i?"active":""),children:[r&&0!==n?(0,o.jsx)("img",{className:"pb_list_user_img",src:null===r||void 0===r?void 0:r.src,alt:"captured-image",width:64,height:64}):null,(0,o.jsx)("img",{style:{cursor:t?"not-allowed":"pointer"},src:`${e}?v=2.3`,alt:`img-${n}`,className:"pb_list_frames",width:64,height:64,onClick:t?null:()=>l(0==n?null:e)})]},n)})})})},P=e=>{let{capturedImage:t,uploadFile:a,canvasRef:l,canvasCursor:r,selectedBg:c,setSelectedBg:d,selectedFrame:u,setSelectedFrame:g,addSticker:v,addTextElement:x,onMouseDown:p,onMouseMove:f,onMouseUp:b,canvasElements:w,setCanvasElements:y,activeTextIndex:_,loading:j,selectedStickers:k,photoBoothSettings:M,setActiveStickerIndex:S,setActiveTextIndex:R,activeText:E}=e;const[$,T]=(0,n.useState)("background"),[N,P]=(0,n.useState)([]),[z,L]=(0,n.useState)([]),[B,W]=(0,n.useState)([]);return(0,n.useEffect)(()=>{"text"===$&&0===w.length&&x(),"text"!==$?R(null):"sticker"!==$&&S(null)},[$]),(0,n.useEffect)(()=>{const e=(0,m.S3)((null===M||void 0===M?void 0:M.photo_booth_frames)||[]),t=(0,m.S3)((null===M||void 0===M?void 0:M.photo_booth_backgrounds)||[]),a=(0,m.S3)((null===M||void 0===M?void 0:M.photo_booth_stickers)||[]);L(null===e||void 0===e?void 0:e.map(e=>`${i.on}images/photobooth/frames/${e}`)),P(null===t||void 0===t?void 0:t.map(e=>`${i.on}images/photobooth/backgrounds/${e}`)),W(null===a||void 0===a?void 0:a.map(e=>`${i.on}images/photobooth/stickers/${e}`))},[]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"pb_customization",children:[(0,o.jsx)(I,{loading:j,capturedImage:t,canvasRef:l,canvasCursor:r,onMouseDown:p,onMouseMove:f,onMouseUp:b,canvasElements:w,activeTextIndex:_,setCanvasElements:y,activeText:E}),(0,o.jsxs)("div",{className:"pb_tabs",children:[(0,o.jsx)("div",{className:"pb_tabs_list",children:h.map(e=>(0,o.jsx)("button",{onClick:()=>T(e.id),className:$===e.id?"active":"",children:e.label},e.id))}),(0,o.jsx)("div",{className:"pb_tabs_content",children:"background"===$?(0,o.jsx)(F,{loading:j,imgUrl:c,imgList:N,setImgUrl:d,tabKey:"backgrounds"}):"frame"===$?(0,o.jsx)(F,{imgUrl:u,imgList:z,setImgUrl:g,tabKey:"frames",capturedImage:t}):"sticker"===$?(0,o.jsx)(C,{stickers:B,addSticker:v,loading:j,selectedStickers:k}):"text"===$?(0,o.jsx)(A,{canvasElements:w,setCanvasElements:y,activeTextIndex:_,addTextElement:x}):null})]})]}),(0,o.jsx)("div",{className:"pb_continue_buttons_main",children:(0,o.jsx)(s,{className:"pb_continue_buttons",children:"Continue",onClick:()=>{if(null!==l&&void 0!==l&&l.current){const e=l.current;S(null),R(null),setTimeout(()=>{const t=e.toDataURL("image/png",1);t&&a(2,t)},100)}}})})]})};function z(e){const{snapType:t,uploadType:a,rawImage:n,capturedImage:l,wall:s,uploadImg:r,backAction:c}=e,d=1===t&&1===a||3===t&&!n&&!l;return(0,o.jsxs)("div",{className:"pb_header_bar",onClick:d?()=>window.location.href=`${g.EP}${s.Wall.id}?social-wall=true`:c,children:[(0,o.jsx)("img",{src:`${i.th}/media/images/photobooth/arrow-back.svg`,alt:"arrow-back"}),(0,o.jsx)("span",{className:"header-title",children:d?"Back to Wall":"Back"})]})}var L=a(69522);const B=e=>{let{imageUrl:t,photoBtnRef:a,customiseImage:l}=e;const s=(0,n.useRef)(null),r=(0,n.useRef)(null),c=(0,n.useRef)(null),d=(0,n.useRef)(1),[u,h]=(0,n.useState)(!0),[m,g]=(0,n.useState)({width:200,height:200}),[v,x]=(0,n.useState)({x:0,y:0}),[p,f]=(0,n.useState)(1),b=320,w=320,y=(0,n.useCallback)(()=>{const e=r.current;if(!e)return console.error("Original image not loaded."),null;const t=e.naturalWidth/m.width,a=e.naturalHeight/m.height,n=-v.x/p*t,i=-v.y/p*a,o=b/p*t,s=w/p*a,c=document.createElement("canvas");c.width=o,c.height=s;c.getContext("2d").drawImage(e,n,i,o,s,0,0,o,s),c.toBlob(e=>{if(e){const t=new File([e],"capture.png",{type:"image/png"});l(t)}},"image/png")},[v,p,m,b,w,l]);(0,n.useEffect)(()=>{const e=new Image;e.crossOrigin="anonymous",e.onload=()=>{const t=e.width/e.height;let a,n;t>1?(n=w,a=n*t):(a=b,n=a/t),g({width:a,height:n}),x({x:(b-a)/2,y:(w-n)/2})},e.src=t},[t]);const _=m.width*p,j=m.height*p,k=e=>{const[t,a]=e,n=t.clientX-a.clientX,i=t.clientY-a.clientY;return Math.sqrt(n*n+i*i)},M=e=>{2===e.touches.length&&(c.current=k(e.touches),d.current=p)},S=e=>{if(2===e.touches.length){e.preventDefault();const t=k(e.touches),a=c.current,n=d.current;if(!a||!n)return;const i=t/a;let o=Math.max(1,n*i);f(o)}};return(0,n.useEffect)(()=>{const e=s.current;if(e)return e.addEventListener("touchstart",M,{passive:!1}),e.addEventListener("touchmove",S,{passive:!1}),()=>{e.removeEventListener("touchstart",M),e.removeEventListener("touchmove",S)}},[p]),(0,n.useEffect)(()=>{const e=setTimeout(()=>{h(!1)},2500);return()=>clearTimeout(e)},[]),(0,o.jsxs)("div",{style:{position:"relative",overflow:"hidden",margin:"0px auto 30px",background:"#f9f9f9",touchAction:"none",border:"2px dashed #aaa",borderRadius:"8px"},onWheel:e=>{e.preventDefault();const t=e.deltaY<0?.05:-.05,a=Math.max(1,p+t);if(a<=1.01&&_<=b&&j<=w){f(1);const e=(b-m.width)/2,t=(w-m.height)/2;x({x:e,y:t})}else f(a)},children:[(0,o.jsx)("div",{style:{width:b,height:w},ref:s,children:(0,o.jsx)(L.p,{size:{width:_,height:j},position:v,enableResizing:!1,disableDragging:!1,onDragStop:(e,t)=>{let a=t.x,n=t.y;const i=Math.max(0,_-b),o=Math.max(0,j-w);a=Math.min(Math.max(a,-i),0),n=Math.min(Math.max(n,-o),0),x({x:a,y:n})},style:{zIndex:2,pointerEvents:"auto"},children:(0,o.jsx)("img",{ref:r,src:t,alt:"Editable",style:{width:"100%",height:"100%",objectFit:"cover",userSelect:"none",pointerEvents:"none"}})})}),(0,o.jsx)("button",{ref:a,style:{display:"none",position:"absolute",top:10,right:10,zIndex:400},onClick:y,children:"Capture"}),u?(0,o.jsxs)("div",{className:"pb_take_photo_crop",children:[(0,o.jsx)("img",{src:`${i.th}/media/images/photobooth/arrow-left.svg`,alt:"arrow-left",width:50,height:50}),(0,o.jsx)("img",{src:`${i.th}/media/images/photobooth/arrow-right.svg`,alt:"arrow-right",width:50,height:50})]}):null]})};a(41377);const W=e=>{var t;let{uploadType:a,rawImage:l,takePhoto:r,canvasRef:c,canvasCursor:d,setRawImage:u,customisePhoto:h}=e;const m=(0,n.useRef)(null),g=(0,n.useRef)(null),v=(0,n.useRef)(null),[f,b]=(0,n.useState)(null),[w,y]=(0,n.useState)("capture"),[_,j]=(0,n.useState)(0),[k,M]=(0,n.useState)(null),[S,C]=(0,n.useState)(null),R=(0,n.useCallback)(async()=>{["Smile",3,2,1,0].forEach((e,t)=>{setTimeout(()=>b(e),1e3*t)})},[]),E=(0,n.useCallback)(()=>{y("capture"),u(null)},[]),$=(0,n.useCallback)(e=>{var t,a;const n=null===e||void 0===e||null===(t=e.target)||void 0===t||null===(a=t.files)||void 0===a?void 0:a[0];j(_+1),p(n,"file",e=>r(e,!0))},[_]),T=(0,n.useCallback)(async e=>{var t;y(e),"capture"===e&&await R(),"upload"===e&&null!==m&&void 0!==m&&m.current&&await(null===m||void 0===m||null===(t=m.current)||void 0===t?void 0:t.click())},[]);(0,n.useEffect)(()=>{var e;if(0===f&&(null!==g&&void 0!==g&&null!==(e=g.current)&&void 0!==e&&e.video)){b(null);const e=g.current.video;if(!e)return;const t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;t.getContext("2d").drawImage(e,0,0,t.width,t.height),t.toBlob(e=>{const t=new File([e],"captured-photo.png",{type:"image/png",lastModified:Date.now()});((e,t,a)=>{let n="blob"==t?x(e,"camera.png"):e;if(n){const e=URL.createObjectURL(n);e&&a&&a(e)}})(t,"file",()=>r(URL.createObjectURL(t),!0))},"image/png")}},[f]);return(0,n.useEffect)(()=>{/Safari/i.test(navigator.userAgent)&&!/Chrome/i.test(navigator.userAgent)||(async()=>{try{const e=await navigator.mediaDevices.getUserMedia({video:!0});g.current&&(g.current.srcObject=e),M("granted")}catch(e){if(console.warn("Camera error:",e.name,e.message),navigator.permissions&&navigator.permissions.query)try{const e=await navigator.permissions.query({name:"camera"});return void M(e.state)}catch{console.log("Permissions API not supported (Safari likely)")}M("prompt")}})()},[]),(0,n.useEffect)(()=>{const e=async()=>{try{const e=await navigator.permissions.query({name:"camera"});e.state!==k&&M(e.state)}catch(e){console.warn("Permissions API not fully supported",e)}};return setInterval(e,2e3),()=>{clearInterval(e)}},[k]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"pb_user_photo_box",children:[l?(0,o.jsx)(B,{photoBtnRef:v,imageUrl:null!==(t=null===l||void 0===l?void 0:l.src)&&void 0!==t?t:"",customiseImage:e=>{p(e,"file",e=>r(e,!1)),setTimeout(h,100)}}):null,(0,o.jsxs)(o.Fragment,{children:[" ",(0,o.jsx)(I,{cameraPermission:k,mode:w,rawImage:l,canvasRef:c,canvasCursor:d,webcamRef:g,counter:f}),(0,o.jsxs)("div",{id:"camera-disabled-message",className:"pb-camera-disabled",style:{display:"granted"===k||l?"none":"flex"},children:[(0,o.jsx)("img",{src:`${i.on}images/photobooth/camera-disabled.svg`,alt:"camera-disabled"}),(0,o.jsxs)("p",{className:"pb_camera_disabled_text",children:["Please reload and allow camera",(0,o.jsx)("br",{}),"access when prompted."]}),(0,o.jsxs)("p",{className:"pb_camera_disabled_text_bottom",children:["In case this doesn't work, please",(0,o.jsx)("br",{}),"check the camera permissions in ",(0,o.jsx)("br",{}),"your browser settings."]})]})]}),l?(0,o.jsxs)("div",{className:"pb_take_photo",children:[(0,o.jsx)(s,{className:"pb_buttons_transparent",icon:"retake",children:"Try Again",onClick:E}),(0,o.jsx)(s,{className:"pb_buttons heighlight",children:"Looks Good!",onClick:()=>{var e;return null===v||void 0===v||null===(e=v.current)||void 0===e?void 0:e.click()}})]}):(0,o.jsxs)("div",{className:"pb_user_buttons",children:["granted"===k?(0,o.jsx)(s,{className:"pb_buttons heighlight",icon:"camera",children:"Strike a Pose",onClick:()=>T("capture")}):null,(0,o.jsx)(s,{className:"pb_buttons",icon:"upload",children:"Upload from Gallery",onClick:()=>T("upload")})]})]}),(0,o.jsx)("input",{ref:m,type:"file",accept:"image/*",style:{display:"none"},onChange:$},_)]})};var D=a(48768);const U=()=>(0,o.jsx)("div",{className:"pb_overlay_main",children:(0,o.jsxs)("div",{className:"pb_overlay_content",children:[(0,o.jsx)("img",{src:`${i.on}logos/socialwalls.gif`,alt:"loading",width:50,height:50}),(0,o.jsxs)("div",{className:"text-fade",children:[(0,o.jsx)("span",{children:"Mapping the subject to understand its unique shape"}),(0,o.jsx)("span",{children:"Defining the boundaries with razor-sharp precision"}),(0,o.jsx)("span",{children:"Enhancing the subject's prominence by removing the noise"}),(0,o.jsx)("span",{children:"Presenting your subject, now a standalone masterpiece"})]})]})}),Y=e=>{var t,a,i,s;const r=(0,n.useRef)(null),c=(0,n.useRef)({}),h=(0,n.useRef)({}),[p,k]=(0,n.useState)(!1),[S,I]=(0,n.useState)(!1),[C,R]=(0,n.useState)(null),[E,$]=(0,n.useState)(null),[T,N]=(0,n.useState)(null),[A,F]=(0,n.useState)(!1),[L,B]=(0,n.useState)(0),[Y,O]=(0,n.useState)(null),[X,H]=(0,n.useState)(null),[q,G]=(0,n.useState)([]),[K,V]=(0,n.useState)([]),[J,Q]=(0,n.useState)(null),[Z,ee]=(0,n.useState)(null),[te,ae]=(0,n.useState)(null),[ne,ie]=(0,n.useState)(null===e||void 0===e?void 0:e.snapType),[oe,le]=(0,n.useState)(null),[se,re]=(0,n.useState)(null),[ce,de]=(0,n.useState)(null),[ue,he]=(0,n.useState)(null),[me,ge]=(0,n.useState)(null),[ve,xe]=(0,n.useState)("default"),[pe,fe]=(0,n.useState)({width:d,height:u}),be=(0,n.useMemo)(m.qs,[]),we=e=>{k(e)},ye=e=>{const t=r.current,a=t.getBoundingClientRect();return{x:(e.clientX-a.left)*(t.width/a.width),y:(e.clientY-a.top)*(t.height/a.height)}},_e=e=>{const t=null===r||void 0===r?void 0:r.current;if(!t||null===e||void 0===e||!e.text)return 0;const a=t.getContext("2d");if(!a)return 0;a.save(),a.font=`${e.fontSize||20}px ${e.fontFamily||"Arial"}`;const n=e.text.split("\n"),i=Math.max(...n.map(e=>a.measureText(e).width));return a.restore(),i};(0,n.useEffect)(()=>{if(!E)return;const e=r.current;if(!e)return;const t=e.getContext("2d"),a=pe.width,n=pe.height;e.width=a,e.height=n;const{initialWidthRatio:i,initialHeightRatio:o}=M(E),l=Math.max(i,o),s=document.createElement("canvas");s.width=a,s.height=n;const d=s.getContext("2d");d.clearRect(0,0,a,n);let u=E;J&&X&&T&&(u=T,d.drawImage(X,0,0,a,n)),d.drawImage(u,0,0,a,n),d.globalCompositeOperation="source-over",Y&&d.drawImage(Y,0,0,a,n),q.forEach((t,a)=>{const n=t.img.width*t.scale,i=t.img.height*t.scale,o=t.x+n/2,s=t.y+i/2,r=.04*Math.max(e.width,e.height),u=.05*Math.max(e.width,e.height);if(d.save(),d.translate(o,s),d.rotate((t.rotation||0)*Math.PI/180),d.drawImage(t.img,-n/2,-i/2,n,i),a===ce){d.strokeStyle="#2b2b2b",d.lineWidth=2*l,d.setLineDash([5,3]),d.strokeRect(-n/2,-i/2,n,i),d.setLineDash([]);const e="\u2921",h=n/2,m=i/2;d.fillStyle="#000",d.beginPath(),d.arc(h-2,m-4,r,0,2*Math.PI),d.fill(),d.fillStyle="white",d.font=`bold ${24*l}px Arial`,d.textAlign="center",d.textBaseline="middle",d.fillText(e,h,m-5);const g=n/2,v=-i/2;d.beginPath(),d.fillStyle="#000",d.arc(g,v,r,0,2*Math.PI),d.fill(),d.fillStyle="#fff",d.font=`bold ${24*l}px Arial`,d.textAlign="center",d.textBaseline="middle",d.fillText("\u27f3",g+1,v-1);const x=24,p=-n/2-x/2+5,f=-i/2-x/2+8,b=((e,t,a,n,i)=>{const o=i*Math.PI/180,l=Math.cos(o),s=Math.sin(o);return{x:a+(e-a)*l-(t-n)*s,y:n+(e-a)*s+(t-n)*l}})(o+p,s+f,o,s,t.rotation||0);c.current[a]={x:b.x,y:b.y,size:x},d.beginPath(),d.arc(p+4,f+4,r,0,2*Math.PI),d.fillStyle="black",d.fill(),d.fillStyle="#fff",d.font=`bold ${u}px Arial`,d.textAlign="center",d.textBaseline="middle",d.fillText("\u2715",p+5,f+5)}d.restore()}),K.forEach((e,t)=>{var a;d.save(),d.translate(e.x,e.y),d.rotate(e.rotation*Math.PI/180),d.scale(e.scale,e.scale),d.font=`${e.fontSize*l}px ${e.fontFamily||"Arial"}`,d.textAlign=e.align||"center",d.textBaseline="middle";const n=(null===(a=e.text)||void 0===a?void 0:a.split("\n"))||[],i=n.length,o=e.fontSize*l;d.font=`${o}px ${e.fontFamily||"Arial"}`,d.textAlign=e.align||"center",d.textBaseline="middle";const s=Math.max(...n.map(e=>d.measureText(e).width)),r=1.2*o,c=15*l,u=s+2*c,m=r*i+2*c,g=u,v=m,x=-g/2;if(e.backgroundColor&&(d.fillStyle=e.backgroundColor,d.fillRect(x,-v/2,g,v)),t!==se&&(d.fillStyle=e.color||"#000000",n.forEach((e,t)=>{let a=0;"center"==d.textAlign?a=0:"left"==d.textAlign?a=-g/2+10:"right"==d.textAlign&&(a=g/2-10),d.fillText(e,a,t*r-(n.length-1)*r/2)})),t===se){d.strokeStyle="#2b2b2b",d.lineWidth=2*l,d.setLineDash([5,3]),d.strokeRect(x,-v/2,g,v),d.setLineDash([]);const a=22,n=(e.rotation||0)*Math.PI/180,i=-u/2-a/2,o=-m/2-a/2,s=e.x+i*Math.cos(n)-o*Math.sin(n),r=e.y+i*Math.sin(n)+o*Math.cos(n);h.current[t]={x:s,y:r,size:Math.max(be?15:10,a*e.scale)},d.fillStyle="black",d.beginPath(),d.arc(x,-v/2,14*l,0,2*Math.PI),d.fill(),d.fillStyle="#fff",d.font=`bold ${16*l}px Arial`,d.textAlign="center",d.textBaseline="middle",d.fillText("\u2715",x,-v/2+2),d.fillStyle="black",d.beginPath(),d.arc(x+g,-v/2,14*l,0,2*Math.PI),d.fill(),d.fillStyle="white",d.font=`bold ${24*l}px Arial`,d.textAlign="center",d.textBaseline="middle",d.fillText("\u27f3",x+g+1,-v/2-1),d.fillStyle="black",d.beginPath(),d.arc(x+g,v/2,14*l,0,2*Math.PI),d.fill(),d.fillStyle="white",d.font=`bold ${24*l}px Arial`,d.textAlign="center",d.textBaseline="middle",d.fillText("\u2921",x+g,v/2)}d.restore()}),t.clearRect(0,0,a,n),t.drawImage(s,0,0)},[E,T,Y,q,ce,K,se,X,A,pe,ne]),(0,n.useEffect)(()=>{if(!J)return void H(null);const t=new Image;t.crossOrigin="anonymous",t.src=`https://cdn.taggbox.com/v7/${J}?v=2.3`,we(!!T),t.onload=async()=>{if(!T){var a,n,i,o;I(!0);const t=await(async(e,t)=>{try{var a,n;if(!t)return e;const i=await x(e,`photo-booth-${t}.png`),o=new FormData;o.append("media",i);const l=await(new v.A).post(`${g.M_}/${t}`,o,{headers:{"Content-Type":"multipart/form-data"}});return null!==(a=null===l||void 0===l||null===(n=l.data)||void 0===n?void 0:n.responseData)&&void 0!==a?a:null}catch(i){return e}})(null!==(a=null===E||void 0===E?void 0:E.src)&&void 0!==a?a:"",null!==(n=null===e||void 0===e||null===(i=e.wall)||void 0===i||null===(o=i.Wall)||void 0===o?void 0:o.owner)&&void 0!==n?n:"");if(t){const e=new Image;e.crossOrigin="anonymous",e.src=`https://cdn.taggbox.com/v7/${t}?v=2.3`,e.onload=()=>{N(e),I(!1)},e.onerror=()=>{N(null),I(!1),console.error(`Failed to load background transparent image: ${J}`)}}}H(t),we(!1)},t.onerror=()=>{console.error(`Failed to load background image: ${J}`),we(!1)}},[J]),(0,n.useEffect)(()=>{if(!Z)return void O(null);const e=new Image;e.crossOrigin="anonymous",e.src=`https://cdn.taggbox.com/v7/${Z}?v=2.3`,we(!0),e.onload=()=>{O(e),we(!1)},e.onerror=()=>{console.error(`Failed to load frame image: ${Z}`),we(!1)}},[Z]),(0,n.useEffect)(()=>{let e=0,t=!1;const a=[".pb_tabs_content_box",".pb_photo_booth_h_review"],n=n=>{e=n.touches[0].clientY;const i=n.target.closest(a.join(","));t=!!i},i=a=>{if(t)return;const n=document.documentElement.scrollTop||document.body.scrollTop,i=a.touches[0].clientY-e;0===n&&i>0&&a.preventDefault()};return document.addEventListener("touchstart",n,{passive:!1}),document.addEventListener("touchmove",i,{passive:!1}),()=>{document.removeEventListener("touchstart",n),document.removeEventListener("touchmove",i)}},[]);const je=(e,t)=>{ie(e),ae(t),B(0)};return(0,o.jsx)("div",{className:"pb_photo_booth_main",children:(0,o.jsx)("div",{className:"pb_photo_booth_box",children:(0,o.jsxs)("div",{className:"pb_photo_booth_box_inner",children:[(0,o.jsx)(z,{snapType:e.snapType,rawImage:C,capturedImage:E,uploadImg:te,uploadType:ne,wall:null===e||void 0===e?void 0:e.wall,backAction:()=>{A?(R(E),te&&!L?(F(!0),B(1),ie(3),R(0)):(F(!1),B(0))):(F(!1),R(null),ie(C?te&&2===ne?3:ne:null===e||void 0===e?void 0:e.snapType))}}),(0,o.jsx)("div",{className:"pb_photo_booth_h "+(2===ne?"pb_photo_booth_h_review":""),children:1==ne?(0,o.jsx)(l,{uploadFile:je}):(0,o.jsx)(o.Fragment,{children:2===ne?(0,o.jsx)(D.default,{isPhotoBooth:te,photoBoothInterface:1,wall:null===e||void 0===e?void 0:e.wall,wallId:null===e||void 0===e||null===(t=e.wall)||void 0===t||null===(a=t.Wall)||void 0===a?void 0:a.id,feeds:null===e||void 0===e?void 0:e.feeds,isFreeAdsStatus:null===e||void 0===e?void 0:e.isFreeAdsStatus}):A?(0,o.jsx)(P,{loading:p,capturedImage:E,uploadFile:je,canvasRef:r,canvasCursor:ve,selectedBg:J,setSelectedBg:Q,selectedFrame:Z,setSelectedFrame:ee,addSticker:e=>{const t=new Image;t.crossOrigin="anonymous",we(!0),t.src=`https://cdn.taggbox.com/v7/${e}?v=2.3`,t.onload=()=>{we(!1);const a=pe.width,n=pe.height,i=a/(be?4:3),o=t.height/t.width*i,l=i/t.width;t.height=t.height*l,t.width=t.width*l,re(null),G(l=>{const s=[...l,{img:t,x:a/2-i/2,y:n/2-o/2,scale:1,url:e,rotation:0}];return de(s.length-1),s})},t.onerror=()=>{we(!1),console.error(`Failed to load sticker image: ${e}`)}},addTextElement:()=>{const e={text:"Your Text Here",x:pe.width/2,y:pe.height/2,scale:1,rotation:0,fontSize:28,fontFamily:"Georgia",color:"#000000",backgroundColor:"white",align:"center"};de(null),V(t=>{const a=[...t,e];return re(a.length-1),a})},onMouseDown:e=>{const{x:t,y:a}=ye(e);let n=!1,i=!1;for(let s=q.length-1;s>=0;s--){const e=q[s],{initialHeightRatio:i,initialWidthRatio:o}=M(E),l=c.current[s];if(l){const{x:n,y:r,size:c}=l,d=t-n,u=a-r,h=Math.sqrt(d*d+u*u),m=Math.max(c,5*(o+i));if(!(t>=e.x&&t<=e.x+n&&a>=e.y&&a<=e.y+r)&&h<=m*(be?1.5:1))return G(e=>e.filter((e,t)=>t!==s)),void de(null)}if(w(e,t,a,E)){de(s),he("rotate"),ge({x:t,y:a,centerX:e.x+e.img.width*e.scale/2,centerY:e.y+e.img.height*e.scale/2,initialAngle:e.rotation||0}),n=!0;break}if(f(e,t,a,E)){de(s),he("resize"),ge({x:t,y:a,initialScale:e.scale,initialWidth:e.img.width}),n=!0;break}if(b(e,t,a)){de(s),he("move"),ge({x:t,y:a,initialX:e.x,initialY:e.y}),n=!0;break}}if(!n){const{initialHeightRatio:e,initialWidthRatio:n}=M(E);for(let s=K.length-1;s>=0;s--){var o;const r=K[s],c=_e(r),d=null===(o=h.current)||void 0===o?void 0:o[s];if(d){const{x:i,y:o,size:l}=d,r=K[s].scale||1,u=t-i,h=a-o;let m=1;r<.5?m=3.5:r<.6?m=3:r<.7?m=2.4:r<.8?m=1.9:r<.93&&(m=1.6);if(Math.sqrt(u*u+h*h)/m<Math.max(l,.02*c*r*(2*(n+e))))return V(e=>e.filter((e,t)=>t!==s)),re(null),void le(null)}if(j(r,t,a,c,E)){re(s),le(null),he("rotate-text"),ge({x:t,y:a,centerX:r.x,centerY:r.y,initialAngle:r.rotation||0}),i=!0;break}if(_(r,t,a,c,E)){le(null),re(s),de(null),he("resize-text"),ge({x:t,y:a,initialScale:r.scale,initialWidth:c}),i=!0;break}if(y(r,t,a,c,E)){var l;le({index:s,count:se==s?(null===oe||void 0===oe?void 0:oe.count)>=2?2:(null!==(l=null===oe||void 0===oe?void 0:oe.count)&&void 0!==l?l:0)+1:1}),re(s),he("move-text"),ge({x:t,y:a,initialX:r.x,initialY:r.y}),i=!0;break}}}n||i||(de(null),re(null),he(null),ge(null),le(null))},onMouseMove:e=>{const{x:t,y:a}=ye(e);let n="default",i=!1;for(let s=K.length-1;s>=0;s--){const e=K[s],o=_e(e);if(j(e,t,a,o,E)){n="crosshair",i=!0;break}if(_(e,t,a,o,E)){n="nwse-resize",i=!0;break}if(y(e,t,a,o,E)){n="grab",i=!0;break}}if(!i)for(let s=q.length-1;s>=0;s--){const e=q[s];if(w(e,t,a,E)){n="crosshair",i=!0;break}if(f(e,t,a,E)){n="nwse-resize",i=!0;break}if(b(e,t,a)){n="grab",i=!0;break}}if("move"!==ue||null===ce&&null===se||(n="grabbing"),xe(n),!ue||!me)return;const o=t-me.x,l=a-me.y;null!==ce&&G(e=>{const n=[...e],i={...n[ce]};if("move"===ue)i.x=me.initialX+o,i.y=me.initialY+l;else if("resize"===ue){const e=me.initialWidth*me.initialScale+o,t=Math.max(.05,e/i.img.width);i.scale=t}else if("rotate"===ue){const e=Math.atan2(me.y-me.centerY,me.x-me.centerX),n=180*(Math.atan2(a-me.centerY,t-me.centerX)-e)/Math.PI;i.rotation=(me.initialAngle+n)%360}return n[ce]=i,n}),null!==se&&V(e=>{const n=[...e],i={...n[se]};if("move-text"===ue)i.x=me.initialX+o,i.y=me.initialY+l;else if("resize-text"===ue){const e=me.initialWidth*me.initialScale+o,t=Math.max(.1,e/_e(i));i.scale=t}else if("rotate-text"===ue){const e=Math.atan2(me.y-me.centerY,me.x-me.centerX),n=180*(Math.atan2(a-me.centerY,t-me.centerX)-e)/Math.PI;i.rotation=(me.initialAngle+n)%360}return n[se]=i,n})},onMouseUp:()=>{he(null),ge(null),xe("default")},canvasElements:K,setCanvasElements:V,activeTextIndex:se,photoBoothSettings:null!==(i=null===e||void 0===e||null===(s=e.wall)||void 0===s?void 0:s.PhotoBoothSettings)&&void 0!==i?i:{},selectedStickers:q,setActiveStickerIndex:de,setActiveTextIndex:re,activeText:oe}):(0,o.jsx)(W,{uploadType:ne,rawImage:C,takePhoto:async(e,t)=>{if(!e)return void console.error("Failed to capture screenshot from webcam.");const a=new Image;a.crossOrigin="anonymous",a.src=e,a.onload=async()=>{N(null),t?R(a):$(a),fe({width:a.width,height:a.height})},a.onerror=()=>{console.error("Failed to load captured image.")}},canvasRef:r,canvasCursor:ve,setRawImage:R,customisePhoto:()=>{R(null),O(null),H(null),G([]),V([]),Q(null),ee(null),re(null),de(null),F(!0)}})})}),S?(0,o.jsx)(U,{}):null]})})})}}}]);