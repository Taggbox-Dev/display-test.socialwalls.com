"use strict";(self.webpackChunkembed_widget=self.webpackChunkembed_widget||[]).push([[7049,9430],{84433:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Y});var a=n(9950),o=n(22332),i=n(80415),l=n(44414);function s(e){let{uploadFile:t}=e;return(0,l.jsx)("div",{className:"pb_cards",children:(0,l.jsxs)("div",{className:"pb_cards_box",children:[(0,l.jsxs)("div",{onClick:()=>t(3),className:"pb_card",children:[(0,l.jsx)("div",{className:"pb_card_icon",children:(0,l.jsx)("img",{src:`${i.on}images/photobooth/camera.svg`,alt:"camera"})}),(0,l.jsx)("h3",{className:"pb_card-title",children:"Photobooth"}),(0,l.jsx)("p",{className:"pb_card-description",children:" Add fun stickers and backgrounds before sharing your masterpiece."})]}),(0,l.jsxs)("div",{onClick:()=>t(2),className:"pb_card",children:[(0,l.jsx)("div",{className:"pb_card_icon",children:(0,l.jsx)("img",{src:`${i.on}images/photobooth/snapup.svg`,alt:"snapup"})}),(0,l.jsx)("h3",{className:"pb_card-title",children:"Snap & Share"}),(0,l.jsx)("p",{className:"pb_card-description",children:"Upload your photos in one go without logging into your social media accounts."})]})]})})}const r=e=>{let{className:t,children:n,icon:a,onClick:o}=e;return(0,l.jsxs)("button",{className:t,onClick:o,children:[a&&(0,l.jsx)("img",{src:`${i.on}images/photobooth/${a}.svg`,alt:a}),n]})};var c=n(11766),d=n.n(c);const h=320,u=320,m=[{id:"background",label:"Background"},{id:"frame",label:"Frames"},{id:"sticker",label:"Stickers"},{id:"text",label:"Text"}];var g=n(52867);const x=e=>{let{rawImage:t,cameraPermission:n,capturedImage:o,mode:s,counter:r,canvasRef:c,canvasCursor:m,webcamRef:x,onMouseDown:v,onMouseMove:f,onMouseUp:p,canvasElements:b,activeTextIndex:w,setCanvasElements:y,loading:S}=e;const[M,k]=(0,a.useState)("environment"),[j,_]=(0,a.useState)(Math.random()),I=e=>e?e.split("\n").length:1,C=(0,a.useMemo)(g.qs,[]),T=e=>{const t=e.target.value;if((null===t||void 0===t?void 0:t.length)<=35){const e=(e=>{if(!c.current||!b[w])return e;const t=b[w],n=document.createElement("canvas").getContext("2d"),a=t.fontSize||16,o=t.fontFamily||"Arial";n.font=`${a}px ${o}`;const i=e.split(/\s+/);let l="",s="";for(let r=0;r<i.length;r++){const e=i[r],t=l?l+" "+e:e,{width:a}=n.measureText(t);a>280&&l?(s+=l+"\n",l=e):l=t}return l&&(s+=l),s})(t);y(t=>t.map((t,n)=>n===w?{...t,text:e}:t))}},$=(0,a.useCallback)(e=>{if(!e||!e.text)return 0;const t=document.createElement("canvas").getContext("2d"),n=e.fontSize||16,a=e.fontFamily||"Arial",o=e.scale||1;t.font=`${n}px ${a}`;const i=e.text.split("\n");let l=0;for(const s of i){const e=t.measureText(s).width;e>l&&(l=e)}return l*o},[b]);(0,a.useEffect)(()=>((async()=>{try{setTimeout(()=>{_(Date.now())},2e3)}catch(e){console.error("Error starting camera:",e)}})(),()=>E()),[]);const E=()=>{setTimeout(()=>{var e;null!==x&&void 0!==x&&x.current&&((null===x||void 0===x||null===(e=x.current)||void 0===e?void 0:e.stream)&&x.current.stream.getTracks().forEach(e=>e.stop()))},1e3)},N=(0,a.useCallback)(()=>{k(e=>"user"===e?"environment":"user"),_(e=>e+1)},[]);return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:"pb_user_photo "+(S?"active_blur":""),style:{position:"relative",display:t?"none":o||"granted"===n?"flex":"none"},children:["capture"!==s||o?o?(0,l.jsx)("canvas",{ref:c,style:{cursor:m},width:h,height:u,onMouseDown:v,onMouseMove:f,onMouseUp:p,onMouseLeave:p,onTouchStart:function(e){const t=e.type.startsWith("touch");e.preventDefault();const n=e.touches[0],a={clientX:n.clientX,clientY:n.clientY};v(a,t)},onTouchMove:function(e){e.preventDefault();const t=e.touches[0],n={clientX:t.clientX,clientY:t.clientY};f(n)},onTouchEnd:function(e){e.preventDefault(),p()}}):(0,l.jsx)("img",{src:`${i.on}images/photobooth/avatar.png?v=1.0.1`,alt:"default-avatar",width:h,height:u}):(0,l.jsx)(d(),{ref:x,screenshotFormat:"image/png",width:h,height:u,videoConstraints:{facingMode:M,width:h,height:u},mirrored:"user"===M,onUserMedia:()=>console.log("Webcam stream started:",M),style:{objectFit:"cover",borderRadius:"8px"}},`${j}-${M}`),null===b||void 0===b?void 0:b.map((e,t)=>w===t&&(0,l.jsx)("textarea",{id:`text-${t}`,name:`text-${t}`,value:e.text,onChange:T,wrap:"hard",style:{position:"absolute",top:e.y-(e.fontSize*e.scale*I(e.text)+10)/2+"px",left:e.x-$(e)/2-(C?3:0)+"px",width:`${$(e)}px`,height:e.fontSize*e.scale*I(e.text)+6+"px",fontSize:e.fontSize*e.scale+"px",fontFamily:e.fontFamily||"Arial",transform:`rotate(${e.rotation||0}deg)`,textAlign:e.align||"center",transformOrigin:"center center",background:e.backgroundColor||"transparent",color:e.color||"#000",overflow:"hidden",border:"none",outline:"none",padding:0,maxWidth:"300px",wordBreak:"break-word",whiteSpace:"pre-wrap",overflowWrap:"break-word",resize:"none"}},t)),C&&!o?(0,l.jsx)("button",{onClick:N,children:(0,l.jsx)("img",{src:`${i.on}images/photobooth/camera-flip.svg`,alt:"flip-camera"})}):null,r?(0,l.jsxs)("div",{className:"pb_viewframe",children:[(0,l.jsx)("img",{src:`${i.on}images/photobooth/viewframe-white@3x.svg`,alt:"viewframe"})," ",(0,l.jsx)("span",{children:r})]}):null]})})},v=a.memo(x),f=e=>{let{addSticker:t,loading:n,stickers:a,selectedStickers:o}=e;return(0,l.jsx)("div",{className:"pb_list_items pb_stickers",children:a.map((e,a)=>{const i=null===o||void 0===o?void 0:o.find(t=>(null===t||void 0===t?void 0:t.url)==e);return(0,l.jsx)("img",{onClick:n?null:()=>t(e),style:{cursor:n?"not-allowed":"pointer"},className:i?"active":"",src:`${e}?v=2.1`,alt:"sticker",width:64,height:64},a)})})},p=["font","align","color","bg"],b=["Arial","Helvetica","Times New Roman","Georgia","Courier New","Verdana","Tahoma","Trebuchet MS","Comic Sans MS","Impact","Lucida Console","Roboto","Open Sans"],w=["left","center","right"],y=["white","black","transparent"],S=e=>{let{canvasElements:t,setCanvasElements:n,activeTextIndex:a}=e;return(0,l.jsx)("div",{className:"pb_text",children:p.map(e=>{var o,s;return(0,l.jsxs)("div",{className:"pb_text_box",children:[(0,l.jsx)("img",{src:`${i.th}/media/images/photobooth/text/${e}.png?v=1`,alt:e,onClick:()=>(e=>{if(null!==a){const d={};if("align"===e){var o,i;const e=null!==(o=null===(i=t[a])||void 0===i?void 0:i.align)&&void 0!==o?o:"center",n=w.find(t=>t===e);d.align=w[(w.indexOf(n)+1)%w.length]}else if("bg"===e){var l,s;const e=null!==(l=null===(s=t[a])||void 0===s?void 0:s.backgroundColor)&&void 0!==l?l:"transparent",n=y.find(t=>t===e);d.backgroundColor=y[(y.indexOf(n)+1)%y.length]}else if("font"===e){var r,c;const e=null!==(r=null===(c=t[a])||void 0===c?void 0:c.fontFamily)&&void 0!==r?r:"Arial",n=b.find(t=>t===e);d.fontFamily=b[(b.indexOf(n)+1)%b.length]}n(e=>e.map((e,t)=>t===a?{...e,...d}:e))}})(e)}),(0,l.jsx)("p",{children:e}),"color"===e&&(0,l.jsx)("input",{type:"color",value:null!==(o=null===(s=t[a])||void 0===s?void 0:s.color)&&void 0!==o?o:"black",onChange:e=>{const t=e.target.value;n(e=>e.map((e,n)=>n===a?{...e,color:t}:e))}})]},e)})})},M=e=>{let{loading:t,imgUrl:n,imgList:a,setImgUrl:o,tabKey:s}=e;return(0,l.jsx)("div",{className:`pb_list_items pb_${s}`,children:[`${i.th}/media/images/photobooth/${s}/none.png`,...a].map((e,a)=>{const i=n?n===e:0===a;return(0,l.jsx)("img",{style:{cursor:t?"not-allowed":"pointer"},src:`${e}?v=2.1`,alt:`img-${a}`,className:i?"active":"",width:64,height:64,onClick:t?null:()=>o(0==a?null:e)},a)})})},k=e=>{let{capturedImage:t,uploadFile:n,canvasRef:o,canvasCursor:s,selectedBg:c,setSelectedBg:d,selectedFrame:h,setSelectedFrame:u,addSticker:x,addTextElement:p,onMouseDown:b,onMouseMove:w,onMouseUp:y,canvasElements:k,setCanvasElements:j,activeTextIndex:_,loading:I,selectedStickers:C,photoBoothSettings:T,setActiveStickerIndex:$,setActiveTextIndex:E}=e;const[N,A]=(0,a.useState)("background"),[P,F]=(0,a.useState)([]),[z,B]=(0,a.useState)([]),[R,Y]=(0,a.useState)([]);return(0,a.useEffect)(()=>{"text"===N&&p(),"text"!==N?E(null):"sticker"!==N&&$(null)},[N]),(0,a.useEffect)(()=>{const e=(0,g.S3)((null===T||void 0===T?void 0:T.photo_booth_frames)||[]),t=(0,g.S3)((null===T||void 0===T?void 0:T.photo_booth_backgrounds)||[]),n=(0,g.S3)((null===T||void 0===T?void 0:T.photo_booth_stickers)||[]);B(null===e||void 0===e?void 0:e.map(e=>`${i.on}images/photobooth/frames/${e}`)),F(null===t||void 0===t?void 0:t.map(e=>`${i.on}images/photobooth/backgrounds/${e}`)),Y(null===n||void 0===n?void 0:n.map(e=>`${i.on}images/photobooth/stickers/${e}`))},[]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"pb_customization",children:[(0,l.jsx)(v,{loading:I,capturedImage:t,canvasRef:o,canvasCursor:s,onMouseDown:b,onMouseMove:w,onMouseUp:y,canvasElements:k,activeTextIndex:_,setCanvasElements:j}),(0,l.jsxs)("div",{className:"pb_tabs",children:[(0,l.jsx)("div",{className:"pb_tabs_list",children:m.map(e=>(0,l.jsx)("button",{onClick:()=>A(e.id),className:N===e.id?"active":"",children:e.label},e.id))}),(0,l.jsx)("div",{className:"pb_tabs_content",children:(0,l.jsx)("div",{className:"pb_tabs_content_box",children:"background"===N?(0,l.jsx)(M,{loading:I,imgUrl:c,imgList:P,setImgUrl:d,tabKey:"backgrounds"}):"frame"===N?(0,l.jsx)(M,{imgUrl:h,imgList:z,setImgUrl:u,tabKey:"frames"}):"sticker"===N?(0,l.jsx)(f,{stickers:R,addSticker:x,loading:I,selectedStickers:C}):"text"===N?(0,l.jsx)(S,{canvasElements:k,setCanvasElements:j,activeTextIndex:_}):null})})]})]}),(0,l.jsx)("div",{className:"pb_continue_buttons_main",children:(0,l.jsx)(r,{className:"pb_continue_buttons",children:"Continue",onClick:()=>{if(null!==o&&void 0!==o&&o.current){const e=o.current;$(null),E(null),setTimeout(()=>{const t=e.toDataURL("image/png");t&&n(2,t)},100)}}})})]})};var j=n(66345);function _(e){const{snapType:t,uploadType:n,rawImage:a,capturedImage:o,wall:s,uploadImg:r,backAction:c}=e,d=1===t&&1===n||3===t&&!a&&!o;return(0,l.jsxs)("div",{className:"pb_header_bar",onClick:d?()=>window.location.href=`${j.EP}${s.Wall.id}?social-wall=true`:c,children:[(0,l.jsx)("img",{src:`${i.th}/media/images/photobooth/arrow-back.svg`,alt:"arrow-back"}),2==n&&r?(0,l.jsx)("img",{className:"pb_header_logo",src:s.PhotoBoothSettings.photo_booth_logo,height:20,width:130,alt:""}):(0,l.jsx)("span",{className:"header-title",children:d?"Back to Wall":"Back"})]})}function I(){const e=(0,a.useRef)(null),[t,n]=(0,a.useState)(null),[o,i]=(0,a.useState)("environment"),s=async function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o;try{t&&t.getTracks().forEach(e=>e.stop());const o=await navigator.mediaDevices.getUserMedia({video:{facingMode:a}});n(o),e.current&&(e.current.srcObject=o,await e.current.play())}catch(i){console.error("Camera error:",i)}};return(0,l.jsxs)("div",{children:[(0,l.jsx)("button",{onClick:()=>s(),children:"\ud83d\udcf7 Start Camera"}),(0,l.jsx)("button",{onClick:()=>{const e="user"===o?"environment":"user";i(e),s(e)},children:"\ud83d\udd04 Switch Camera"}),(0,l.jsx)("br",{}),(0,l.jsx)("video",{ref:e,style:{width:"100%",maxHeight:"400px"},playsInline:!0,muted:!0}),(0,l.jsx)("br",{}),(0,l.jsx)("button",{onClick:()=>{if(!e.current||!t)return;const n=t.getVideoTracks()[0].getSettings();console.log("\ud83d\udcf7 Native resolution:",n.width,"x",n.height);const a=document.createElement("canvas");a.width=n.width,a.height=n.height;a.getContext("2d").drawImage(e.current,0,0,a.width,a.height);const o=a.toDataURL("image/jpeg",1);return console.log("Base64 Image:",o),o},children:"\ud83d\udcf8 Capture"})]})}const C=(e,t,n)=>{const a=e.img.width*e.scale,o=e.img.height*e.scale,i=(e.rotation||0)*Math.PI/180,l=e.x+a/2,s=e.y+o/2,r=a/2,c=o/2,d=t-(l+(r*Math.cos(i)-c*Math.sin(i))),h=n-(s+(r*Math.sin(i)+c*Math.cos(i)));return Math.sqrt(d*d+h*h)<=P(15,7)/2},T=(e,t,n)=>{const a=e.img.width*e.scale,o=e.img.height*e.scale;return t>e.x&&t<e.x+a&&n>e.y&&n<e.y+o},$=(e,t,n)=>{const{img:a,scale:o,x:i,y:l,rotation:s=0}=e,r=a.width*o,c=a.height*o,d=i+r/2,h=l+c/2,u=r/2,m=-c/2-5,g=s*Math.PI/180,x=t-(d+u*Math.cos(g)-m*Math.sin(g)),v=n-(h+u*Math.sin(g)+m*Math.cos(g));return Math.sqrt(x*x+v*v)<=P(7,7)},E=(e,t,n,a)=>{const o=e.scale||1,i=e.fontSize||20,l=20*a,s=e.text.split("\n").length*i*o+20,r=e.x,c=e.y,d=(0,g.qs)()?o>0?20/o:20:0,h=t-r,u=n-c,m=(e.rotation||0)*Math.PI/180,x=Math.cos(-m),v=Math.sin(-m),f=(h*x-u*v)/o,p=(h*v+u*x)/o;return f>=-l/(2*o)&&f<=l/(2*o)&&p>=-s/(2*o)-d&&p<=s/(2*o)+d},N=(e,t,n,a)=>{var o;const i=e.scale||1,l=e.fontSize||20,s=(null===(o=e.text)||void 0===o?void 0:o.split("\n"))||[],r=1.2*l*Math.max(s.length,1)*i+20,c=a*i+20,d=P(16),h=e.x,u=e.y,m=c/2,g=r/2,x=(e.rotation||0)*Math.PI/180,v=t-(h+m*Math.cos(x)-g*Math.sin(x)),f=n-(u+m*Math.sin(x)+g*Math.cos(x));return v*v+f*f<(d/2)**2},A=(e,t,n,a)=>{var o;const i=e.scale||1,l=e.fontSize||20,s=P(16),r=e.x,c=e.y,d=(null===(o=e.text)||void 0===o?void 0:o.split("\n"))||[],h=(a*i+20)/2,u=-(1.2*l*Math.max(d.length,1)*i+20)/2,m=(e.rotation||0)*Math.PI/180,g=t-(r+h*Math.cos(m)-u*Math.sin(m)),x=n-(c+h*Math.sin(m)+u*Math.cos(m));return g*g+x*x<(s/2)**2},P=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,g.qs)()?2*e+t:e};var F=n(48768);const z="Your Text Here";let B,R=!1;const Y=e=>{var t,n,i,r;const c=(0,a.useRef)(null),d=(0,a.useRef)({}),m=(0,a.useRef)({}),[x,v]=(0,a.useState)(!1),[f,p]=(0,a.useState)(null),[b,w]=(0,a.useState)(null),[y,S]=(0,a.useState)(!1),[M,j]=(0,a.useState)(0),[P,Y]=(0,a.useState)(null),[D,U]=(0,a.useState)(null),[L,X]=(0,a.useState)(null),[O,W]=(0,a.useState)([]),[q,H]=(0,a.useState)([]),[K,G]=(0,a.useState)(null),[V,J]=(0,a.useState)(null),[Q,Z]=(0,a.useState)(null),[ee,te]=(0,a.useState)(null===e||void 0===e?void 0:e.snapType),[ne,ae]=(0,a.useState)(null),[oe,ie]=(0,a.useState)(null),[le,se]=(0,a.useState)(null),[re,ce]=(0,a.useState)(null),[de,he]=(0,a.useState)("default"),[ue,me]=(0,a.useState)({width:h,height:u}),ge=(0,a.useMemo)(g.qs,[]),xe=e=>{v(e)},ve=e=>{const t=c.current,n=t.getBoundingClientRect();return{x:(e.clientX-n.left)*(t.width/n.width),y:(e.clientY-n.top)*(t.height/n.height)}},fe=e=>{const t=null===c||void 0===c?void 0:c.current;if(!t||null===e||void 0===e||!e.text)return 0;const n=t.getContext("2d");if(!n)return 0;n.save(),n.font=`${e.fontSize||20}px ${e.fontFamily||"Arial"}`;const a=e.text.split("\n"),o=Math.max(...a.map(e=>n.measureText(e).width));return n.restore(),o};(0,a.useEffect)(()=>{if(!b||!P)return;const e=c.current;if(!e)return;const t=e.getContext("2d"),n=ue.width,a=ue.height;e.width=n,e.height=a;const o=document.createElement("canvas");o.width=n,o.height=a;const i=o.getContext("2d");if(i.clearRect(0,0,n,a),K&&L){const e=document.createElement("canvas");e.width=n,e.height=a;const t=e.getContext("2d");t.drawImage(b,0,0,n,a),t.globalCompositeOperation="destination-in",t.drawImage(P,0,0,n,a),t.globalCompositeOperation="source-over",i.drawImage(L,0,0,n,a),i.drawImage(e,0,0,n,a)}else i.drawImage(b,0,0,n,a);i.globalCompositeOperation="source-over",D&&i.drawImage(D,0,0,n,a),O.forEach((e,t)=>{const n=e.img.width*e.scale,a=e.img.height*e.scale,o=e.x+n/2,l=e.y+a/2;if(i.save(),i.translate(o,l),i.rotate((e.rotation||0)*Math.PI/180),i.drawImage(e.img,-n/2,-a/2,n,a),t===oe){i.strokeStyle="#2b2b2b",i.lineWidth=2,i.setLineDash([5,3]),i.strokeRect(-n/2,-a/2,n,a),i.setLineDash([]);const s=10,r="\u2921",c=n/2,h=a/2;i.fillStyle="#000",i.beginPath(),i.arc(c,h,s,0,2*Math.PI),i.fill(),i.fillStyle="white",i.font="bold 16px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText(r,c,h);const u=n/2,m=-a/2,g=10;i.beginPath(),i.fillStyle="#000",i.arc(u,m,g,0,2*Math.PI),i.fill(),i.fillStyle="#fff",i.font="bold 16px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("\u27f3",u,m);const x=22,v=-n/2-x/2+5,f=-a/2-x/2+8;d.current[t]={x:o+v*Math.cos(e.rotation*Math.PI/180)-f*Math.sin(e.rotation*Math.PI/180),y:l+v*Math.sin(e.rotation*Math.PI/180)+f*Math.cos(e.rotation*Math.PI/180),size:x},i.beginPath(),i.arc(v+5,f+5,10,0,2*Math.PI),i.fillStyle="black",i.fill(),i.fillStyle="#fff",i.font="bold 9px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("\u2715",v+5,f+5)}i.restore()}),q.forEach((e,t)=>{var n;i.save(),i.translate(e.x,e.y),i.rotate(e.rotation*Math.PI/180),i.scale(e.scale,e.scale),i.font=`${e.fontSize}px ${e.fontFamily||"Arial"}`,i.textAlign=e.align||"center",i.textBaseline="middle";const a=(null===(n=e.text)||void 0===n?void 0:n.split("\n"))||[""],o=Math.max(...a.map(e=>i.measureText(e).width)),l=a.length,s=e.fontSize*e.scale,r=o+20,c=s*l+10,d=1.2*s,h=o+20,u=s*a.length+30,g=-h/2;if(e.backgroundColor&&(i.fillStyle=e.backgroundColor,i.fillRect(g,-u/2,h,u)),t!==ne&&(i.fillStyle=e.color||"#000000",a.forEach((e,t)=>{let n=0;"center"==i.textAlign?n=0:"left"==i.textAlign?n=-h/2+10:"right"==i.textAlign&&(n=h/2-10),i.fillText(e,n,t*d-(a.length-1)*d/2)})),t===ne){const n=document.getElementById(`text-${ne}`);R&&n&&(n.focus(),n&&e.text==z&&n.select()),i.strokeStyle="#2b2b2b",i.lineWidth=2,i.setLineDash([5,3]),i.strokeRect(g,-u/2,h,u),i.setLineDash([]);const a=22,o=(e.rotation||0)*Math.PI/180,l=-r/2-a/2,s=-c/2-a/2,d=e.x+l*Math.cos(o)-s*Math.sin(o),x=e.y+l*Math.sin(o)+s*Math.cos(o);m.current[t]={x:d,y:x,size:Math.max(ge?15:10,a*e.scale)},i.fillStyle="black",i.beginPath(),i.arc(g,-u/2,11,0,2*Math.PI),i.fill(),i.fillStyle="#fff",i.font="bold 10px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("\u2715",g,-u/2),i.fillStyle="black",i.beginPath(),i.arc(g+h,-u/2,11,0,2*Math.PI),i.fill(),i.fillStyle="white",i.font="bold 14px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("\u27f3",g+h,-u/2),i.fillStyle="black",i.beginPath(),i.arc(g+h,u/2,11,0,2*Math.PI),i.fill(),i.fillStyle="white",i.font="bold 14px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("\u2921",g+h,u/2)}i.restore()}),t.clearRect(0,0,n,a),t.drawImage(o,0,0)},[b,P,D,O,oe,q,ne,R,L,y,ue,ee]),(0,a.useEffect)(()=>{if(!K)return void X(null);const e=new Image;e.crossOrigin="anonymous",e.src=`https://cdn.taggbox.com/v7/${K}?v=2.1`,xe(!0),e.onload=()=>{X(e),xe(!1)},e.onerror=()=>{console.error(`Failed to load background image: ${K}`),xe(!1)}},[K]),(0,a.useEffect)(()=>{if(!V)return void U(null);const e=new Image;e.crossOrigin="anonymous",e.src=`https://cdn.taggbox.com/v7/${V}?v=2.1`,xe(!0),e.onload=()=>{U(e),xe(!1)},e.onerror=()=>{console.error(`Failed to load frame image: ${V}`),xe(!1)}},[V]),(0,a.useEffect)(()=>{let e=0;const t=t=>{e=t.touches[0].clientY},n=t=>{const n=document.documentElement.scrollTop||document.body.scrollTop,a=t.touches[0].clientY-e;0===n&&a>0&&t.preventDefault()};return document.addEventListener("touchstart",t,{passive:!1}),document.addEventListener("touchmove",n,{passive:!1}),()=>{document.removeEventListener("touchstart",t),document.removeEventListener("touchmove",n)}},[]);const pe=(e,t)=>{te(e),Z(t),j(0)};return(0,l.jsx)("div",{className:"pb_photo_booth_main",children:(0,l.jsx)("div",{className:"pb_photo_booth_box",children:(0,l.jsxs)("div",{className:"pb_photo_booth_box_inner",children:[(0,l.jsx)(_,{snapType:e.snapType,rawImage:f,capturedImage:b,uploadImg:Q,uploadType:ee,wall:null===e||void 0===e?void 0:e.wall,backAction:()=>{y?(p(b),Q&&!M?(S(!0),j(1),te(3),p(0)):(S(!1),j(0))):(S(!1),p(null),te(f?Q&&2===ee?3:ee:null===e||void 0===e?void 0:e.snapType))}}),(0,l.jsx)("div",{className:"pb_photo_booth_h "+(2===ee?"pb_photo_booth_h_review":""),children:1==ee?(0,l.jsx)(s,{uploadFile:pe}):(0,l.jsx)(l.Fragment,{children:2===ee?(0,l.jsx)(F.default,{isPhotoBooth:Q,photoBoothInterface:1,wall:null===e||void 0===e?void 0:e.wall,wallId:null===e||void 0===e||null===(t=e.wall)||void 0===t||null===(n=t.Wall)||void 0===n?void 0:n.id,feeds:null===e||void 0===e?void 0:e.feeds,isFreeAdsStatus:null===e||void 0===e?void 0:e.isFreeAdsStatus}):y?(0,l.jsx)(k,{loading:x,capturedImage:b,uploadFile:pe,canvasRef:c,canvasCursor:de,selectedBg:K,setSelectedBg:G,selectedFrame:V,setSelectedFrame:J,addSticker:e=>{const t=new Image;t.crossOrigin="anonymous",xe(!0),t.src=`https://cdn.taggbox.com/v7/${e}?v=2.1`,t.onload=()=>{xe(!1);const n=ue.width,a=ue.height,o=t.height/t.width*100,i=100/t.width;ae(null),W(l=>{const s=[...l,{img:t,x:n/2-50,y:a/2-o/2,scale:i,url:e,rotation:0}];return ie(s.length-1),s})},t.onerror=()=>{xe(!1),console.error(`Failed to load sticker image: ${e}`)}},addTextElement:()=>{const e=ue.width,t=ue.height,n={text:z,x:e/2,y:t/2,scale:1,rotation:0,fontSize:28,fontFamily:"Georgia",color:"#000000",backgroundColor:"white",align:"center"};ie(null),H(e=>{const t=[...e,n];return ae(t.length-1),t})},onMouseDown:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{x:n,y:a}=ve(e);let o=!1,i=!1;for(let s=O.length-1;s>=0;s--){const e=O[s],t=d.current[s];if(t){const{x:e,y:o,size:i}=t,l=n-e,r=a-o;if(Math.sqrt(l*l+r*r)<i/2)return W(e=>e.filter((e,t)=>t!==s)),void ie(null)}if($(e,n,a)){ie(s),se("rotate"),ce({x:n,y:a,centerX:e.x+e.img.width*e.scale/2,centerY:e.y+e.img.height*e.scale/2,initialAngle:e.rotation||0}),o=!0;break}if(C(e,n,a)){ie(s),se("resize"),ce({x:n,y:a,initialScale:e.scale,initialWidth:e.img.width}),o=!0;break}if(T(e,n,a)){ie(s),se("move"),ce({x:n,y:a,initialX:e.x,initialY:e.y}),o=!0;break}}if(!o)for(let s=q.length-1;s>=0;s--){var l;R=!ge;const e=q[s],o=fe(e),r=null===(l=m.current)||void 0===l?void 0:l[s];if(r){const{x:e,y:t}=r,i=q[s].scale||1,l=n-e,c=a-t;let d=.9;i<.5?d=3.5:i<.6?d=3:i<.7?d=2.4:i<.8?d=1.9:i<.93&&(d=1.6);if(Math.sqrt(l*l+c*c)/d<Math.max(20,.01*o*i))return H(e=>e.filter((e,t)=>t!==s)),void ae(null)}if(A(e,n,a,o)){ae(s),se("rotate-text"),ce({x:n,y:a,centerX:e.x,centerY:e.y,initialAngle:e.rotation||0}),i=!0;break}if(N(e,n,a,o)){ae(s),ie(null),se("resize-text"),ce({x:n,y:a,initialScale:e.scale,initialWidth:o}),i=!0;break}if(E(e,n,a,o)){ae(s),t&&(B=setTimeout(()=>{R=!0},300)),se("move-text"),ce({x:n,y:a,initialX:e.x,initialY:e.y}),i=!0;break}}o||i||(ie(null),ae(null),se(null),ce(null))},onMouseMove:e=>{const{x:t,y:n}=ve(e);let a="default",o=!1;for(let s=q.length-1;s>=0;s--){const e=q[s],i=fe(e);if(A(e,t,n,i)){a="crosshair",o=!0;break}if(N(e,t,n,i)){a="nwse-resize",o=!0;break}if(E(e,t,n,i)){a="grab",o=!0;break}}if(!o)for(let s=O.length-1;s>=0;s--){const e=O[s];if($(e,t,n)){a="crosshair",o=!0;break}if(C(e,t,n)){a="nwse-resize",o=!0;break}if(T(e,t,n)){a="grab",o=!0;break}}if("move"!==le||null===oe&&null===ne||(a="grabbing"),he(a),!le||!re)return;const i=t-re.x,l=n-re.y;null!==oe&&W(e=>{const a=[...e],o={...a[oe]};if("move"===le)o.x=re.initialX+i,o.y=re.initialY+l;else if("resize"===le){const e=re.initialWidth*re.initialScale+i,t=Math.max(.05,e/o.img.width);o.scale=t}else if("rotate"===le){const e=Math.atan2(re.y-re.centerY,re.x-re.centerX),a=180*(Math.atan2(n-re.centerY,t-re.centerX)-e)/Math.PI;o.rotation=(re.initialAngle+a)%360}return a[oe]=o,a}),null!==ne&&H(e=>{const a=[...e],o={...a[ne]};if(R=!1,B&&clearTimeout(B),"move-text"===le)o.x=re.initialX+i,o.y=re.initialY+l;else if("resize-text"===le){const e=re.initialWidth*re.initialScale+i,t=Math.max(.1,e/fe(o));o.scale=t}else if("rotate-text"===le){const e=Math.atan2(re.y-re.centerY,re.x-re.centerX),a=180*(Math.atan2(n-re.centerY,t-re.centerX)-e)/Math.PI;o.rotation=(re.initialAngle+a)%360}return a[ne]=o,a})},onMouseUp:()=>{B&&clearTimeout(B),se(null),ce(null),he("default")},canvasElements:q,setCanvasElements:H,activeTextIndex:ne,photoBoothSettings:null!==(i=null===e||void 0===e||null===(r=e.wall)||void 0===r?void 0:r.PhotoBoothSettings)&&void 0!==i?i:{},selectedStickers:O,setActiveStickerIndex:ie,setActiveTextIndex:ae}):(0,l.jsx)(I,{uploadType:ee,rawImage:f,takePhoto:async(e,t)=>{if(!e)return void console.error("Failed to capture screenshot from webcam.");const n=new Image;n.crossOrigin="anonymous",n.src=e,n.onload=async()=>{t?p(n):w(n),me({width:n.width,height:n.height}),await(async e=>{const t=new o.SelfieSegmentation({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${e}`});t.setOptions({modelSelection:1}),t.onResults(e=>{Y(e.segmentationMask)});const n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").drawImage(e,0,0,e.width,e.height);try{await t.send({image:n})}catch(a){console.error("Error sending image to MediaPipe:",a)}})(n)},n.onerror=()=>{console.error("Failed to load captured image.")}},canvasRef:c,canvasCursor:de,setRawImage:p,customisePhoto:()=>{p(null),U(null),X(null),W([]),H([]),G(null),J(null),ae(null),ie(null),S(!0)}})})})]})})})}}}]);