"use strict";(self.webpackChunkembed_widget=self.webpackChunkembed_widget||[]).push([[411,9430],{56214:(e,t,n)=>{n.r(t),n.d(t,{default:()=>D});var a=n(9950),o=n(22332),i=n(80415),s=n(44414);function l(e){let{uploadFile:t}=e;return(0,s.jsx)("div",{className:"pb_cards",children:(0,s.jsxs)("div",{className:"pb_cards_box",children:[(0,s.jsxs)("div",{onClick:()=>t(3),className:"pb_card",children:[(0,s.jsx)("div",{className:"pb_card_icon",children:(0,s.jsx)("img",{src:`${i.on}images/photobooth/camera.svg`,alt:"camera"})}),(0,s.jsx)("h3",{className:"pb_card-title",children:"Photobooth"}),(0,s.jsx)("p",{className:"pb_card-description",children:" Add fun stickers and backgrounds before sharing your masterpiece."})]}),(0,s.jsxs)("div",{onClick:()=>t(2),className:"pb_card",children:[(0,s.jsx)("div",{className:"pb_card_icon",children:(0,s.jsx)("img",{src:`${i.on}images/photobooth/snapup.svg`,alt:"snapup"})}),(0,s.jsx)("h3",{className:"pb_card-title",children:"Snap & Share"}),(0,s.jsx)("p",{className:"pb_card-description",children:"Upload your photos in one go without logging into your social media accounts."})]})]})})}const r=e=>{let{className:t,children:n,icon:a,onClick:o}=e;return(0,s.jsxs)("button",{className:t,onClick:o,children:[a&&(0,s.jsx)("img",{src:`${i.on}images/photobooth/${a}.svg`,alt:a}),n]})};var c=n(11766),d=n.n(c);const u=320,h=320,m=[{id:"background",label:"Background"},{id:"frame",label:"Frames"},{id:"sticker",label:"Stickers"},{id:"text",label:"Text"}];var g=n(52867);const v=e=>{let{rawImage:t,cameraPermission:n,capturedImage:o,mode:l,counter:r,canvasRef:c,canvasCursor:m,webcamRef:v,onMouseDown:x,onMouseMove:p,onMouseUp:f,canvasElements:b,activeTextIndex:w,setCanvasElements:y,loading:k}=e;const[S,_]=(0,a.useState)("environment"),[M,j]=(0,a.useState)(Math.random()),I=e=>e?e.split("\n").length:1,C=(0,a.useMemo)(g.qs,[]),E=e=>{const t=e.target.value;if((null===t||void 0===t?void 0:t.length)<=35){const e=(e=>{if(!c.current||!b[w])return e;const t=b[w],n=document.createElement("canvas").getContext("2d"),a=t.fontSize||16,o=t.fontFamily||"Arial";n.font=`${a}px ${o}`;const i=e.split(/\s+/);let s="",l="";const r=e=>{let t="";for(let a of e){const e=t+a;n.measureText(e).width>270&&t?(l+=t+"\n",t=a):t=e}return t};for(let c of i){let e=s?s+" "+c:c;n.measureText(e).width>270?s?(l+=s+"\n",s=n.measureText(c).width>270?r(c):c):s=r(c):s=e}return s&&(l+=s),l})(t);console.log("wrappedText",e),y(t=>t.map((t,n)=>n===w?{...t,text:e}:t))}},T=(0,a.useCallback)(e=>{if(!e||!e.text)return 0;const t=document.createElement("canvas").getContext("2d"),n=e.fontSize||16,a=e.fontFamily||"Arial",o=e.scale||1;t.font=`${n}px ${a}`;const i=e.text.split("\n");let s=0;for(const l of i){const e=t.measureText(l).width;e>s&&(s=e)}return s*o},[b]);(0,a.useEffect)(()=>{(async()=>{try{setTimeout(()=>{j(Date.now())},2e3)}catch(e){console.error("Error starting camera:",e)}})()},[]);const N=(0,a.useCallback)(()=>{_(e=>"user"===e?"environment":"user"),j(e=>e+1)},[]);return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"pb_user_photo "+(k?"active_blur":""),style:{position:"relative",display:t?"none":o||"granted"===n?"flex":"none"},children:["capture"!==l||o?o?(0,s.jsx)("canvas",{ref:c,style:{cursor:m},width:u,height:h,onMouseDown:x,onMouseMove:p,onMouseUp:f,onMouseLeave:f,onTouchStart:function(e){const t=e.type.startsWith("touch");e.preventDefault();const n=e.touches[0],a={clientX:n.clientX,clientY:n.clientY};x(a,t)},onTouchMove:function(e){e.preventDefault();const t=e.touches[0],n={clientX:t.clientX,clientY:t.clientY};p(n)},onTouchEnd:function(e){e.preventDefault(),f()}}):(0,s.jsx)("img",{src:`${i.on}images/photobooth/avatar.png?v=1.0.1`,alt:"default-avatar",width:u,height:h}):(0,s.jsx)(d(),{ref:v,screenshotFormat:"image/png",width:u,height:h,videoConstraints:{facingMode:S,width:u,height:h},mirrored:"user"===S,onUserMedia:()=>console.log("Webcam stream started:",S),style:{objectFit:"cover",borderRadius:"8px"}},`${M}-${S}`),null===b||void 0===b?void 0:b.map((e,t)=>w===t&&(0,s.jsx)("textarea",{id:`text-${t}`,name:`text-${t}`,value:e.text,onChange:E,wrap:"hard",style:{position:"absolute",top:e.y-(e.fontSize*e.scale*I(e.text)+10)/2+"px",left:e.x-T(e)/2-(C?3:0)+"px",width:`${T(e)}px`,height:e.fontSize*e.scale*I(e.text)+6+"px",fontSize:e.fontSize*e.scale+"px",fontFamily:e.fontFamily||"Arial",transform:`rotate(${e.rotation||0}deg)`,textAlign:e.align||"center",transformOrigin:"center center",background:e.backgroundColor||"transparent",color:e.color||"#000",overflow:"hidden",border:"none",outline:"none",padding:0,maxWidth:"300px",wordBreak:"break-word",whiteSpace:"pre-wrap",overflowWrap:"break-word",resize:"none"}},t)),C&&!o?(0,s.jsx)("button",{onClick:N,children:(0,s.jsx)("img",{src:`${i.on}images/photobooth/camera-flip.svg`,alt:"flip-camera"})}):null,r?(0,s.jsxs)("div",{className:"pb_viewframe",children:[(0,s.jsx)("img",{src:`${i.on}images/photobooth/viewframe-white@3x.svg`,alt:"viewframe"})," ",(0,s.jsx)("span",{children:r})]}):null]})})},x=a.memo(v),p=e=>{let{addSticker:t,loading:n,stickers:a,selectedStickers:o}=e;return(0,s.jsx)("div",{className:"pb_list_items pb_stickers",children:a.map((e,a)=>{const i=null===o||void 0===o?void 0:o.find(t=>(null===t||void 0===t?void 0:t.url)==e);return(0,s.jsx)("img",{onClick:n?null:()=>t(e),style:{cursor:n?"not-allowed":"pointer"},className:i?"active":"",src:`${e}?v=2.2`,alt:"sticker",width:64,height:64},a)})})};var f=n(25825);const b=["font","align","color","bg"],w=["Arial","Helvetica","Times New Roman","Georgia","Courier New","Verdana","Tahoma","Trebuchet MS","Comic Sans MS","Impact","Lucida Console","Roboto","Open Sans"],y=["left","center","right"],k=["white","black","transparent"],S=e=>{var t,n;let{canvasElements:o,setCanvasElements:l,activeTextIndex:r,addTextElement:c}=e;const[d,u]=(0,a.useState)(0),h=(0,a.useRef)(null);return(0,a.useEffect)(()=>{const e=e=>{h.current&&!h.current.contains(e.target)&&u(!1)};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}},[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"pb_text",children:[d?(0,s.jsx)(f.xk,{color:null!==(t=null===(n=o[r])||void 0===n?void 0:n.color)&&void 0!==t?t:"black",onChange:e=>l(t=>t.map((t,n)=>n===r?{...t,color:e.hex}:t))}):null,b.map(e=>(0,s.jsxs)("div",{className:"pb_text_box",onClick:()=>(e=>{if(null!==r){const d={};if("color"===e)return void u(1);if("align"===e){var t,n;const e=null!==(t=null===(n=o[r])||void 0===n?void 0:n.align)&&void 0!==t?t:"center",a=y.find(t=>t===e);d.align=y[(y.indexOf(a)+1)%y.length]}else if("bg"===e){var a,i;const e=null!==(a=null===(i=o[r])||void 0===i?void 0:i.backgroundColor)&&void 0!==a?a:"transparent",t=k.find(t=>t===e);d.backgroundColor=k[(k.indexOf(t)+1)%k.length]}else if("font"===e){var s,c;const e=null!==(s=null===(c=o[r])||void 0===c?void 0:c.fontFamily)&&void 0!==s?s:"Arial",t=w.find(t=>t===e);d.fontFamily=w[(w.indexOf(t)+1)%w.length]}l(e=>e.map((e,t)=>t===r?{...e,...d}:e))}})(e),children:[(0,s.jsx)("img",{src:`${i.th}/media/images/photobooth/text/${e}.png?v=1`,alt:e}),(0,s.jsx)("p",{children:e})]},e))]}),(0,s.jsx)("div",{className:"pb_add_text",children:(0,s.jsx)("p",{onClick:c,children:"Add Text"})})]})},_=e=>{let{loading:t,imgUrl:n,imgList:a,setImgUrl:o,tabKey:l,capturedImage:r=null}=e;return(0,s.jsx)("div",{className:`pb_list_items pb_${l}`,children:[`${i.th}/media/images/photobooth/${l}/none.png`,...a].map((e,a)=>{const i=n?n===e:0===a;return(0,s.jsxs)("div",{className:"pb_list_images "+(i?"active":""),children:[r&&0!==a?(0,s.jsx)("img",{className:"pb_list_user_img",src:null===r||void 0===r?void 0:r.src,alt:"captured-image",width:64,height:64}):null,(0,s.jsx)("img",{style:{cursor:t?"not-allowed":"pointer"},src:`${e}?v=2.2`,alt:`img-${a}`,className:"pb_list_frames",width:64,height:64,onClick:t?null:()=>o(0==a?null:e)})]},a)})})},M=e=>{let{capturedImage:t,uploadFile:n,canvasRef:o,canvasCursor:l,selectedBg:c,setSelectedBg:d,selectedFrame:u,setSelectedFrame:h,addSticker:v,addTextElement:f,onMouseDown:b,onMouseMove:w,onMouseUp:y,canvasElements:k,setCanvasElements:M,activeTextIndex:j,loading:I,selectedStickers:C,photoBoothSettings:E,setActiveStickerIndex:T,setActiveTextIndex:N,activeText:$}=e;const[A,P]=(0,a.useState)("background"),[R,F]=(0,a.useState)([]),[z,B]=(0,a.useState)([]),[L,U]=(0,a.useState)([]);return(0,a.useEffect)(()=>{"text"===A&&0===k.length&&f(),"text"!==A?N(null):"sticker"!==A&&T(null)},[A]),(0,a.useEffect)(()=>{const e=(0,g.S3)((null===E||void 0===E?void 0:E.photo_booth_frames)||[]),t=(0,g.S3)((null===E||void 0===E?void 0:E.photo_booth_backgrounds)||[]),n=(0,g.S3)((null===E||void 0===E?void 0:E.photo_booth_stickers)||[]);B(null===e||void 0===e?void 0:e.map(e=>`${i.on}images/photobooth/frames/${e}`)),F(null===t||void 0===t?void 0:t.map(e=>`${i.on}images/photobooth/backgrounds/${e}`)),U(null===n||void 0===n?void 0:n.map(e=>`${i.on}images/photobooth/stickers/${e}`))},[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"pb_customization",children:[(0,s.jsx)(x,{loading:I,capturedImage:t,canvasRef:o,canvasCursor:l,onMouseDown:b,onMouseMove:w,onMouseUp:y,canvasElements:k,activeTextIndex:j,setCanvasElements:M,activeText:$}),(0,s.jsxs)("div",{className:"pb_tabs",children:[(0,s.jsx)("div",{className:"pb_tabs_list",children:m.map(e=>(0,s.jsx)("button",{onClick:()=>P(e.id),className:A===e.id?"active":"",children:e.label},e.id))}),(0,s.jsx)("div",{className:"pb_tabs_content",children:(0,s.jsx)("div",{className:"pb_tabs_content_box",children:"background"===A?(0,s.jsx)(_,{loading:I,imgUrl:c,imgList:R,setImgUrl:d,tabKey:"backgrounds"}):"frame"===A?(0,s.jsx)(_,{imgUrl:u,imgList:z,setImgUrl:h,tabKey:"frames",capturedImage:t}):"sticker"===A?(0,s.jsx)(p,{stickers:L,addSticker:v,loading:I,selectedStickers:C}):"text"===A?(0,s.jsx)(S,{canvasElements:k,setCanvasElements:M,activeTextIndex:j,addTextElement:f}):null})})]})]}),(0,s.jsx)("div",{className:"pb_continue_buttons_main",children:(0,s.jsx)(r,{className:"pb_continue_buttons",children:"Continue",onClick:()=>{if(null!==o&&void 0!==o&&o.current){const e=o.current;T(null),N(null),setTimeout(()=>{const t=e.toDataURL("image/png",1);t&&n(2,t)},100)}}})})]})};var j=n(66345);function I(e){const{snapType:t,uploadType:n,rawImage:a,capturedImage:o,wall:l,uploadImg:r,backAction:c}=e,d=1===t&&1===n||3===t&&!a&&!o;return(0,s.jsxs)("div",{className:"pb_header_bar",onClick:d?()=>window.location.href=`${j.EP}${l.Wall.id}?social-wall=true`:c,children:[(0,s.jsx)("img",{src:`${i.th}/media/images/photobooth/arrow-back.svg`,alt:"arrow-back"}),2==n&&r?(0,s.jsx)("img",{className:"pb_header_logo",src:l.PhotoBoothSettings.photo_booth_logo,height:20,width:130,alt:""}):(0,s.jsx)("span",{className:"header-title",children:d?"Back to Wall":"Back"})]})}const C=(e,t,n)=>{let a="blob"==t?((e,t)=>{try{const[n,a]=e.split(","),o=n.match(/:(.*?);/)[1],i=atob(a),s=i.length,l=new Uint8Array(s);for(let e=0;e<s;e++)l[e]=i.charCodeAt(e);return new File([l],t,{type:o})}catch(n){return console.error("Error converting base64 data to file:",n),null}})(e,"camera.png"):e;if(a){const e=URL.createObjectURL(a);e&&n&&n(e)}},E=(e,t,n)=>{const a=e.img.width*e.scale,o=e.img.height*e.scale,i=(e.rotation||0)*Math.PI/180,s=e.x+a/2,l=e.y+o/2,r=a/2,c=o/2,d=t-(s+(r*Math.cos(i)-c*Math.sin(i))),u=n-(l+(r*Math.sin(i)+c*Math.cos(i)));return Math.sqrt(d*d+u*u)<=R(15,7)/2},T=(e,t,n)=>{const a=e.img.width*e.scale,o=e.img.height*e.scale;return t>e.x&&t<e.x+a&&n>e.y&&n<e.y+o},N=(e,t,n)=>{const{img:a,scale:o,x:i,y:s,rotation:l=0}=e,r=a.width*o,c=a.height*o,d=i+r/2,u=s+c/2,h=r/2,m=-c/2-5,g=l*Math.PI/180,v=t-(d+h*Math.cos(g)-m*Math.sin(g)),x=n-(u+h*Math.sin(g)+m*Math.cos(g));return Math.sqrt(v*v+x*x)<=R(7,7)},$=(e,t,n,a)=>{const o=e.scale||1,i=e.fontSize||20,s=20*a,l=e.text.split("\n").length*i*o+20,r=e.x,c=e.y,d=(0,g.qs)()?o>0?20/o:20:0,u=t-r,h=n-c,m=(e.rotation||0)*Math.PI/180,v=Math.cos(-m),x=Math.sin(-m),p=(u*v-h*x)/o,f=(u*x+h*v)/o;return p>=-s/(2*o)&&p<=s/(2*o)&&f>=-l/(2*o)-d&&f<=l/(2*o)+d},A=(e,t,n,a)=>{var o;const i=e.scale||1,s=e.fontSize||20,l=(null===(o=e.text)||void 0===o?void 0:o.split("\n"))||[],r=1.2*s*Math.max(l.length,1)*i+20,c=a*i+20,d=R(16),u=e.x,h=e.y,m=c/2,g=r/2,v=(e.rotation||0)*Math.PI/180,x=t-(u+m*Math.cos(v)-g*Math.sin(v)),p=n-(h+m*Math.sin(v)+g*Math.cos(v));return x*x+p*p<(d/2)**2},P=(e,t,n,a)=>{var o;const i=e.scale||1,s=e.fontSize||20,l=R(16),r=e.x,c=e.y,d=(null===(o=e.text)||void 0===o?void 0:o.split("\n"))||[],u=(a*i+20)/2,h=-(1.2*s*Math.max(d.length,1)*i+20)/2,m=(e.rotation||0)*Math.PI/180,g=t-(r+u*Math.cos(m)-h*Math.sin(m)),v=n-(c+u*Math.sin(m)+h*Math.cos(m));return g*g+v*v<(l/2)**2},R=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,g.qs)()?2*e+t:e};var F=n(69522),z=n(81052),B=n.n(z);const L=e=>{let{imageUrl:t,photoBtnRef:n,customiseImage:o}=e;const l=(0,a.useRef)(null),r=(0,a.useRef)(null),c=(0,a.useRef)(null),d=(0,a.useRef)(1),[u,h]=(0,a.useState)(!0),[m,g]=(0,a.useState)({width:200,height:200}),[v,x]=(0,a.useState)({x:0,y:0}),[p,f]=(0,a.useState)(1),b=320,w=320,y=(0,a.useCallback)(async()=>{if(!l.current)return;const e=l.current,t=e.getBoundingClientRect(),n=await B()(e,{scale:2}),a=document.createElement("canvas");a.width=t.width,a.height=t.height;a.getContext("2d").drawImage(n,0,0,n.width,n.height,0,0,t.width,t.height),a.toBlob(e=>{if(e){const t=new File([e],"capture.png",{type:"image/png"});o(t)}},"image/png",1)},[o]);(0,a.useEffect)(()=>{const e=new Image;e.crossOrigin="anonymous",e.onload=()=>{const t=e.width/e.height;let n=b,a=n/t;a>w&&(a=w,n=a*t),g({width:n,height:a}),x({x:(b-n)/2,y:(w-a)/2})},e.src=t},[t]);const k=m.width*p,S=m.height*p,_=e=>{const[t,n]=e,a=t.clientX-n.clientX,o=t.clientY-n.clientY;return Math.sqrt(a*a+o*o)},M=e=>{2===e.touches.length&&(c.current=_(e.touches),d.current=p)},j=e=>{if(2===e.touches.length){e.preventDefault();const t=_(e.touches),n=c.current,a=d.current;if(!n||!a)return;const o=t/n;let i=Math.max(1,a*o);f(i)}};return(0,a.useEffect)(()=>{const e=l.current;if(e)return e.addEventListener("touchstart",M,{passive:!1}),e.addEventListener("touchmove",j,{passive:!1}),()=>{e.removeEventListener("touchstart",M),e.removeEventListener("touchmove",j)}},[p]),(0,a.useEffect)(()=>{const e=setTimeout(()=>{h(!1)},2500);return()=>clearTimeout(e)},[]),(0,s.jsxs)("div",{ref:l,style:{width:b,height:w,border:"2px dashed #aaa",position:"relative",overflow:"hidden",margin:"0px auto 30px",background:"#f9f9f9",touchAction:"none",borderRadius:"8px"},onWheel:e=>{e.preventDefault();const t=e.deltaY<0?.05:-.05,n=Math.max(1,p+t);if(n<=1.01&&k<=b&&S<=w){f(1);const e=(b-m.width)/2,t=(w-m.height)/2;x({x:e,y:t})}else f(n)},children:[(0,s.jsx)(F.p,{size:{width:k,height:S},position:v,enableResizing:!1,disableDragging:!1,onDragStop:(e,t)=>{let n=t.x,a=t.y;const o=Math.max(0,k-b),i=Math.max(0,S-w);n=Math.min(Math.max(n,-o),0),a=Math.min(Math.max(a,-i),0),x({x:n,y:a})},style:{zIndex:2,pointerEvents:"auto"},children:(0,s.jsx)("img",{ref:r,src:t,alt:"Editable",style:{width:"100%",height:"100%",objectFit:"cover",userSelect:"none",pointerEvents:"none"}})}),(0,s.jsx)("button",{ref:n,style:{display:"none",position:"absolute",top:10,right:10,zIndex:400},onClick:y,children:"Capture"}),u?(0,s.jsxs)("div",{className:"pb_take_photo_crop",children:[(0,s.jsx)("img",{src:`${i.th}/media/images/photobooth/arrow-left.svg`,alt:"arrow-left",width:50,height:50}),(0,s.jsx)("img",{src:`${i.th}/media/images/photobooth/arrow-right.svg`,alt:"arrow-right",width:50,height:50})]}):null]})},U=e=>{var t;let{uploadType:n,rawImage:o,takePhoto:l,canvasRef:c,canvasCursor:d,setRawImage:u,customisePhoto:h}=e;const m=(0,a.useRef)(null),g=(0,a.useRef)(null),v=(0,a.useRef)(null),[p,f]=(0,a.useState)(null),[b,w]=(0,a.useState)("capture"),[y,k]=(0,a.useState)(0),[S,_]=(0,a.useState)(null),M=(0,a.useCallback)(async()=>{["Smile",3,2,1,0].forEach((e,t)=>{setTimeout(()=>f(e),1e3*t)})},[]),j=(0,a.useCallback)(()=>{w("capture"),u(null)},[]),I=(0,a.useCallback)(e=>{var t,n;const a=null===e||void 0===e||null===(t=e.target)||void 0===t||null===(n=t.files)||void 0===n?void 0:n[0];k(y+1),C(a,"file",e=>l(e,!0))},[y]),E=(0,a.useCallback)(async e=>{var t;w(e),"capture"===e&&await M(),"upload"===e&&null!==m&&void 0!==m&&m.current&&await(null===m||void 0===m||null===(t=m.current)||void 0===t?void 0:t.click())},[]);(0,a.useEffect)(async()=>{if(0==p&&null!==g&&void 0!==g&&g.current){var e;f(null);const t=await(null===g||void 0===g||null===(e=g.current)||void 0===e?void 0:e.getScreenshot());C(t,"blob",e=>l(e,!0))}},[p]);return(0,a.useEffect)(()=>{/Safari/i.test(navigator.userAgent)&&!/Chrome/i.test(navigator.userAgent)||(async()=>{try{const e=await navigator.mediaDevices.getUserMedia({video:!0});g.current&&(g.current.srcObject=e),_("granted")}catch(e){if(console.warn("Camera error:",e.name,e.message),navigator.permissions&&navigator.permissions.query)try{const e=await navigator.permissions.query({name:"camera"});return void _(e.state)}catch{console.log("Permissions API not supported (Safari likely)")}_("prompt")}})()},[]),(0,a.useEffect)(()=>{const e=async()=>{try{const e=await navigator.permissions.query({name:"camera"});e.state!==S&&_(e.state)}catch(e){console.warn("Permissions API not fully supported",e)}};return setInterval(e,2e3),()=>{clearInterval(e)}},[S]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"pb_user_photo_box",children:[o?(0,s.jsx)(L,{photoBtnRef:v,imageUrl:null!==(t=null===o||void 0===o?void 0:o.src)&&void 0!==t?t:"",customiseImage:e=>{C(e,"file",e=>l(e,!1)),setTimeout(h,100)}}):(0,s.jsxs)(s.Fragment,{children:[" ",(0,s.jsx)(x,{stopCamera:!0,cameraPermission:S,mode:b,rawImage:o,canvasRef:c,canvasCursor:d,webcamRef:g,counter:p}),o?null:(0,s.jsxs)("div",{id:"camera-disabled-message",className:"pb-camera-disabled",style:{display:"granted"===S?"none":"flex"},children:[(0,s.jsx)("img",{src:`${i.on}images/photobooth/camera-disabled.svg`,alt:"camera-disabled"}),(0,s.jsxs)("p",{className:"pb_camera_disabled_text",children:["Please reload and allow camera",(0,s.jsx)("br",{}),"access when prompted."]}),(0,s.jsxs)("p",{className:"pb_camera_disabled_text_bottom",children:["In case this doesn't work, please",(0,s.jsx)("br",{}),"check the camera permissions in ",(0,s.jsx)("br",{}),"your browser settings."]})]})]}),o?(0,s.jsxs)("div",{className:"pb_take_photo",children:[(0,s.jsx)(r,{className:"pb_buttons_transparent",icon:"retake",children:"Try Again",onClick:j}),(0,s.jsx)(r,{className:"pb_buttons heighlight",children:"Looks Good!",onClick:()=>{var e;return null===v||void 0===v||null===(e=v.current)||void 0===e?void 0:e.click()}})]}):(0,s.jsxs)("div",{className:"pb_user_buttons",children:["granted"===S?(0,s.jsx)(r,{className:"pb_buttons heighlight",icon:"camera",children:"Strike a Pose",onClick:()=>E("capture")}):null,(0,s.jsx)(r,{className:"pb_buttons",icon:"upload",children:"Upload from Gallery",onClick:()=>E("upload")})]})]}),(0,s.jsx)("input",{ref:m,type:"file",accept:"image/*",style:{display:"none"},onChange:I},y)]})};var Y=n(48768);const D=e=>{var t,n,i,r;const c=(0,a.useRef)(null),d=(0,a.useRef)({}),m=(0,a.useRef)({}),[v,x]=(0,a.useState)(!1),[p,f]=(0,a.useState)(null),[b,w]=(0,a.useState)(null),[y,k]=(0,a.useState)(!1),[S,_]=(0,a.useState)(0),[j,C]=(0,a.useState)(null),[R,F]=(0,a.useState)(null),[z,B]=(0,a.useState)(null),[L,D]=(0,a.useState)([]),[X,O]=(0,a.useState)([]),[W,q]=(0,a.useState)(null),[G,K]=(0,a.useState)(null),[H,V]=(0,a.useState)(null),[J,Q]=(0,a.useState)(null===e||void 0===e?void 0:e.snapType),[Z,ee]=(0,a.useState)(null),[te,ne]=(0,a.useState)(null),[ae,oe]=(0,a.useState)(null),[ie,se]=(0,a.useState)(null),[le,re]=(0,a.useState)(null),[ce,de]=(0,a.useState)("default"),[ue,he]=(0,a.useState)({width:u,height:h}),me=(0,a.useMemo)(g.qs,[]),ge=e=>{x(e)},ve=e=>{const t=c.current,n=t.getBoundingClientRect();return{x:(e.clientX-n.left)*(t.width/n.width),y:(e.clientY-n.top)*(t.height/n.height)}},xe=e=>{const t=null===c||void 0===c?void 0:c.current;if(!t||null===e||void 0===e||!e.text)return 0;const n=t.getContext("2d");if(!n)return 0;n.save(),n.font=`${e.fontSize||20}px ${e.fontFamily||"Arial"}`;const a=e.text.split("\n"),o=Math.max(...a.map(e=>n.measureText(e).width));return n.restore(),o};(0,a.useEffect)(()=>{if(!b||!j)return;const e=c.current;if(!e)return;const t=e.getContext("2d"),n=ue.width,a=ue.height;e.width=n,e.height=a;const o=document.createElement("canvas");o.width=n,o.height=a;const i=o.getContext("2d");if(i.clearRect(0,0,n,a),W&&z){const e=document.createElement("canvas");e.width=n,e.height=a;const t=e.getContext("2d");t.drawImage(b,0,0,n,a),t.globalCompositeOperation="destination-in",t.drawImage(j,0,0,n,a),t.globalCompositeOperation="source-over",i.drawImage(z,0,0,n,a),i.drawImage(e,0,0,n,a)}else i.drawImage(b,0,0,n,a);i.globalCompositeOperation="source-over",R&&i.drawImage(R,0,0,n,a),L.forEach((e,t)=>{const n=e.img.width*e.scale,a=e.img.height*e.scale,o=e.x+n/2,s=e.y+a/2;if(i.save(),i.translate(o,s),i.rotate((e.rotation||0)*Math.PI/180),i.drawImage(e.img,-n/2,-a/2,n,a),t===ae){i.strokeStyle="#2b2b2b",i.lineWidth=2,i.setLineDash([5,3]),i.strokeRect(-n/2,-a/2,n,a),i.setLineDash([]);const l=14,r="\u2921",c=n/2,u=a/2;i.fillStyle="#000",i.beginPath(),i.arc(c,u,l,0,2*Math.PI),i.fill(),i.fillStyle="white",i.font="bold 24px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText(r,c,u-2);const h=n/2,m=-a/2,g=14;i.beginPath(),i.fillStyle="#000",i.arc(h,m,g,0,2*Math.PI),i.fill(),i.fillStyle="#fff",i.font="bold 24px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("\u27f3",h+1,m-1);const v=22,x=-n/2-v/2+5,p=-a/2-v/2+8;d.current[t]={x:o+x*Math.cos(e.rotation*Math.PI/180)-p*Math.sin(e.rotation*Math.PI/180),y:s+x*Math.sin(e.rotation*Math.PI/180)+p*Math.cos(e.rotation*Math.PI/180),size:v},i.beginPath(),i.arc(x+5,p+5,14,0,2*Math.PI),i.fillStyle="black",i.fill(),i.fillStyle="#fff",i.font="bold 14px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("\u2715",x+5,p+5)}i.restore()}),X.forEach((e,t)=>{var n;i.save(),i.translate(e.x,e.y),i.rotate(e.rotation*Math.PI/180),i.scale(e.scale,e.scale),i.font=`${e.fontSize}px ${e.fontFamily||"Arial"}`,i.textAlign=e.align||"center",i.textBaseline="middle";const a=(null===(n=e.text)||void 0===n?void 0:n.split("\n"))||[""],o=Math.max(...a.map(e=>i.measureText(e).width)),s=a.length,l=e.fontSize*e.scale,r=o+20,c=l*s+10,d=1.2*l,u=o+20,h=l*a.length+30,g=-u/2;if(e.backgroundColor&&(i.fillStyle=e.backgroundColor,i.fillRect(g,-h/2,u,h)),t!==te&&(i.fillStyle=e.color||"#000000",a.forEach((e,t)=>{let n=0;"center"==i.textAlign?n=0:"left"==i.textAlign?n=-u/2+10:"right"==i.textAlign&&(n=u/2-10),i.fillText(e,n,t*d-(a.length-1)*d/2)})),t===te){i.strokeStyle="#2b2b2b",i.lineWidth=2,i.setLineDash([5,3]),i.strokeRect(g,-h/2,u,h),i.setLineDash([]);const n=22,a=(e.rotation||0)*Math.PI/180,o=-r/2-n/2,s=-c/2-n/2,l=e.x+o*Math.cos(a)-s*Math.sin(a),d=e.y+o*Math.sin(a)+s*Math.cos(a);m.current[t]={x:l,y:d,size:Math.max(me?15:10,n*e.scale)},i.fillStyle="black",i.beginPath(),i.arc(g,-h/2,14,0,2*Math.PI),i.fill(),i.fillStyle="#fff",i.font="bold 14px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("\u2715",g,-h/2),i.fillStyle="black",i.beginPath(),i.arc(g+u,-h/2,14,0,2*Math.PI),i.fill(),i.fillStyle="white",i.font="bold 18px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("\u27f3",g+u,-h/2),i.fillStyle="black",i.beginPath(),i.arc(g+u,h/2,14,0,2*Math.PI),i.fill(),i.fillStyle="white",i.font="bold 20px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("\u2921",g+u,h/2)}i.restore()}),t.clearRect(0,0,n,a),t.drawImage(o,0,0)},[b,j,R,L,ae,X,te,z,y,ue,J]),(0,a.useEffect)(()=>{if(!W)return void B(null);const e=new Image;e.crossOrigin="anonymous",e.src=`https://cdn.taggbox.com/v7/${W}?v=2.2`,ge(!0),e.onload=()=>{B(e),ge(!1)},e.onerror=()=>{console.error(`Failed to load background image: ${W}`),ge(!1)}},[W]),(0,a.useEffect)(()=>{if(!G)return void F(null);const e=new Image;e.crossOrigin="anonymous",e.src=`https://cdn.taggbox.com/v7/${G}?v=2.2`,ge(!0),e.onload=()=>{F(e),ge(!1)},e.onerror=()=>{console.error(`Failed to load frame image: ${G}`),ge(!1)}},[G]),(0,a.useEffect)(()=>{let e=0,t=!1;const n=[".pb_tabs_content_box",".pb_photo_booth_h_review"],a=a=>{e=a.touches[0].clientY;const o=a.target.closest(n.join(","));t=!!o},o=n=>{if(t)return;const a=document.documentElement.scrollTop||document.body.scrollTop,o=n.touches[0].clientY-e;0===a&&o>0&&n.preventDefault()};return document.addEventListener("touchstart",a,{passive:!1}),document.addEventListener("touchmove",o,{passive:!1}),()=>{document.removeEventListener("touchstart",a),document.removeEventListener("touchmove",o)}},[]);const pe=(e,t)=>{Q(e),V(t),_(0)};return(0,s.jsx)("div",{className:"pb_photo_booth_main",children:(0,s.jsx)("div",{className:"pb_photo_booth_box",children:(0,s.jsxs)("div",{className:"pb_photo_booth_box_inner",children:[(0,s.jsx)(I,{snapType:e.snapType,rawImage:p,capturedImage:b,uploadImg:H,uploadType:J,wall:null===e||void 0===e?void 0:e.wall,backAction:()=>{y?(f(b),H&&!S?(k(!0),_(1),Q(3),f(0)):(k(!1),_(0))):(k(!1),f(null),Q(p?H&&2===J?3:J:null===e||void 0===e?void 0:e.snapType))}}),(0,s.jsx)("div",{className:"pb_photo_booth_h "+(2===J?"pb_photo_booth_h_review":""),children:1==J?(0,s.jsx)(l,{uploadFile:pe}):(0,s.jsx)(s.Fragment,{children:2===J?(0,s.jsx)(Y.default,{isPhotoBooth:H,photoBoothInterface:1,wall:null===e||void 0===e?void 0:e.wall,wallId:null===e||void 0===e||null===(t=e.wall)||void 0===t||null===(n=t.Wall)||void 0===n?void 0:n.id,feeds:null===e||void 0===e?void 0:e.feeds,isFreeAdsStatus:null===e||void 0===e?void 0:e.isFreeAdsStatus}):y?(0,s.jsx)(M,{loading:v,capturedImage:b,uploadFile:pe,canvasRef:c,canvasCursor:ce,selectedBg:W,setSelectedBg:q,selectedFrame:G,setSelectedFrame:K,addSticker:e=>{const t=new Image;t.crossOrigin="anonymous",ge(!0),t.src=`https://cdn.taggbox.com/v7/${e}?v=2.2`,t.onload=()=>{ge(!1);const n=ue.width,a=ue.height,o=t.height/t.width*100,i=100/t.width;ne(null),D(s=>{const l=[...s,{img:t,x:n/2-50,y:a/2-o/2,scale:i,url:e,rotation:0}];return oe(l.length-1),l})},t.onerror=()=>{ge(!1),console.error(`Failed to load sticker image: ${e}`)}},addTextElement:()=>{const e={text:"Your Text Here",x:ue.width/2,y:ue.height/2,scale:1,rotation:0,fontSize:28,fontFamily:"Georgia",color:"#000000",backgroundColor:"white",align:"center"};oe(null),O(t=>{const n=[...t,e];return ne(n.length-1),n})},onMouseDown:e=>{const{x:t,y:n}=ve(e);let a=!1,o=!1;for(let l=L.length-1;l>=0;l--){const e=L[l],o=d.current[l];if(o){const{x:e,y:a,size:i}=o,s=t-e,r=n-a;if(Math.sqrt(s*s+r*r)<i/2)return D(e=>e.filter((e,t)=>t!==l)),void oe(null)}if(N(e,t,n)){oe(l),se("rotate"),re({x:t,y:n,centerX:e.x+e.img.width*e.scale/2,centerY:e.y+e.img.height*e.scale/2,initialAngle:e.rotation||0}),a=!0;break}if(E(e,t,n)){oe(l),se("resize"),re({x:t,y:n,initialScale:e.scale,initialWidth:e.img.width}),a=!0;break}if(T(e,t,n)){oe(l),se("move"),re({x:t,y:n,initialX:e.x,initialY:e.y}),a=!0;break}}if(!a)for(let l=X.length-1;l>=0;l--){var i;const e=X[l],a=xe(e),r=null===(i=m.current)||void 0===i?void 0:i[l];if(r){const{x:e,y:o}=r,i=X[l].scale||1,s=t-e,c=n-o;let d=.9;i<.5?d=3.5:i<.6?d=3:i<.7?d=2.4:i<.8?d=1.9:i<.93&&(d=1.6);if(Math.sqrt(s*s+c*c)/d<Math.max(20,.01*a*i))return O(e=>e.filter((e,t)=>t!==l)),ne(null),void ee(null)}if(P(e,t,n,a)){ne(l),ee(null),se("rotate-text"),re({x:t,y:n,centerX:e.x,centerY:e.y,initialAngle:e.rotation||0}),o=!0;break}if(A(e,t,n,a)){ee(null),ne(l),oe(null),se("resize-text"),re({x:t,y:n,initialScale:e.scale,initialWidth:a}),o=!0;break}if($(e,t,n,a)){var s;ee({index:l,count:te==l?(null===Z||void 0===Z?void 0:Z.count)>=2?2:(null!==(s=null===Z||void 0===Z?void 0:Z.count)&&void 0!==s?s:0)+1:1}),ne(l),se("move-text"),re({x:t,y:n,initialX:e.x,initialY:e.y}),o=!0;break}}a||o||(oe(null),ne(null),se(null),re(null),ee(null))},onMouseMove:e=>{const{x:t,y:n}=ve(e);let a="default",o=!1;for(let l=X.length-1;l>=0;l--){const e=X[l],i=xe(e);if(P(e,t,n,i)){a="crosshair",o=!0;break}if(A(e,t,n,i)){a="nwse-resize",o=!0;break}if($(e,t,n,i)){a="grab",o=!0;break}}if(!o)for(let l=L.length-1;l>=0;l--){const e=L[l];if(N(e,t,n)){a="crosshair",o=!0;break}if(E(e,t,n)){a="nwse-resize",o=!0;break}if(T(e,t,n)){a="grab",o=!0;break}}if("move"!==ie||null===ae&&null===te||(a="grabbing"),de(a),!ie||!le)return;const i=t-le.x,s=n-le.y;null!==ae&&D(e=>{const a=[...e],o={...a[ae]};if("move"===ie)o.x=le.initialX+i,o.y=le.initialY+s;else if("resize"===ie){const e=le.initialWidth*le.initialScale+i,t=Math.max(.05,e/o.img.width);o.scale=t}else if("rotate"===ie){const e=Math.atan2(le.y-le.centerY,le.x-le.centerX),a=180*(Math.atan2(n-le.centerY,t-le.centerX)-e)/Math.PI;o.rotation=(le.initialAngle+a)%360}return a[ae]=o,a}),null!==te&&O(e=>{const a=[...e],o={...a[te]};if("move-text"===ie){const e=300;o.x=Math.max(0,Math.min(le.initialX+i,e)),o.y=Math.max(0,Math.min(le.initialY+s,e)),console.log("item",o.x,o.y)}else if("resize-text"===ie){const e=le.initialWidth*le.initialScale+i,t=Math.max(.1,e/xe(o));o.scale=t}else if("rotate-text"===ie){const e=Math.atan2(le.y-le.centerY,le.x-le.centerX),a=180*(Math.atan2(n-le.centerY,t-le.centerX)-e)/Math.PI;o.rotation=(le.initialAngle+a)%360}return a[te]=o,a})},onMouseUp:()=>{se(null),re(null),de("default")},canvasElements:X,setCanvasElements:O,activeTextIndex:te,photoBoothSettings:null!==(i=null===e||void 0===e||null===(r=e.wall)||void 0===r?void 0:r.PhotoBoothSettings)&&void 0!==i?i:{},selectedStickers:L,setActiveStickerIndex:oe,setActiveTextIndex:ne,activeText:Z}):(0,s.jsx)(U,{uploadType:J,rawImage:p,takePhoto:async(e,t)=>{if(!e)return void console.error("Failed to capture screenshot from webcam.");const n=new Image;n.crossOrigin="anonymous",n.src=e,n.onload=async()=>{t?f(n):w(n),he({width:n.width,height:n.height}),await(async e=>{const t=new o.SelfieSegmentation({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${e}`});t.setOptions({modelSelection:1}),t.onResults(e=>{C(e.segmentationMask)});const n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").drawImage(e,0,0,e.width,e.height);try{await t.send({image:n})}catch(a){console.error("Error sending image to MediaPipe:",a)}})(n)},n.onerror=()=>{console.error("Failed to load captured image.")}},canvasRef:c,canvasCursor:ce,setRawImage:f,customisePhoto:()=>{f(null),F(null),B(null),D([]),O([]),q(null),K(null),ne(null),oe(null),k(!0)}})})})]})})})}}}]);