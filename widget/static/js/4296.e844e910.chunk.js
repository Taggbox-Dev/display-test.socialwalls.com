"use strict";(self.webpackChunkembed_widget=self.webpackChunkembed_widget||[]).push([[4296,9430],{33111:(e,t,a)=>{a.r(t),a.d(t,{default:()=>H});var n=a(89379),o=a(9950),i=a(80415),l=a(44414);function s(e){let{uploadFile:t}=e;return(0,l.jsx)("div",{className:"pb_cards",children:(0,l.jsxs)("div",{className:"pb_cards_box",children:[(0,l.jsxs)("div",{onClick:()=>t(3),className:"pb_card",children:[(0,l.jsx)("div",{className:"pb_card_icon",children:(0,l.jsx)("img",{src:"".concat(i.on,"images/photobooth/camera.svg"),alt:"camera"})}),(0,l.jsx)("h3",{className:"pb_card-title",children:"Photobooth"}),(0,l.jsx)("p",{className:"pb_card-description",children:" Add fun stickers and backgrounds before sharing your masterpiece."})]}),(0,l.jsxs)("div",{onClick:()=>t(2),className:"pb_card",children:[(0,l.jsx)("div",{className:"pb_card_icon",children:(0,l.jsx)("img",{src:"".concat(i.on,"images/photobooth/snapup.svg"),alt:"snapup"})}),(0,l.jsx)("h3",{className:"pb_card-title",children:"Snap & Share"}),(0,l.jsx)("p",{className:"pb_card-description",children:"Upload your photos in one go without logging into your social media accounts."})]})]})})}const c=e=>{let{className:t,children:a,icon:n,onClick:o}=e;return(0,l.jsxs)("button",{className:t,onClick:o,children:[n&&(0,l.jsx)("img",{src:"".concat(i.on,"images/photobooth/").concat(n,".svg"),alt:n}),a]})};var r=a(11766),d=a.n(r);const u=320,h=320,m=[{id:"background",label:"Background"},{id:"frame",label:"Frames"},{id:"sticker",label:"Stickers"},{id:"text",label:"Text"}],g=1.7;var v=a(52867),x=a(66345),p=a(14313);const f=async(e,t)=>{const a=await fetch(e),n=await a.blob();return new File([n],t,{type:n.type,lastModified:Date.now()})},b=(e,t,a)=>{let n="blob"==t?((e,t)=>{try{const[a,n]=e.split(","),o=a.match(/:(.*?);/)[1],i=atob(n),l=i.length,s=new Uint8Array(l);for(let e=0;e<l;e++)s[e]=i.charCodeAt(e);return new File([s],t,{type:o})}catch(a){return console.error("Error converting base64 data to file:",a),null}})(e,"camera.png"):e;if(n){const e=URL.createObjectURL(n);e&&a&&a(e)}},w=(e,t,a,n)=>{const o=e.img.width*e.scale,i=e.img.height*e.scale,{initialWidthRatio:l,initialHeightRatio:s}=I(n),c=Math.max(l,s),r=(e.rotation||0)*Math.PI/180,d=e.x+o/2,u=e.y+i/2,h=o/2,m=i/2,g=t-(d+(h*Math.cos(r)-m*Math.sin(r))),v=a-(u+(h*Math.sin(r)+m*Math.cos(r)));return Math.sqrt(g*g+v*v)<=S(15,7)/2*c},y=(e,t,a)=>{const n=e.img.width*e.scale,o=e.img.height*e.scale;return t>e.x&&t<e.x+n&&a>e.y&&a<e.y+o},k=(e,t,a,n)=>{const{img:o,scale:i,x:l,y:s,rotation:c=0}=e,{initialWidthRatio:r,initialHeightRatio:d}=I(n),u=Math.max(r,d),h=o.width*i,m=o.height*i,g=l+h/2,v=s+m/2,x=h/2,p=-m/2-3,f=c*Math.PI/180,b=t-(g+x*Math.cos(f)-p*Math.sin(f)),w=a-(v+x*Math.sin(f)+p*Math.cos(f));return Math.sqrt(b*b+w*w)<=S(15,7)*u},_=(e,t,a,n,o)=>{var i;const{initialWidthRatio:l,initialHeightRatio:s}=I(o),c=e.scale||1,r=e.fontSize||20,d=e.x,u=e.y,h=(n*c+20)*l,m=(((null===(i=e.text)||void 0===i?void 0:i.split("\n"))||[]).length*r*c+20)*s,g=(0,v.qs)()?c>0?20/c:20:0,x=t-d,p=a-u,f=(e.rotation||0)*Math.PI/180,b=Math.cos(-f),w=Math.sin(-f),y=(x*b-p*w)/c,k=(x*w+p*b)/c;return y>=-h/(2*c)&&y<=h/(2*c)&&k>=-m/(2*c)-g&&k<=m/(2*c)+g},j=(e,t,a,n,o)=>{var i;const{initialWidthRatio:l,initialHeightRatio:s}=I(o),c=Math.max(l,s),r=e.scale||1,d=e.fontSize||20,u=(null===(i=e.text)||void 0===i?void 0:i.split("\n"))||[],h=1.2*d*Math.max(u.length,1)*r+20,m=n*r+20,g=S(16),v=e.x,x=e.y,p=m/2*l,f=h/2*s,b=(e.rotation||0)*Math.PI/180,w=t-(v+p*Math.cos(b)-f*Math.sin(b)),y=a-(x+p*Math.sin(b)+f*Math.cos(b));return w*w+y*y<(g/2)**2*c**2},M=(e,t,a,n,o)=>{var i;const{initialWidthRatio:l,initialHeightRatio:s}=I(o),c=Math.max(l,s),r=e.scale||1,d=e.fontSize||20,u=S(16),h=e.x,m=e.y,g=(null===(i=e.text)||void 0===i?void 0:i.split("\n"))||[],v=(n*r+20)/2*l,x=-(1.2*d*Math.max(g.length,1)*r+20)/2*s,p=(e.rotation||0)*Math.PI/180,f=t-(h+v*Math.cos(p)-x*Math.sin(p)),b=a-(m+v*Math.sin(p)+x*Math.cos(p));return f*f+b*b<(u/2)**2*c**2},S=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,v.qs)()?2*e+t:e},I=e=>({initialWidthRatio:Math.max(1,e?e.width/u:1),initialHeightRatio:Math.max(1,e?e.height/h:1)}),C=e=>{let{rawImage:t,cameraPermission:a,capturedImage:s,mode:c,counter:r,canvasRef:m,canvasCursor:g,webcamRef:x,onMouseDown:p,onMouseMove:f,onMouseUp:b,canvasElements:w,activeTextIndex:y,setCanvasElements:k,loading:_}=e;const[j,M]=(0,o.useState)("environment"),[S,C]=(0,o.useState)(Math.random()),[R,E]=(0,o.useState)([]),[T,A]=(0,o.useState)(null),[N,F]=(0,o.useState)(!1),[P,L]=(0,o.useState)(!0),z=(0,v.ew)(),D=e=>e?e.split("\n").length:1,B=(0,o.useMemo)(v.qs,[]),{initialWidthRatio:W,initialHeightRatio:U}=(0,o.useMemo)(()=>I(s),[s]),Y=e=>{const t=e.target.value;if((null===t||void 0===t?void 0:t.length)<=35){const e=(e=>{if(!m.current||!w[y])return e;const t=w[y],a=document.createElement("canvas").getContext("2d"),n=t.fontSize||16,o=t.fontFamily||"Arial";a.font="".concat(n,"px ").concat(o);const i=e.split(/\s+/);let l="",s="";const c=e=>{let t="";for(let n of e){const e=t+n;a.measureText(e).width>270&&t?(s+=t+"\n",t=n):t=e}return t};for(let r of i){let e=l?l+" "+r:r;a.measureText(e).width>270?l?(s+=l+"\n",l=a.measureText(r).width>270?c(r):r):l=c(r):l=e}return l&&(s+=l),s})(t);k(t=>t.map((t,a)=>a===y?(0,n.A)((0,n.A)({},t),{},{text:e}):t))}},X=(0,o.useCallback)(e=>{if(!e||!e.text)return 0;const t=document.createElement("canvas").getContext("2d"),a=e.fontSize||16,n=e.fontFamily||"Arial",o=e.scale||1;t.font="".concat(a,"px ").concat(n);const i=e.text.split("\n");return Math.max(...i.map(e=>t.measureText(e).width))*o},[]);(0,o.useEffect)(()=>((async()=>{try{setTimeout(()=>{C(Date.now())},2e3)}catch(e){console.error("Error starting camera:",e)}})(),()=>G()),[]),(0,o.useEffect)(()=>{navigator.mediaDevices.enumerateDevices().then(e=>{const t=e.filter(e=>{let{kind:t}=e;return"videoinput"===t});console.log("Available cameras:",t),E(t),t.length>1?A(t[t.length-1].deviceId):t[0]&&A(t[0].deviceId)})},[]);const O=R.filter(e=>e.label.toLowerCase().includes("front")),H=R.filter(e=>e.label.toLowerCase().includes("back")||e.label.toLowerCase().includes("rear")),q=(0,o.useCallback)(()=>{let e=null;if(e=P?H[0]||O[0]:O[0]||H[0],e){const t=(e=>{const t=e.label.toLowerCase();return t.includes("front")?"user":t.includes("back")||t.includes("rear")?"environment":"unknown"})(e);A(e.deviceId),M(t),F(!0),C(e=>e+1),L(!P)}else console.warn("\u26a0\ufe0f No suitable front or back camera found")},[N,R.length,x]),G=()=>{setTimeout(()=>{var e;null!==x&&void 0!==x&&x.current&&((null===x||void 0===x||null===(e=x.current)||void 0===e?void 0:e.stream)&&x.current.stream.getTracks().forEach(e=>e.stop()))},1e3)};return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:"pb_user_photo ".concat(_?"active_blur":""),style:{position:"relative",display:t?"none":s||"granted"===a?"flex":"none"},children:[console.log(N,"forceDeviceId",T,"selectedDeviceId",R,"devices",N,"forceDeviceId",j,"facingMode",R.length,"devices.length"),"capture"!==c||s?s?(0,l.jsx)("canvas",{ref:m,style:{cursor:g,width:"".concat(u,"px"),height:"".concat(h,"px")},onMouseDown:p,onMouseMove:f,onMouseUp:b,onMouseLeave:b,onTouchStart:function(e){const t=e.type.startsWith("touch");e.preventDefault();const a=e.touches[0],n={clientX:a.clientX,clientY:a.clientY};p(n,t)},onTouchMove:function(e){e.preventDefault();const t=e.touches[0],a={clientX:t.clientX,clientY:t.clientY};f(a)},onTouchEnd:function(e){e.preventDefault(),b()}}):(0,l.jsx)("img",{src:"".concat(i.on,"images/photobooth/avatar.png?v=1.0.1"),alt:"default-avatar",width:u,height:h}):(0,l.jsx)(d(),{ref:x,screenshotFormat:"image/png",width:u,height:h,mirrored:!1,videoConstraints:N&&!z?{deviceId:{exact:T}}:{facingMode:j,width:{min:640,ideal:1920,max:3840},height:{min:480,ideal:1080,max:2160}},style:{objectFit:"cover",borderRadius:"8px",transform:"user"==j?"scaleX(-1)":"scaleX(1)"}},"".concat(S,"-").concat(j)),null===w||void 0===w?void 0:w.map((e,t)=>y===t&&(0,l.jsx)("textarea",{id:"text-".concat(t),name:"text-".concat(t),value:e.text,onChange:Y,wrap:"hard",style:{position:"absolute",top:"".concat(e.y/U-(e.fontSize*e.scale*D(e.text)+e.scale*U)/2,"px"),left:"".concat(e.x/W-X(e)/2-(B?3:0),"px"),width:"".concat(X(e),"px"),height:"".concat(e.fontSize*e.scale*D(e.text)+5,"px"),fontSize:"".concat(e.fontSize*e.scale,"px"),fontFamily:e.fontFamily||"Arial",transform:"rotate(".concat(e.rotation||0,"deg)"),textAlign:e.align||"center",transformOrigin:"center center",background:e.backgroundColor||"transparent",color:e.color||"#000",overflow:"hidden",border:"none",outline:"none",padding:0,maxWidth:"300px",wordBreak:"break-word",whiteSpace:"pre-wrap",overflowWrap:"break-word",resize:"none"}},t)),B&&!s?(0,l.jsx)("button",{onClick:q,children:(0,l.jsx)("img",{src:"".concat(i.on,"images/photobooth/camera-flip.svg"),alt:"flip-camera"})}):null,r?(0,l.jsxs)("div",{className:"pb_viewframe",children:[(0,l.jsx)("img",{src:"".concat(i.on,"images/photobooth/viewframe-white@3x.svg"),alt:"viewframe"})," ",(0,l.jsx)("span",{children:r})]}):null]})})},R=o.memo(C),E=e=>{let{addSticker:t,loading:a,stickers:n,selectedStickers:o}=e;return(0,l.jsx)("div",{className:"pb_tabs_content_box",children:(0,l.jsx)("div",{className:"pb_list_items pb_stickers",children:n.map((e,n)=>{const i=null===o||void 0===o?void 0:o.find(t=>(null===t||void 0===t?void 0:t.url)==e);return(0,l.jsx)("img",{onClick:a?null:()=>t(e),style:{cursor:a?"not-allowed":"pointer"},className:i?"active":"",src:"".concat(e,"?v=").concat(g),alt:"sticker",width:64,height:64},n)})})})};var T=a(25825);const A=["font","align","color","bg"],N=["Georgia","Arial","Helvetica","Times New Roman","Courier New","Verdana","Tahoma","Trebuchet MS","Comic Sans MS","Impact","Lucida Console","Roboto","Open Sans"],F=["left","center","right"],P=["white","black","transparent"],L=e=>{var t,a;let{canvasElements:s,setCanvasElements:c,activeTextIndex:r,addTextElement:d}=e;const[u,h]=(0,o.useState)(0),m=(0,o.useRef)(null);return(0,o.useEffect)(()=>{const e=e=>{m.current&&!m.current.contains(e.target)&&h(!1)};return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}},[]),(0,l.jsxs)(l.Fragment,{children:[u?(0,l.jsx)("div",{ref:m,children:(0,l.jsx)(T.xk,{color:null!==(t=null===(a=s[r])||void 0===a?void 0:a.color)&&void 0!==t?t:"black",onChange:e=>c(t=>t.map((t,a)=>a===r?(0,n.A)((0,n.A)({},t),{},{color:e.hex}):t))})}):null,(0,l.jsxs)("div",{className:"pb_tabs_content_box",children:[(0,l.jsx)("div",{className:"pb_text",children:A.map(e=>(0,l.jsxs)("div",{className:"pb_text_box",onClick:()=>(e=>{if(null!==r){const u={};if("color"===e)return void h(1);if("align"===e){var t,a;const e=null!==(t=null===(a=s[r])||void 0===a?void 0:a.align)&&void 0!==t?t:"center",n=F.find(t=>t===e);u.align=F[(F.indexOf(n)+1)%F.length]}else if("bg"===e){var o,i;const e=null!==(o=null===(i=s[r])||void 0===i?void 0:i.backgroundColor)&&void 0!==o?o:"transparent",t=P.find(t=>t===e);u.backgroundColor=P[(P.indexOf(t)+1)%P.length]}else if("font"===e){var l,d;const e=null!==(l=null===(d=s[r])||void 0===d?void 0:d.fontFamily)&&void 0!==l?l:"Arial",t=Math.max(0,N.indexOf(e));u.fontFamily=N[(t+1)%N.length]}c(e=>e.map((e,t)=>t===r?(0,n.A)((0,n.A)({},e),u):e))}})(e),children:[(0,l.jsx)("img",{src:"".concat(i.th,"/media/images/photobooth/text/").concat(e,".png?v=1"),alt:e}),(0,l.jsx)("p",{children:e})]},e))}),(0,l.jsx)("div",{className:"pb_add_text",children:(0,l.jsx)("p",{onClick:d,children:"Add Text"})})]})]})},z=e=>{let{loading:t,imgUrl:a,imgList:n,setImgUrl:o,tabKey:s,capturedImage:c=null}=e;return(0,l.jsx)("div",{className:"pb_tabs_content_box",children:(0,l.jsx)("div",{className:"pb_list_items pb_".concat(s),children:["".concat(i.th,"/media/images/photobooth/").concat(s,"/none.png"),...n].map((e,n)=>{const i=a?a===e:0===n;return(0,l.jsxs)("div",{className:"pb_list_images ".concat(i?"active":""),children:[c&&0!==n?(0,l.jsx)("img",{className:"pb_list_user_img",src:null===c||void 0===c?void 0:c.src,alt:"captured-image",width:64,height:64}):null,(0,l.jsx)("img",{style:{cursor:t?"not-allowed":"pointer"},src:"".concat(e,"?v=").concat(g),alt:"img-".concat(n),className:"pb_list_frames",width:64,height:64,onClick:t?null:()=>o(0==n?null:e)})]},n)})})})},D=e=>{let{capturedImage:t,uploadFile:a,canvasRef:n,canvasCursor:s,selectedBg:r,setSelectedBg:d,selectedFrame:u,setSelectedFrame:h,addSticker:g,addTextElement:x,onMouseDown:p,onMouseMove:f,onMouseUp:b,canvasElements:w,setCanvasElements:y,activeTextIndex:k,loading:_,selectedStickers:j,photoBoothSettings:M,setActiveStickerIndex:S,setActiveTextIndex:I,activeText:C}=e;const[T,A]=(0,o.useState)("background"),[N,F]=(0,o.useState)([]),[P,D]=(0,o.useState)([]),[B,W]=(0,o.useState)([]);return(0,o.useEffect)(()=>{"text"===T&&0===w.length&&x(),"text"!==T?I(null):"sticker"!==T&&S(null)},[T]),(0,o.useEffect)(()=>{const e=(0,v.S3)((null===M||void 0===M?void 0:M.photo_booth_frames)||[]),t=(0,v.S3)((null===M||void 0===M?void 0:M.photo_booth_backgrounds)||[]),a=(0,v.S3)((null===M||void 0===M?void 0:M.photo_booth_stickers)||[]);D(null===e||void 0===e?void 0:e.map(e=>"".concat(i.on,"images/photobooth/frames/").concat(e))),F(null===t||void 0===t?void 0:t.map(e=>"".concat(i.on,"images/photobooth/backgrounds/").concat(e))),W(null===a||void 0===a?void 0:a.map(e=>"".concat(i.on,"images/photobooth/stickers/").concat(e)))},[]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"pb_customization",children:[(0,l.jsx)(R,{loading:_,capturedImage:t,canvasRef:n,canvasCursor:s,onMouseDown:p,onMouseMove:f,onMouseUp:b,canvasElements:w,activeTextIndex:k,setCanvasElements:y,activeText:C}),(0,l.jsxs)("div",{className:"pb_tabs",children:[(0,l.jsx)("div",{className:"pb_tabs_list",children:m.map(e=>(0,l.jsx)("button",{onClick:()=>A(e.id),className:T===e.id?"active":"",children:e.label},e.id))}),(0,l.jsx)("div",{className:"pb_tabs_content",children:"background"===T?(0,l.jsx)(z,{loading:_,imgUrl:r,imgList:N,setImgUrl:d,tabKey:"backgrounds"}):"frame"===T?(0,l.jsx)(z,{imgUrl:u,imgList:P,setImgUrl:h,tabKey:"frames",capturedImage:t}):"sticker"===T?(0,l.jsx)(E,{stickers:B,addSticker:g,loading:_,selectedStickers:j}):"text"===T?(0,l.jsx)(L,{canvasElements:w,setCanvasElements:y,activeTextIndex:k,addTextElement:x}):null})]})]}),(0,l.jsx)("div",{className:"pb_continue_buttons_main",children:(0,l.jsx)(c,{className:"pb_continue_buttons",children:"Continue",onClick:()=>{if(null!==n&&void 0!==n&&n.current){const e=n.current;S(null),I(null),setTimeout(()=>{const t=e.toDataURL("image/png",1);t&&a(2,t)},100)}}})})]})};function B(e){const{snapType:t,uploadType:a,rawImage:n,capturedImage:o,wall:s,uploadImg:c,backAction:r}=e,d=1===t&&1===a||3===t&&!n&&!o;return(0,l.jsxs)("div",{className:"pb_header_bar",onClick:d?()=>window.location.href="".concat(x.iT).concat(s.Wall.id,"?social-wall=true"):r,children:[(0,l.jsx)("img",{src:"".concat(i.th,"/media/images/photobooth/arrow-back.svg"),alt:"arrow-back"}),(0,l.jsx)("span",{className:"header-title",children:d?"Back to Wall":"Back"})]})}var W=a(69522);const U=e=>{let{imageUrl:t,photoBtnRef:a,customiseImage:n}=e;const s=(0,o.useRef)(null),c=(0,o.useRef)(null),r=(0,o.useRef)(null),d=(0,o.useRef)(1),[u,h]=(0,o.useState)(!0),[m,g]=(0,o.useState)({width:200,height:200}),[v,x]=(0,o.useState)({x:0,y:0}),[p,f]=(0,o.useState)(1),b=320,w=320,y=(0,o.useCallback)(()=>{const e=c.current;if(!e)return console.error("Original image not loaded."),null;const t=e.naturalWidth/m.width,a=e.naturalHeight/m.height,o=-v.x/p*t,i=-v.y/p*a,l=b/p*t,s=w/p*a,r=document.createElement("canvas");r.width=l,r.height=s;r.getContext("2d").drawImage(e,o,i,l,s,0,0,l,s),r.toBlob(e=>{if(e){const t=new File([e],"capture.png",{type:"image/png"});n(t)}},"image/png")},[v,p,m,b,w,n]);(0,o.useEffect)(()=>{const e=new Image;e.crossOrigin="anonymous",e.onload=()=>{const t=e.width/e.height;let a,n;t>1?(n=w,a=n*t):(a=b,n=a/t),g({width:a,height:n}),x({x:(b-a)/2,y:(w-n)/2})},e.src=t},[t]);const k=m.width*p,_=m.height*p,j=e=>{const[t,a]=e,n=t.clientX-a.clientX,o=t.clientY-a.clientY;return Math.sqrt(n*n+o*o)},M=e=>{2===e.touches.length&&(r.current=j(e.touches),d.current=p)},S=e=>{if(2===e.touches.length){e.preventDefault();const t=j(e.touches),a=r.current,n=d.current;if(!a||!n)return;const o=t/a;let i=Math.max(1,n*o);f(i)}};return(0,o.useEffect)(()=>{const e=s.current;if(e)return e.addEventListener("touchstart",M,{passive:!1}),e.addEventListener("touchmove",S,{passive:!1}),()=>{e.removeEventListener("touchstart",M),e.removeEventListener("touchmove",S)}},[p]),(0,o.useEffect)(()=>{const e=setTimeout(()=>{h(!1)},2500);return()=>clearTimeout(e)},[]),(0,l.jsxs)("div",{style:{position:"relative",overflow:"hidden",margin:"0px auto 30px",background:"#f9f9f9",touchAction:"none",border:"2px dashed #aaa",borderRadius:"8px"},onWheel:e=>{e.preventDefault();const t=e.deltaY<0?.05:-.05,a=Math.max(1,p+t);if(a<=1.01&&k<=b&&_<=w){f(1);const e=(b-m.width)/2,t=(w-m.height)/2;x({x:e,y:t})}else f(a)},children:[(0,l.jsx)("div",{style:{width:b,height:w},ref:s,children:(0,l.jsx)(W.p,{size:{width:k,height:_},position:v,enableResizing:!1,disableDragging:!1,onDragStop:(e,t)=>{let a=t.x,n=t.y;const o=Math.max(0,k-b),i=Math.max(0,_-w);a=Math.min(Math.max(a,-o),0),n=Math.min(Math.max(n,-i),0),x({x:a,y:n})},style:{zIndex:2,pointerEvents:"auto"},children:(0,l.jsx)("img",{ref:c,src:t,alt:"Editable",style:{width:"100%",height:"100%",objectFit:"cover",userSelect:"none",pointerEvents:"none"}})})}),(0,l.jsx)("button",{ref:a,style:{display:"none",position:"absolute",top:10,right:10,zIndex:400},onClick:y,children:"Capture"}),u?(0,l.jsxs)("div",{className:"pb_take_photo_crop",children:[(0,l.jsx)("img",{src:"".concat(i.th,"/media/images/photobooth/arrow-left.svg"),alt:"arrow-left",width:50,height:50}),(0,l.jsx)("img",{src:"".concat(i.th,"/media/images/photobooth/arrow-right.svg"),alt:"arrow-right",width:50,height:50})]}):null]})};a(41377);const Y=e=>{var t;let{uploadType:a,rawImage:n,takePhoto:s,canvasRef:r,canvasCursor:d,setRawImage:u,customisePhoto:h}=e;const m=(0,o.useRef)(null),g=(0,o.useRef)(null),v=(0,o.useRef)(null),[x,p]=(0,o.useState)(null),[w,y]=(0,o.useState)("capture"),[k,_]=(0,o.useState)(0),[j,M]=(0,o.useState)(null),S=(0,o.useCallback)(async()=>{["Smile",3,2,1,0].forEach((e,t)=>{setTimeout(()=>p(e),1e3*t)})},[]),I=(0,o.useCallback)(()=>{y("capture"),u(null)},[]),C=(0,o.useCallback)(e=>{var t,a;const n=null===e||void 0===e||null===(t=e.target)||void 0===t||null===(a=t.files)||void 0===a?void 0:a[0];_(k+1),b(n,"file",e=>s(e,!0))},[k]),E=(0,o.useCallback)(async e=>{var t;y(e),"capture"===e&&await S(),"upload"===e&&null!==m&&void 0!==m&&m.current&&await(null===m||void 0===m||null===(t=m.current)||void 0===t?void 0:t.click())},[]);(0,o.useEffect)(()=>{var e;if(0===x&&(null!==g&&void 0!==g&&null!==(e=g.current)&&void 0!==e&&e.video)){p(null);const e=g.current.video;if(!e)return;const t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;const a=t.getContext("2d");a.translate(t.width,0),a.scale(-1,1),a.drawImage(e,0,0,t.width,t.height),t.toBlob(e=>{const t=new File([e],"captured-photo.png",{type:"image/png",lastModified:Date.now()});((e,t,a)=>{let n="blob"==t?f(e,"camera.png"):e;if(n){const e=URL.createObjectURL(n);e&&a&&a(e)}})(t,"file",()=>s(URL.createObjectURL(t),!0))},"image/png")}},[x]);return(0,o.useEffect)(()=>{/Safari/i.test(navigator.userAgent)&&!/Chrome/i.test(navigator.userAgent)||(async()=>{try{const e=await navigator.mediaDevices.getUserMedia({video:!0});g.current&&(g.current.srcObject=e),M("granted")}catch(e){if(console.warn("Camera error:",e.name,e.message),navigator.permissions&&navigator.permissions.query)try{const e=await navigator.permissions.query({name:"camera"});return void M(e.state)}catch(t){console.log("Permissions API not supported (Safari likely)")}M("prompt")}})()},[]),(0,o.useEffect)(()=>{const e=async()=>{try{const e=await navigator.permissions.query({name:"camera"});e.state!==j&&M(e.state)}catch(e){console.warn("Permissions API not fully supported",e)}};return setInterval(e,2e3),()=>{clearInterval(e)}},[j]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"pb_user_photo_box",children:[n?(0,l.jsx)(U,{photoBtnRef:v,imageUrl:null!==(t=null===n||void 0===n?void 0:n.src)&&void 0!==t?t:"",customiseImage:e=>{b(e,"file",e=>s(e,!1)),setTimeout(h,100)}}):null,(0,l.jsxs)(l.Fragment,{children:[" ",(0,l.jsx)(R,{cameraPermission:j,mode:w,rawImage:n,canvasRef:r,canvasCursor:d,webcamRef:g,counter:x}),(0,l.jsxs)("div",{id:"camera-disabled-message",className:"pb-camera-disabled",style:{display:"granted"===j||n?"none":"flex"},children:[(0,l.jsx)("img",{src:"".concat(i.on,"images/photobooth/camera-disabled.svg"),alt:"camera-disabled"}),(0,l.jsxs)("p",{className:"pb_camera_disabled_text",children:["Please reload and allow camera",(0,l.jsx)("br",{}),"access when prompted."]}),(0,l.jsxs)("p",{className:"pb_camera_disabled_text_bottom",children:["In case this doesn't work, please",(0,l.jsx)("br",{}),"check the camera permissions in ",(0,l.jsx)("br",{}),"your browser settings."]})]})]}),n?(0,l.jsxs)("div",{className:"pb_take_photo",children:[(0,l.jsx)(c,{className:"pb_buttons_transparent",icon:"retake",children:"Try Again",onClick:I}),(0,l.jsx)(c,{className:"pb_buttons heighlight",children:"Looks Good!",onClick:()=>{var e;return null===v||void 0===v||null===(e=v.current)||void 0===e?void 0:e.click()}})]}):(0,l.jsxs)("div",{className:"pb_user_buttons",children:["granted"===j?(0,l.jsx)(c,{className:"pb_buttons heighlight",icon:"camera",children:"Strike a Pose",onClick:()=>E("capture")}):null,(0,l.jsx)(c,{className:"pb_buttons",icon:"upload",children:"Upload from Gallery",onClick:()=>E("upload")})]})]}),(0,l.jsx)("input",{ref:m,type:"file",accept:"image/*",style:{display:"none"},onChange:C},k)]})};var X=a(48768);const O=()=>(0,l.jsx)("div",{className:"pb_overlay_main",children:(0,l.jsxs)("div",{className:"pb_overlay_content",children:[(0,l.jsx)("img",{src:"".concat(i.on,"logos/socialwalls.gif"),alt:"loading",width:50,height:50}),(0,l.jsxs)("div",{className:"text-fade",children:[(0,l.jsx)("span",{children:"Mapping the subject to understand its unique shape"}),(0,l.jsx)("span",{children:"Defining the boundaries with razor-sharp precision"}),(0,l.jsx)("span",{children:"Enhancing the subject's prominence by removing the noise"}),(0,l.jsx)("span",{children:"Presenting your subject, now a standalone masterpiece"})]})]})}),H=e=>{var t,a,i,c;const r=(0,o.useRef)(null),d=(0,o.useRef)({}),m=(0,o.useRef)({}),[b,S]=(0,o.useState)(!1),[C,R]=(0,o.useState)(!1),[E,T]=(0,o.useState)(null),[A,N]=(0,o.useState)(null),[F,P]=(0,o.useState)(null),[L,z]=(0,o.useState)(!1),[W,U]=(0,o.useState)(0),[H,q]=(0,o.useState)(null),[G,K]=(0,o.useState)(null),[V,J]=(0,o.useState)([]),[Q,Z]=(0,o.useState)([]),[$,ee]=(0,o.useState)(null),[te,ae]=(0,o.useState)(null),[ne,oe]=(0,o.useState)(null),[ie,le]=(0,o.useState)(null===e||void 0===e?void 0:e.snapType),[se,ce]=(0,o.useState)(null),[re,de]=(0,o.useState)(null),[ue,he]=(0,o.useState)(null),[me,ge]=(0,o.useState)(null),[ve,xe]=(0,o.useState)(null),[pe,fe]=(0,o.useState)("default"),[be,we]=(0,o.useState)({width:u,height:h}),ye=(0,o.useMemo)(v.qs,[]),ke=e=>{S(e)},_e=e=>{const t=r.current,a=t.getBoundingClientRect();return{x:(e.clientX-a.left)*(t.width/a.width),y:(e.clientY-a.top)*(t.height/a.height)}},je=e=>{const t=null===r||void 0===r?void 0:r.current;if(!t||null===e||void 0===e||!e.text)return 0;const a=t.getContext("2d");if(!a)return 0;a.save(),a.font="".concat(e.fontSize||20,"px ").concat(e.fontFamily||"Arial");const n=e.text.split("\n"),o=Math.max(...n.map(e=>a.measureText(e).width));return a.restore(),o};(0,o.useEffect)(()=>{if(!A)return;const e=r.current;if(!e)return;const t=e.getContext("2d"),a=be.width,n=be.height;e.width=a,e.height=n;const{initialWidthRatio:o,initialHeightRatio:i}=I(A),l=Math.max(o,i),s=document.createElement("canvas");s.width=a,s.height=n;const c=s.getContext("2d");c.clearRect(0,0,a,n);let u=A;$&&G&&F&&(u=F,c.drawImage(G,0,0,a,n)),c.drawImage(u,0,0,a,n),c.globalCompositeOperation="source-over",H&&c.drawImage(H,0,0,a,n),V.forEach((t,a)=>{const n=t.img.width*t.scale,o=t.img.height*t.scale,i=t.x+n/2,s=t.y+o/2,r=.04*Math.max(e.width,e.height),u=.05*Math.max(e.width,e.height);if(c.save(),c.translate(i,s),c.rotate((t.rotation||0)*Math.PI/180),c.drawImage(t.img,-n/2,-o/2,n,o),a===ue){c.strokeStyle="#2b2b2b",c.lineWidth=2*l,c.setLineDash([5,3]),c.strokeRect(-n/2,-o/2,n,o),c.setLineDash([]);const e="\u2921",h=n/2,m=o/2;c.fillStyle="#000",c.beginPath(),c.arc(h,m-6,r,0,2*Math.PI),c.fill(),c.fillStyle="white",c.font="bold ".concat(22*l,"px Arial"),c.textAlign="center",c.textBaseline="middle",c.fillText(e,h,m-5);const g=n/2,v=-o/2;c.beginPath(),c.fillStyle="#000",c.arc(g,v,r,0,2*Math.PI),c.fill(),c.fillStyle="#fff",c.font="bold ".concat(22*l,"px Arial"),c.textAlign="center",c.textBaseline="middle",c.fillText("\u27f3",g,v);const x=24,p=-n/2-x/2+5,f=-o/2-x/2+8,b=((e,t,a,n,o)=>{const i=o*Math.PI/180,l=Math.cos(i),s=Math.sin(i);return{x:a+(e-a)*l-(t-n)*s,y:n+(e-a)*s+(t-n)*l}})(i+p,s+f,i,s,t.rotation||0);d.current[a]={x:b.x,y:b.y,size:x},c.beginPath(),c.arc(p+4,f+4,r,0,2*Math.PI),c.fillStyle="black",c.fill(),c.fillStyle="#fff",c.font="bold ".concat(u,"px Arial"),c.textAlign="center",c.textBaseline="middle",c.fillText("\u2715",p+5,f+5)}c.restore()}),Q.forEach((e,t)=>{var a;c.save(),c.translate(e.x,e.y),c.rotate(e.rotation*Math.PI/180),c.scale(e.scale,e.scale),c.font="".concat(e.fontSize*l,"px ").concat(e.fontFamily||"Arial"),c.textAlign=e.align||"center",c.textBaseline="middle";const n=(null===(a=e.text)||void 0===a?void 0:a.split("\n"))||[],o=n.length,i=e.fontSize*l;c.font="".concat(i,"px ").concat(e.fontFamily||"Arial"),c.textAlign=e.align||"center",c.textBaseline="middle";const s=Math.max(...n.map(e=>c.measureText(e).width)),r=1.2*i,d=15*l,u=s+2*d,h=r*o+2*d,g=u,v=h,x=-g/2;if(e.backgroundColor&&(c.fillStyle=e.backgroundColor,c.fillRect(x,-v/2,g,v)),t!==re&&(c.fillStyle=e.color||"#000000",n.forEach((e,t)=>{let a=0;"center"==c.textAlign?a=0:"left"==c.textAlign?a=-g/2+10:"right"==c.textAlign&&(a=g/2-10),c.fillText(e,a,t*r-(n.length-1)*r/2)})),t===re){c.strokeStyle="#2b2b2b",c.lineWidth=2*l,c.setLineDash([5,3]),c.strokeRect(x,-v/2,g,v),c.setLineDash([]);const a=22,n=(e.rotation||0)*Math.PI/180,o=-u/2-a/2,i=-h/2-a/2,s=e.x+o*Math.cos(n)-i*Math.sin(n),r=e.y+o*Math.sin(n)+i*Math.cos(n);m.current[t]={x:s,y:r,size:Math.max(ye?15:10,a*e.scale)},c.fillStyle="black",c.beginPath(),c.arc(x,-v/2,14*l,0,2*Math.PI),c.fill(),c.fillStyle="#fff",c.font="bold ".concat(16*l,"px Arial"),c.textAlign="center",c.textBaseline="middle",c.fillText("\u2715",x,-v/2+2),c.fillStyle="black",c.beginPath(),c.arc(x+g,-v/2,14*l,0,2*Math.PI),c.fill(),c.fillStyle="white",c.font="bold ".concat(24*l,"px Arial"),c.textAlign="center",c.textBaseline="middle",c.fillText("\u27f3",x+g+1,-v/2-1),c.fillStyle="black",c.beginPath(),c.arc(x+g,v/2,14*l,0,2*Math.PI),c.fill(),c.fillStyle="white",c.font="bold ".concat(24*l,"px Arial"),c.textAlign="center",c.textBaseline="middle",c.fillText("\u2921",x+g,v/2)}c.restore()}),t.clearRect(0,0,a,n),t.drawImage(s,0,0)},[A,F,H,V,ue,Q,re,G,L,be,ie]),(0,o.useEffect)(()=>{if(!$)return void K(null);const t=new Image;t.crossOrigin="anonymous",t.src="https://cdn.taggbox.com/v7/".concat($,"?v=").concat(g),ke(!!F),t.onload=async()=>{if(!F){var a,n,o,i;R(!0);const t=await(async(e,t)=>{try{var a,n;if(!t)return e;const o=await f(e,"photo-booth-".concat(t,".png")),i=new FormData;i.append("media",o);const l=await(new p.A).post("".concat(x.M_,"/").concat(t),i,{headers:{"Content-Type":"multipart/form-data"}});return null!==(a=null===l||void 0===l||null===(n=l.data)||void 0===n?void 0:n.responseData)&&void 0!==a?a:null}catch(o){return e}})(null!==(a=null===A||void 0===A?void 0:A.src)&&void 0!==a?a:"",null!==(n=null===e||void 0===e||null===(o=e.wall)||void 0===o||null===(i=o.Wall)||void 0===i?void 0:i.owner)&&void 0!==n?n:"");if(t){const e=new Image;e.crossOrigin="anonymous",e.src="https://cdn.taggbox.com/v7/".concat(t,"?v=").concat(g),e.onload=()=>{P(e),R(!1)},e.onerror=()=>{P(null),R(!1),console.error("Failed to load background transparent image: ".concat($))}}}K(t),ke(!1)},t.onerror=()=>{console.error("Failed to load background image: ".concat($)),ke(!1)}},[$]),(0,o.useEffect)(()=>{if(!te)return void q(null);const e=new Image;e.crossOrigin="anonymous",e.src="https://cdn.taggbox.com/v7/".concat(te,"?v=").concat(g),ke(!0),e.onload=()=>{q(e),ke(!1)},e.onerror=()=>{console.error("Failed to load frame image: ".concat(te)),ke(!1)}},[te]),(0,o.useEffect)(()=>{let e=0,t=!1;const a=[".pb_tabs_content_box",".pb_photo_booth_h_review"],n=n=>{e=n.touches[0].clientY;const o=n.target.closest(a.join(","));t=!!o},o=a=>{if(t)return;const n=document.documentElement.scrollTop||document.body.scrollTop,o=a.touches[0].clientY-e;0===n&&o>0&&a.preventDefault()};return document.addEventListener("touchstart",n,{passive:!1}),document.addEventListener("touchmove",o,{passive:!1}),()=>{document.removeEventListener("touchstart",n),document.removeEventListener("touchmove",o)}},[]);const Me=(e,t)=>{le(e),oe(t),U(0)};return(0,l.jsx)("div",{className:"pb_photo_booth_main",children:(0,l.jsx)("div",{className:"pb_photo_booth_box",children:(0,l.jsxs)("div",{className:"pb_photo_booth_box_inner",children:[(0,l.jsx)(B,{snapType:e.snapType,rawImage:E,capturedImage:A,uploadImg:ne,uploadType:ie,wall:null===e||void 0===e?void 0:e.wall,backAction:()=>{L?(T(A),ne&&!W?(z(!0),U(1),le(3),T(0)):(z(!1),U(0))):(z(!1),T(null),le(E?ne&&2===ie?3:ie:null===e||void 0===e?void 0:e.snapType))}}),(0,l.jsx)("div",{className:"pb_photo_booth_h ".concat(2===ie?"pb_photo_booth_h_review":""),children:1==ie?(0,l.jsx)(s,{uploadFile:Me}):(0,l.jsx)(l.Fragment,{children:2===ie?(0,l.jsx)(X.default,{isPhotoBooth:ne,photoBoothInterface:1,wall:null===e||void 0===e?void 0:e.wall,wallId:null===e||void 0===e||null===(t=e.wall)||void 0===t||null===(a=t.Wall)||void 0===a?void 0:a.id,feeds:null===e||void 0===e?void 0:e.feeds,isFreeAdsStatus:null===e||void 0===e?void 0:e.isFreeAdsStatus}):L?(0,l.jsx)(D,{loading:b,capturedImage:A,uploadFile:Me,canvasRef:r,canvasCursor:pe,selectedBg:$,setSelectedBg:ee,selectedFrame:te,setSelectedFrame:ae,addSticker:e=>{const t=new Image;t.crossOrigin="anonymous",ke(!0),t.src="https://cdn.taggbox.com/v7/".concat(e,"?v=").concat(g),t.onload=()=>{ke(!1);const a=be.width,n=be.height,o=a/(ye?4:3),i=t.height/t.width*o,l=o/t.width;t.height=t.height*l,t.width=t.width*l,de(null),J(l=>{const s=[...l,{img:t,x:a/2-o/2,y:n/2-i/2,scale:1,url:e,rotation:0}];return he(s.length-1),s})},t.onerror=()=>{ke(!1),console.error("Failed to load sticker image: ".concat(e))}},addTextElement:()=>{const e={text:"Your Text Here",x:be.width/2,y:be.height/2,scale:1,rotation:0,fontSize:28,fontFamily:"Georgia",color:"#000000",backgroundColor:"white",align:"center"};he(null),Z(t=>{const a=[...t,e];return de(a.length-1),a})},onMouseDown:e=>{const{x:t,y:a}=_e(e);let n=!1,o=!1;for(let s=V.length-1;s>=0;s--){const e=V[s],{initialHeightRatio:o,initialWidthRatio:i}=I(A),l=d.current[s];if(l){const{x:e,y:n,size:c}=l,r=t-e,d=a-n;if(Math.sqrt(r*r+d*d)<=Math.max(c,5*(i+o))*(ye?1.5:1))return J(e=>e.filter((e,t)=>t!==s)),void he(null)}if(k(e,t,a,A)){he(s),ge("rotate"),xe({x:t,y:a,centerX:e.x+e.img.width*e.scale/2,centerY:e.y+e.img.height*e.scale/2,initialAngle:e.rotation||0}),n=!0;break}if(w(e,t,a,A)){he(s),ge("resize"),xe({x:t,y:a,initialScale:e.scale,initialWidth:e.img.width}),n=!0;break}if(y(e,t,a)){he(s),ge("move"),xe({x:t,y:a,initialX:e.x,initialY:e.y}),n=!0;break}}if(!n){const{initialHeightRatio:e,initialWidthRatio:n}=I(A);for(let s=Q.length-1;s>=0;s--){var i;const c=Q[s],r=je(c),d=null===(i=m.current)||void 0===i?void 0:i[s];if(d){const{x:o,y:i,size:l}=d,c=Q[s].scale||1,u=t-o,h=a-i;let m=1;c<.5?m=3.5:c<.6?m=3:c<.7?m=2.4:c<.8?m=1.9:c<.93&&(m=1.6);if(Math.sqrt(u*u+h*h)/m<Math.max(l,.02*r*c*(2*(n+e))))return Z(e=>e.filter((e,t)=>t!==s)),de(null),void ce(null)}if(M(c,t,a,r,A)){de(s),ce(null),ge("rotate-text"),xe({x:t,y:a,centerX:c.x,centerY:c.y,initialAngle:c.rotation||0}),o=!0;break}if(j(c,t,a,r,A)){ce(null),de(s),he(null),ge("resize-text"),xe({x:t,y:a,initialScale:c.scale,initialWidth:r}),o=!0;break}if(_(c,t,a,r,A)){var l;ce({index:s,count:re==s?(null===se||void 0===se?void 0:se.count)>=2?2:(null!==(l=null===se||void 0===se?void 0:se.count)&&void 0!==l?l:0)+1:1}),de(s),ge("move-text"),xe({x:t,y:a,initialX:c.x,initialY:c.y}),o=!0;break}}}n||o||(he(null),de(null),ge(null),xe(null),ce(null))},onMouseMove:e=>{const{x:t,y:a}=_e(e);let o="default",i=!1;for(let n=Q.length-1;n>=0;n--){const e=Q[n],l=je(e);if(M(e,t,a,l,A)){o="crosshair",i=!0;break}if(j(e,t,a,l,A)){o="nwse-resize",i=!0;break}if(_(e,t,a,l,A)){o="grab",i=!0;break}}if(!i)for(let n=V.length-1;n>=0;n--){const e=V[n];if(k(e,t,a,A)){o="crosshair",i=!0;break}if(w(e,t,a,A)){o="nwse-resize",i=!0;break}if(y(e,t,a)){o="grab",i=!0;break}}if("move"!==me||null===ue&&null===re||(o="grabbing"),fe(o),!me||!ve)return;const l=t-ve.x,s=a-ve.y;null!==ue&&J(e=>{const o=[...e],i=(0,n.A)({},o[ue]);if("move"===me)i.x=ve.initialX+l,i.y=ve.initialY+s;else if("resize"===me){const e=ve.initialWidth*ve.initialScale+l,t=Math.max(.05,e/i.img.width);i.scale=t}else if("rotate"===me){const e=Math.atan2(ve.y-ve.centerY,ve.x-ve.centerX),n=180*(Math.atan2(a-ve.centerY,t-ve.centerX)-e)/Math.PI;i.rotation=(ve.initialAngle+n)%360}return o[ue]=i,o}),null!==re&&Z(e=>{const o=[...e],i=(0,n.A)({},o[re]);if("move-text"===me)i.x=ve.initialX+l,i.y=ve.initialY+s;else if("resize-text"===me){const e=ve.initialWidth*ve.initialScale+l,t=Math.max(.1,e/je(i));i.scale=t}else if("rotate-text"===me){const e=Math.atan2(ve.y-ve.centerY,ve.x-ve.centerX),n=180*(Math.atan2(a-ve.centerY,t-ve.centerX)-e)/Math.PI;i.rotation=(ve.initialAngle+n)%360}return o[re]=i,o})},onMouseUp:()=>{ge(null),xe(null),fe("default")},canvasElements:Q,setCanvasElements:Z,activeTextIndex:re,photoBoothSettings:null!==(i=null===e||void 0===e||null===(c=e.wall)||void 0===c?void 0:c.PhotoBoothSettings)&&void 0!==i?i:{},selectedStickers:V,setActiveStickerIndex:he,setActiveTextIndex:de,activeText:se}):(0,l.jsx)(Y,{uploadType:ie,rawImage:E,takePhoto:async(e,t)=>{if(!e)return void console.error("Failed to capture screenshot from webcam.");const a=new Image;a.crossOrigin="anonymous",a.src=e,a.onload=async()=>{P(null),t?T(a):N(a),we({width:a.width,height:a.height})},a.onerror=()=>{console.error("Failed to load captured image.")}},canvasRef:r,canvasCursor:pe,setRawImage:T,customisePhoto:()=>{T(null),q(null),K(null),J([]),Z([]),ee(null),ae(null),de(null),he(null),z(!0)}})})}),C?(0,l.jsx)(O,{}):null]})})})}}}]);