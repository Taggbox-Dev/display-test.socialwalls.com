"use strict";(self.webpackChunkembed_widget=self.webpackChunkembed_widget||[]).push([[411,9430],{56214:(e,t,n)=>{n.r(t),n.d(t,{default:()=>R});var a=n(9950),i=n(22332),l=n(80415),o=n(44414);function s(e){let{uploadFile:t}=e;return(0,o.jsx)("div",{className:"pb_cards",children:(0,o.jsxs)("div",{className:"pb_cards_box",children:[(0,o.jsxs)("div",{onClick:()=>t(3),className:"pb_card",children:[(0,o.jsx)("div",{className:"pb_card_icon",children:(0,o.jsx)("img",{src:`${l.th}/media/images/photobooth/camera.svg`,alt:"camera"})}),(0,o.jsx)("h3",{className:"pb_card-title",children:"Photobooth"}),(0,o.jsx)("p",{className:"pb_card-description",children:" Add fun filters and effects before you share your masterpiece."})]}),(0,o.jsxs)("div",{onClick:()=>t(2),className:"pb_card",children:[(0,o.jsx)("div",{className:"pb_card_icon",children:(0,o.jsx)("img",{src:`${l.th}/media/images/photobooth/snapup.svg`,alt:"snapup"})}),(0,o.jsx)("h3",{className:"pb_card-title",children:"Snap & Share"}),(0,o.jsx)("p",{className:"pb_card-description",children:"Scan the QR code to quickly and easily upload photos from your mobile."})]})]})})}const r=e=>{let{className:t,children:n,icon:a,onClick:i}=e;return(0,o.jsxs)("button",{className:t,onClick:i,children:[a&&(0,o.jsx)("img",{src:`${l.th}/media/images/photobooth/${a}.svg`,alt:a}),n]})};var c=n(11766),d=n.n(c);const u=320,h=320,m=[{id:"background",label:"Background"},{id:"frame",label:"Frames"},{id:"sticker",label:"Stickers"},{id:"text",label:"Text"}];var g=n(52867);const x=e=>{let{capturedImage:t,mode:n,counter:i,canvasRef:s,canvasCursor:r,webcamRef:c,onMouseDown:m,onMouseMove:x,onMouseUp:f,canvasElements:v,activeTextIndex:p,setCanvasElements:b,loading:w}=e;const[S,y]=(0,a.useState)("user"),k=e=>e?e.split("\n").length:1,M=(0,a.useMemo)(g.qs,[]),j=e=>{const t=e.target.value;if((null===t||void 0===t?void 0:t.length)<=35){const e=(e=>{if(!s.current||!v[p])return e;const t=v[p],n=document.createElement("canvas").getContext("2d"),a=t.fontSize||16,i=t.fontFamily||"Arial";n.font=`${a}px ${i}`;const l=e.split(/\s+/);let o="",r="";for(let s=0;s<l.length;s++){const e=l[s],t=o?o+" "+e:e,{width:a}=n.measureText(t);a>280&&o?(r+=o+"\n",o=e):o=t}return o&&(r+=o),r})(t);b(t=>t.map((t,n)=>n===p?{...t,text:e}:t))}},_=(0,a.useCallback)(e=>{if(!e||!e.text)return 0;const t=document.createElement("canvas").getContext("2d"),n=e.fontSize||16,a=e.fontFamily||"Arial",i=e.scale||1;t.font=`${n}px ${a}`;const l=e.text.split("\n");let o=0;for(const s of l){const e=t.measureText(s).width;e>o&&(o=e)}return o*i},[v]);return(0,o.jsxs)("div",{className:"pb_user_photo "+(w?"active_blur":""),style:{position:"relative"},children:["capture"!==n||t?t?(0,o.jsx)("canvas",{ref:s,style:{cursor:r},width:u,height:h,onMouseDown:m,onMouseMove:x,onMouseUp:f,onMouseLeave:f,onTouchStart:function(e){e.preventDefault();const t=e.touches[0],n={clientX:t.clientX,clientY:t.clientY};m(n)},onTouchMove:function(e){e.preventDefault();const t=e.touches[0],n={clientX:t.clientX,clientY:t.clientY};x(n)},onTouchEnd:function(e){e.preventDefault(),f()}}):(0,o.jsx)("img",{src:`${l.th}/media/images/photobooth/avatar.png`,alt:"default-avatar",width:u,height:h}):(0,o.jsx)(d(),{ref:c,screenshotFormat:"image/png",width:u,height:h,videoConstraints:{facingMode:S,width:u,height:h},style:{objectFit:"cover",borderRadius:"8px"}}),null===v||void 0===v?void 0:v.map((e,t)=>p===t&&(0,o.jsx)("textarea",{id:`text-${t}`,name:`text-${t}`,value:e.text,onChange:j,wrap:"hard",ref:e=>{e&&e.focus()},style:{position:"absolute",top:e.y-(e.fontSize*e.scale*k(e.text)+5)/2+"px",left:e.x-_(e)/2+"px",width:`${_(e)}px`,height:e.fontSize*e.scale*k(e.text)+6+"px",fontSize:e.fontSize*e.scale+"px",fontFamily:e.fontFamily||"Arial",transform:`rotate(${e.rotation||0}deg)`,textAlign:e.align||"center",transformOrigin:"center center",background:e.backgroundColor||"transparent",color:e.color||"#000",overflow:"hidden",border:"none",outline:"none",padding:0,maxWidth:"300px",wordBreak:"break-word",whiteSpace:"pre-wrap",overflowWrap:"break-word",resize:"vertical"}},t)),M&&!t?(0,o.jsx)("button",{onClick:()=>y(e=>"user"===e?"environment":"user"),children:(0,o.jsx)("img",{src:`${l.th}/media/images/photobooth/camera-flip.svg`,alt:"flip-camera"})}):null,i?(0,o.jsxs)("div",{className:"pb_viewframe",children:[(0,o.jsx)("img",{src:`${l.th}/media/images/photobooth/viewframe-white@3x.svg`,alt:"viewframe"})," ",(0,o.jsx)("span",{children:i})]}):null]})},f=e=>{let{addSticker:t,loading:n,stickers:a,selectedStickers:i}=e;return(0,o.jsx)("div",{className:"pb_stickers",children:a.map((e,a)=>{const l=null===i||void 0===i?void 0:i.find(t=>(null===t||void 0===t?void 0:t.url)==e);return(0,o.jsx)("img",{onClick:n?null:()=>t(e),style:{cursor:n?"not-allowed":"pointer"},className:l?"active":"",src:e,alt:"sticker",width:64,height:64},a)})})},v=["font","align","color","bg"],p=["Arial","Helvetica","Times New Roman","Georgia","Courier New","Verdana","Tahoma","Trebuchet MS","Comic Sans MS","Impact","Lucida Console","Roboto","Open Sans"],b=["left","center","right"],w=["white","black","transparent"],S=e=>{let{canvasElements:t,setCanvasElements:n,activeTextIndex:a}=e;return(0,o.jsx)("div",{className:"pb_text",children:v.map(e=>{var i,s;return(0,o.jsxs)("div",{className:"pb_text_box",children:[(0,o.jsx)("img",{src:`${l.th}/media/images/photobooth/text/${e}.png?v=1`,alt:e,onClick:()=>(e=>{if(null!==a){const d={};if("align"===e){var i,l;const e=null!==(i=null===(l=t[a])||void 0===l?void 0:l.align)&&void 0!==i?i:"center",n=b.find(t=>t===e);d.align=b[(b.indexOf(n)+1)%b.length]}else if("bg"===e){var o,s;const e=null!==(o=null===(s=t[a])||void 0===s?void 0:s.backgroundColor)&&void 0!==o?o:"transparent",n=w.find(t=>t===e);d.backgroundColor=w[(w.indexOf(n)+1)%w.length]}else if("font"===e){var r,c;const e=null!==(r=null===(c=t[a])||void 0===c?void 0:c.fontFamily)&&void 0!==r?r:"Arial",n=p.find(t=>t===e);d.fontFamily=p[(p.indexOf(n)+1)%p.length]}n(e=>e.map((e,t)=>t===a?{...e,...d}:e))}})(e)}),(0,o.jsx)("p",{children:e}),"color"===e&&(0,o.jsx)("input",{type:"color",value:null!==(i=null===(s=t[a])||void 0===s?void 0:s.color)&&void 0!==i?i:"black",onChange:e=>{const t=e.target.value;n(e=>e.map((e,n)=>n===a?{...e,color:t}:e))}})]},e)})})},y=e=>{let{loading:t,imgUrl:n,imgList:a,setImgUrl:i,tabKey:s}=e;return(0,o.jsx)("div",{className:`pb_${s}`,children:[`${l.th}/media/images/photobooth/${s}/none.png`,...a].map((e,a)=>{const l=n?n===e:0===a;return(0,o.jsx)("img",{style:{cursor:t?"not-allowed":"pointer"},src:e,alt:`img-${a}`,className:l?"active":"",width:64,height:64,onClick:t?null:()=>i(0==a?null:e)},a)})})},k=e=>{let{capturedImage:t,uploadFile:n,canvasRef:i,canvasCursor:s,selectedBg:c,setSelectedBg:d,selectedFrame:u,setSelectedFrame:h,addSticker:v,addTextElement:p,onMouseDown:b,onMouseMove:w,onMouseUp:k,canvasElements:M,setCanvasElements:j,activeTextIndex:_,loading:C,selectedStickers:I,photoBoothSettings:A,setActiveStickerIndex:$,setActiveTextIndex:N}=e;const[T,F]=(0,a.useState)("background"),[P,E]=(0,a.useState)([]),[R,z]=(0,a.useState)([]),[B,U]=(0,a.useState)([]);return(0,a.useEffect)(()=>{"text"===T&&p(),"text"!==T?N(null):"sticker"!==T&&$(null)},[T]),(0,a.useEffect)(()=>{const e=(0,g.S3)((null===A||void 0===A?void 0:A.photo_booth_frames)||[]),t=(0,g.S3)((null===A||void 0===A?void 0:A.photo_booth_backgrounds)||[]),n=(0,g.S3)((null===A||void 0===A?void 0:A.photo_booth_stickers)||[]);z(null===e||void 0===e?void 0:e.map(e=>`${l.on}images/photobooth/frames/${e}`)),E(null===t||void 0===t?void 0:t.map(e=>`${l.on}images/photobooth/backgrounds/${e}`)),U(null===n||void 0===n?void 0:n.map(e=>`${l.on}images/photobooth/stickers/${e}`))},[]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"pb_customization",children:[(0,o.jsx)(x,{loading:C,capturedImage:t,canvasRef:i,canvasCursor:s,onMouseDown:b,onMouseMove:w,onMouseUp:k,canvasElements:M,activeTextIndex:_,setCanvasElements:j}),(0,o.jsxs)("div",{className:"pb_tabs",children:[(0,o.jsx)("div",{className:"pb_tabs_list",children:m.map(e=>(0,o.jsx)("button",{onClick:()=>F(e.id),className:T===e.id?"active":"",children:e.label},e.id))}),(0,o.jsx)("div",{className:"pb_tabs_content",children:(0,o.jsx)("div",{className:"pb_tabs_content_box",children:"background"===T?(0,o.jsx)(y,{loading:C,imgUrl:c,imgList:P,setImgUrl:d,tabKey:"backgrounds"}):"frame"===T?(0,o.jsx)(y,{imgUrl:u,imgList:R,setImgUrl:h,tabKey:"frames"}):"sticker"===T?(0,o.jsx)(f,{stickers:B,addSticker:v,loading:C,selectedStickers:I}):"text"===T?(0,o.jsx)(S,{canvasElements:M,setCanvasElements:j,activeTextIndex:_}):null})})]})]}),(0,o.jsx)(r,{className:"pb_continue_buttons",children:"Continue",onClick:()=>{if(null!==i&&void 0!==i&&i.current){const e=i.current;$(null),N(null),setTimeout(()=>{const t=e.toDataURL("image/png");t&&n(2,t)},100)}}})]})};function M(e){return(0,o.jsxs)("div",{className:"pb_header_bar",onClick:e.backAction,children:[(0,o.jsx)("img",{src:`${l.th}/media/images/photobooth/arrow-back.svg`,alt:"arrow-back"}),2==e.uploadType&&e.uploadImg?(0,o.jsx)("img",{className:"pb_header_logo",src:e.wall.UgcSettings.onsite_logo,height:20,width:130,alt:""}):(0,o.jsx)("span",{className:"header-title",children:"Create a New Post"})]})}const j=(e,t,n)=>{let a="blob"==t?((e,t)=>{try{const n=e.split(","),a=n[0].match(/:(.*?);/)[1],i=atob(n[1]);let l=i.length;const o=new Uint8Array(l);for(;l--;)o[l]=i.charCodeAt(l);return new File([o],t,{type:a})}catch(n){return console.error("Error converting base64 data to file:",n),null}})(e,"camera.png"):e;if(a){const e=URL.createObjectURL(a);e&&n&&n(e)}},_=(e,t,n)=>{const a=e.img.width*e.scale,i=e.img.height*e.scale;return t>e.x+a-T(15,7)&&t<e.x+a&&n>e.y+i-T(15,7)&&n<e.y+i},C=(e,t,n)=>{const a=e.img.width*e.scale,i=e.img.height*e.scale;return t>e.x&&t<e.x+a&&n>e.y&&n<e.y+i},I=(e,t,n)=>{const{img:a,scale:i,x:l,y:o,rotation:s=0}=e,r=a.width*i,c=a.height*i,d=l+r/2,u=o+c/2,h=r/2,m=-c/2-5,g=s*Math.PI/180,x=t-(d+h*Math.cos(g)-m*Math.sin(g)),f=n-(u+h*Math.sin(g)+m*Math.cos(g));return Math.sqrt(x*x+f*f)<=T(7,7)},A=(e,t,n,a)=>{const i=e.scale||1,l=e.fontSize||20,o=a*T(20),s=e.text.split("\n").length*l*i+20,r=t-e.x,c=n-e.y,d=(e.rotation||0)*Math.PI/180,u=Math.cos(-d),h=Math.sin(-d),m=(r*u-c*h)/i,g=(r*h+c*u)/i;return m>=-o/(2*i)&&m<=o/(2*i)&&g>=-s/(2*i)&&g<=s/(2*i)},$=(e,t,n,a)=>{var i;const l=e.scale||1,o=e.fontSize||20,s=(null===(i=e.text)||void 0===i?void 0:i.split("\n"))||[],r=1.2*o*Math.max(s.length,1)*l+20,c=a*l+20,d=T(16),u=e.x,h=e.y,m=c/2,g=r/2,x=(e.rotation||0)*Math.PI/180,f=t-(u+m*Math.cos(x)-g*Math.sin(x)),v=n-(h+m*Math.sin(x)+g*Math.cos(x));return f*f+v*v<(d/2)**2},N=(e,t,n,a)=>{var i;const l=e.scale||1,o=e.fontSize||20,s=T(16),r=e.x,c=e.y,d=(null===(i=e.text)||void 0===i?void 0:i.split("\n"))||[],u=(a*l+20)/2,h=-(1.2*o*Math.max(d.length,1)*l+20)/2,m=(e.rotation||0)*Math.PI/180,g=t-(r+u*Math.cos(m)-h*Math.sin(m)),x=n-(c+u*Math.sin(m)+h*Math.cos(m));return g*g+x*x<(s/2)**2},T=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,g.qs)()?.75*e+t:e};n(69522);const F=e=>{let{rawImage:t,takePhoto:n,canvasRef:i,canvasCursor:l,setRawImage:s,customisePhoto:r}=e;const c=(0,a.useRef)(null),u=(0,a.useRef)(null),[h,m]=((0,a.useRef)(null),(0,a.useState)(null)),[g,x]=(0,a.useState)("capture"),[f,v]=(0,a.useState)(0),[p,b]=(0,a.useState)(null),w=(0,a.useCallback)(async()=>{["Smile",3,2,1,0].forEach((e,t)=>{setTimeout(()=>m(e),1e3*t)})},[]),[S,y]=((0,a.useCallback)(()=>{x("capture"),s(null)},[]),(0,a.useCallback)(e=>{var t,a;const i=null===e||void 0===e||null===(t=e.target)||void 0===t||null===(a=t.files)||void 0===a?void 0:a[0];v(f+1),j(i,"file",e=>n(e,!0))},[f]),(0,a.useCallback)(async e=>{var t;x(e),"capture"===e&&await w(),"upload"===e&&null!==c&&void 0!==c&&c.current&&await(null===c||void 0===c||null===(t=c.current)||void 0===t?void 0:t.click())},[]),(0,a.useMemo)(()=>{const e=navigator.userAgent.toLowerCase(),t=/iphone|ipad|ipod|android/.test(e),n=/android/.test(e),a=e.includes("chrome")&&!e.includes("edg"),i=e.includes("edg");let l=null;return t?n&&a&&(l="chrome://settings/content/camera"):a?l="chrome://settings/content/camera":i&&(l="edge://settings/content/camera"),l},[]),(0,a.useState)(!1));return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)("div",{style:{textAlign:"center"},children:[!S&&(0,o.jsx)("button",{onClick:()=>y(!0),style:{padding:"10px 20px",fontSize:"16px",marginBottom:"10px"},children:"Start Camera"}),S&&(0,o.jsx)(d(),{ref:u,audio:!1,screenshotFormat:"image/png",videoConstraints:{facingMode:"user",width:{ideal:320},height:{ideal:320}},style:{width:"320px",height:"320px",objectFit:"cover",borderRadius:"8px"},mirrored:!0,playsInline:!0})]})})};var P=n(48768);const E="Your Text Here",R=e=>{var t,n,l,r;const c=(0,a.useRef)(null),d=(0,a.useRef)({}),m=(0,a.useRef)({}),[g,x]=(0,a.useState)(!1),[f,v]=(0,a.useState)(null),[p,b]=(0,a.useState)(null),[w,S]=(0,a.useState)(!1),[y,j]=(0,a.useState)(0),[T,R]=(0,a.useState)(null),[z,B]=(0,a.useState)(null),[U,Y]=(0,a.useState)(null),[X,O]=(0,a.useState)([]),[D,L]=(0,a.useState)([]),[W,q]=(0,a.useState)(null),[K,H]=(0,a.useState)(null),[G,Q]=(0,a.useState)(null),[V,J]=(0,a.useState)(null===e||void 0===e?void 0:e.snapType),[Z,ee]=(0,a.useState)(null),[te,ne]=(0,a.useState)(null),[ae,ie]=(0,a.useState)(null),[le,oe]=(0,a.useState)(null),[se,re]=(0,a.useState)("default"),[ce,de]=(0,a.useState)({width:u,height:h}),ue=e=>{x(e)},he=e=>{const t=c.current,n=t.getBoundingClientRect();return{x:(e.clientX-n.left)*(t.width/n.width),y:(e.clientY-n.top)*(t.height/n.height)}},me=e=>{const t=null===c||void 0===c?void 0:c.current;if(!t||null===e||void 0===e||!e.text)return 0;const n=t.getContext("2d");if(!n)return 0;n.save(),n.font=`${e.fontSize||20}px ${e.fontFamily||"Arial"}`;const a=e.text.split("\n"),i=Math.max(...a.map(e=>n.measureText(e).width));return n.restore(),i};(0,a.useEffect)(()=>{if(!p||!T)return;const e=c.current;if(!e)return;const t=e.getContext("2d"),n=ce.width,a=ce.height;e.width=n,e.height=a;const i=document.createElement("canvas");i.width=n,i.height=a;const l=i.getContext("2d");if(l.clearRect(0,0,n,a),W&&U){const e=document.createElement("canvas");e.width=n,e.height=a;const t=e.getContext("2d");t.drawImage(p,0,0,n,a),t.globalCompositeOperation="destination-in",t.drawImage(T,0,0,n,a),t.globalCompositeOperation="source-over",l.drawImage(U,0,0,n,a),l.drawImage(e,0,0,n,a)}else l.drawImage(p,0,0,n,a);l.globalCompositeOperation="source-over",z&&l.drawImage(z,0,0,n,a),X.forEach((e,t)=>{const n=e.img.width*e.scale,a=e.img.height*e.scale,i=e.x+n/2,o=e.y+a/2;if(l.save(),l.translate(i,o),l.rotate((e.rotation||0)*Math.PI/180),l.drawImage(e.img,-n/2,-a/2,n,a),t===te){l.strokeStyle="#2b2b2b",l.lineWidth=2,l.setLineDash([5,3]),l.strokeRect(-n/2,-a/2,n,a),l.setLineDash([]);const s=8,r="\u2921",c=n/2,u=a/2;l.fillStyle="#000",l.beginPath(),l.arc(c,u,s,0,2*Math.PI),l.fill(),l.fillStyle="white",l.font="bold 16px Arial",l.textAlign="center",l.textBaseline="middle",l.fillText(r,c,u);const h=n/2,m=-a/2-20+20,g=8;l.beginPath(),l.fillStyle="#000",l.arc(h,m,g,0,2*Math.PI),l.fill(),l.fillStyle="#fff",l.font="bold 16px Arial",l.textAlign="center",l.textBaseline="middle",l.fillText("\u27f3",h,m);const x=22,f=-n/2-x/2+5,v=-a/2-x/2+8;d.current[t]={x:i+f*Math.cos(e.rotation*Math.PI/180)-v*Math.sin(e.rotation*Math.PI/180),y:o+f*Math.sin(e.rotation*Math.PI/180)+v*Math.cos(e.rotation*Math.PI/180),size:x},l.beginPath(),l.arc(f,v,8,0,2*Math.PI),l.fillStyle="black",l.fill(),l.fillStyle="#fff",l.font="bold 9px Arial",l.textAlign="center",l.textBaseline="middle",l.fillText("\u2715",f,v)}l.restore()}),D.forEach((e,t)=>{var n;l.save(),l.translate(e.x,e.y),l.rotate(e.rotation*Math.PI/180),l.scale(e.scale,e.scale),l.font=`${e.fontSize}px ${e.fontFamily||"Arial"}`,l.textAlign=e.align||"center",l.textBaseline="middle";const a=(null===(n=e.text)||void 0===n?void 0:n.split("\n"))||[""],i=Math.max(...a.map(e=>l.measureText(e).width)),o=a.length,s=e.fontSize*e.scale,r=i+20,c=s*o+10,d=1.2*s,u=i+20,h=s*a.length+30,g=-u/2;if(e.backgroundColor&&(l.fillStyle=e.backgroundColor,l.fillRect(g,-h/2,u,h)),t!==Z&&(l.fillStyle=e.color||"#000000",a.forEach((e,t)=>{let n=0;"center"==l.textAlign?n=0:"left"==l.textAlign?n=-u/2+10:"right"==l.textAlign&&(n=u/2-10),l.fillText(e,n,t*d-(a.length-1)*d/2)})),t===Z){const n=document.getElementById(`text-${Z}`);n&&e.text==E&&(n.focus(),n.select()),l.strokeStyle="#2b2b2b",l.lineWidth=2,l.setLineDash([5,3]),l.strokeRect(g,-h/2,u,h),l.setLineDash([]);const a=22,i=(e.rotation||0)*Math.PI/180,o=-r/2-a/2,s=-c/2-a/2,d=e.x+o*Math.cos(i)-s*Math.sin(i),x=e.y+o*Math.sin(i)+s*Math.cos(i);m.current[t]={x:d,y:x,size:Math.max(10,a*e.scale)},l.fillStyle="black",l.beginPath(),l.arc(g,-h/2,8,0,2*Math.PI),l.fill(),l.fillStyle="#fff",l.font="bold 10px Arial",l.textAlign="center",l.textBaseline="middle",l.fillText("\u2715",g,-h/2),l.fillStyle="black",l.beginPath(),l.arc(g+u,-h/2,8,0,2*Math.PI),l.fill(),l.fillStyle="white",l.font="bold 14px Arial",l.textAlign="center",l.textBaseline="middle",l.fillText("\u27f3",g+u,-h/2),l.fillStyle="black",l.beginPath(),l.arc(g+u,h/2,8,0,2*Math.PI),l.fill(),l.fillStyle="white",l.font="bold 14px Arial",l.textAlign="center",l.textBaseline="middle",l.fillText("\u2921",g+u,h/2)}l.restore()}),t.clearRect(0,0,n,a),t.drawImage(i,0,0)},[p,T,z,X,te,D,Z,U,w,ce]),(0,a.useEffect)(()=>{if(!W)return void Y(null);const e=new Image;e.crossOrigin="anonymous",e.src=`https://cdn.taggbox.com/v7/${W}`,ue(!0),e.onload=()=>{Y(e),ue(!1)},e.onerror=()=>{console.error(`Failed to load background image: ${W}`),ue(!1)}},[W]),(0,a.useEffect)(()=>{if(!K)return void B(null);const e=new Image;e.crossOrigin="anonymous",e.src=`https://cdn.taggbox.com/v7/${K}`,ue(!0),e.onload=()=>{B(e),ue(!1)},e.onerror=()=>{console.error(`Failed to load frame image: ${K}`),ue(!1)}},[K]);const ge=(e,t)=>{J(e),Q(t)};return(0,o.jsx)("div",{className:"pb_photo_booth_main",children:(0,o.jsx)("div",{className:"pb_photo_booth_box",children:(0,o.jsxs)("div",{className:"pb_photo_booth_box_inner",children:[(0,o.jsx)(M,{uploadImg:G,uploadType:V,wall:null===e||void 0===e?void 0:e.wall,backAction:()=>{w?(v(p),G&&!y?(S(!0),j(1),J(3)):(S(!1),j(0))):(S(!1),v(null),J(f?G&&2===V?3:V:null===e||void 0===e?void 0:e.snapType))}}),(0,o.jsx)("div",{className:"pb_photo_booth_h "+(w?"":"pb_photo_booth_h_center"),children:1==V?(0,o.jsx)(s,{uploadFile:ge}):(0,o.jsx)(o.Fragment,{children:2===V?(0,o.jsx)(P.default,{isPhotoBooth:G,photoBoothInterface:1,wall:null===e||void 0===e?void 0:e.wall,wallId:null===e||void 0===e||null===(t=e.wall)||void 0===t||null===(n=t.Wall)||void 0===n?void 0:n.id,feeds:null===e||void 0===e?void 0:e.feeds,isFreeAdsStatus:null===e||void 0===e?void 0:e.isFreeAdsStatus}):w?(0,o.jsx)(k,{loading:g,capturedImage:p,uploadFile:ge,canvasRef:c,canvasCursor:se,selectedBg:W,setSelectedBg:q,selectedFrame:K,setSelectedFrame:H,addSticker:e=>{const t=new Image;t.crossOrigin="anonymous",ue(!0),t.src=`https://cdn.taggbox.com/v7/${e}`,t.onload=()=>{ue(!1);const n=ce.width,a=ce.height,i=t.height/t.width*100,l=100/t.width;ee(null),O(o=>{const s=[...o,{img:t,x:n/2-50,y:a/2-i/2,scale:l,url:e,rotation:0}];return ne(s.length-1),s})},t.onerror=()=>{ue(!1),console.error(`Failed to load sticker image: ${e}`)}},addTextElement:()=>{const e=ce.width,t=ce.height,n={text:E,x:e/2,y:t/2,scale:1,rotation:0,fontSize:28,fontFamily:"Arial",color:"#000000",backgroundColor:"white",align:"center"};ne(null),L(e=>{const t=[...e,n];return ee(t.length-1),t})},onMouseDown:e=>{const{x:t,y:n}=he(e);let a=!1,i=!1;for(let o=X.length-1;o>=0;o--){const e=X[o],i=d.current[o];if(i){const{x:e,y:a,size:l}=i,s=t-e,r=n-a;if(Math.sqrt(s*s+r*r)<l/2)return O(e=>e.filter((e,t)=>t!==o)),void ne(null)}if(I(e,t,n)){ne(o),ie("rotate"),oe({x:t,y:n,centerX:e.x+e.img.width*e.scale/2,centerY:e.y+e.img.height*e.scale/2,initialAngle:e.rotation||0}),a=!0;break}if(_(e,t,n)){ne(o),ie("resize"),oe({x:t,y:n,initialScale:e.scale,initialWidth:e.img.width}),a=!0;break}if(C(e,t,n)){ne(o),ie("move"),oe({x:t,y:n,initialX:e.x,initialY:e.y}),a=!0;break}}if(!a)for(let o=D.length-1;o>=0;o--){var l;const e=D[o],a=me(e),s=null===(l=m.current)||void 0===l?void 0:l[o];if(s){const{x:e,y:i}=s,l=D[o].scale||1,r=t-e,c=n-i;let d=.9;l<.5?d=3.5:l<.6?d=3:l<.7?d=2.4:l<.8?d=1.9:l<.93&&(d=1.6);if(Math.sqrt(r*r+c*c)/d<Math.max(20,.01*a*l))return L(e=>e.filter((e,t)=>t!==o)),void ee(null)}if(N(e,t,n,a)){ee(o),ie("rotate-text"),oe({x:t,y:n,centerX:e.x,centerY:e.y,initialAngle:e.rotation||0}),i=!0;break}if($(e,t,n,a)){ee(o),ne(null),ie("resize-text"),oe({x:t,y:n,initialScale:e.scale,initialWidth:a}),i=!0;break}if(A(e,t,n,a)){ee(o),ie("move-text"),oe({x:t,y:n,initialX:e.x,initialY:e.y}),i=!0;break}}a||i||(ne(null),ee(null),ie(null),oe(null))},onMouseMove:e=>{const{x:t,y:n}=he(e);let a="default",i=!1;for(let s=D.length-1;s>=0;s--){const e=D[s],l=me(e);if(N(e,t,n,l)){a="crosshair",i=!0;break}if($(e,t,n,l)){a="nwse-resize",i=!0;break}if(A(e,t,n,l)){a="grab",i=!0;break}}if(!i)for(let s=X.length-1;s>=0;s--){const e=X[s];if(I(e,t,n)){a="crosshair",i=!0;break}if(_(e,t,n)){a="nwse-resize",i=!0;break}if(C(e,t,n)){a="grab",i=!0;break}}if("move"!==ae||null===te&&null===Z||(a="grabbing"),re(a),!ae||!le)return;const l=t-le.x,o=n-le.y;null!==te&&O(e=>{const a=[...e],i={...a[te]};if("move"===ae)i.x=le.initialX+l,i.y=le.initialY+o;else if("resize"===ae){const e=le.initialWidth*le.initialScale+l,t=Math.max(.05,e/i.img.width);i.scale=t}else if("rotate"===ae){const e=Math.atan2(le.y-le.centerY,le.x-le.centerX),a=180*(Math.atan2(n-le.centerY,t-le.centerX)-e)/Math.PI;i.rotation=(le.initialAngle+a)%360}return a[te]=i,a}),null!==Z&&L(e=>{const a=[...e],i={...a[Z]};if("move-text"===ae)i.x=le.initialX+l,i.y=le.initialY+o;else if("resize-text"===ae){const e=le.initialWidth*le.initialScale+l,t=Math.max(.1,e/me(i));i.scale=t}else if("rotate-text"===ae){const e=Math.atan2(le.y-le.centerY,le.x-le.centerX),a=180*(Math.atan2(n-le.centerY,t-le.centerX)-e)/Math.PI;i.rotation=(le.initialAngle+a)%360}return a[Z]=i,a})},onMouseUp:()=>{ie(null),oe(null),re("default")},canvasElements:D,setCanvasElements:L,activeTextIndex:Z,photoBoothSettings:null!==(l=null===e||void 0===e||null===(r=e.wall)||void 0===r?void 0:r.PhotoBoothSettings)&&void 0!==l?l:{},selectedStickers:X,setActiveStickerIndex:ne,setActiveTextIndex:ee}):(0,o.jsx)(F,{rawImage:f,takePhoto:async(e,t)=>{if(!e)return void console.error("Failed to capture screenshot from webcam.");const n=new Image;n.crossOrigin="anonymous",n.src=e,n.onload=async()=>{t?v(n):b(n),de({width:n.width,height:n.height}),await(async e=>{const t=new i.SelfieSegmentation({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${e}`});t.setOptions({modelSelection:1}),t.onResults(e=>{R(e.segmentationMask)});const n=document.createElement("canvas");n.width=e.width,n.height=e.height,n.getContext("2d").drawImage(e,0,0,e.width,e.height);try{await t.send({image:n})}catch(a){console.error("Error sending image to MediaPipe:",a)}})(n)},n.onerror=()=>{console.error("Failed to load captured image.")}},canvasRef:c,canvasCursor:se,setRawImage:v,customisePhoto:()=>{v(null),B(null),Y(null),O([]),L([]),q(null),H(null),ee(null),ne(null),S(!0)}})})})]})})})}}}]);