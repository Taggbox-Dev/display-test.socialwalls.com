"use strict";(self.webpackChunkembed_widget=self.webpackChunkembed_widget||[]).push([[411,9430],{56214:(e,t,a)=>{a.r(t),a.d(t,{default:()=>D});var n=a(9950),o=a(22332),i=a(80415),l=a(44414);function s(e){let{uploadFile:t}=e;return(0,l.jsx)("div",{className:"pb_cards",children:(0,l.jsxs)("div",{className:"pb_cards_box",children:[(0,l.jsxs)("div",{onClick:()=>t(3),className:"pb_card",children:[(0,l.jsx)("div",{className:"pb_card_icon",children:(0,l.jsx)("img",{src:`${i.on}images/photobooth/camera.svg`,alt:"camera"})}),(0,l.jsx)("h3",{className:"pb_card-title",children:"Photobooth"}),(0,l.jsx)("p",{className:"pb_card-description",children:" Add fun stickers and backgrounds before sharing your masterpiece."})]}),(0,l.jsxs)("div",{onClick:()=>t(2),className:"pb_card",children:[(0,l.jsx)("div",{className:"pb_card_icon",children:(0,l.jsx)("img",{src:`${i.on}images/photobooth/snapup.svg`,alt:"snapup"})}),(0,l.jsx)("h3",{className:"pb_card-title",children:"Snap & Share"}),(0,l.jsx)("p",{className:"pb_card-description",children:"Upload your photos in one go without logging into your social media accounts."})]})]})})}const r=e=>{let{className:t,children:a,icon:n,onClick:o}=e;return(0,l.jsxs)("button",{className:t,onClick:o,children:[n&&(0,l.jsx)("img",{src:`${i.on}images/photobooth/${n}.svg`,alt:n}),a]})},c=320,d=320,u=[{id:"background",label:"Background"},{id:"frame",label:"Frames"},{id:"sticker",label:"Stickers"},{id:"text",label:"Text"}];var h=a(52867);const m=e=>{let{rawImage:t,cameraPermission:a,capturedImage:o,mode:s,counter:r,canvasRef:u,canvasCursor:m,webcamRef:g,onMouseDown:v,onMouseMove:p,onMouseUp:x,canvasElements:f,activeTextIndex:b,setCanvasElements:w,loading:y}=e;const[k,S]=(0,n.useState)("environment"),[M,_]=(0,n.useState)(Math.random()),j=(0,n.useRef)(null),I=(0,n.useMemo)(h.qs,[]),C=e=>e?e.split("\n").length:1,E=e=>{const t=e.target.value;if((null===t||void 0===t?void 0:t.length)<=35){const e=(e=>{if(!u.current||!f[b])return e;const t=f[b],a=document.createElement("canvas").getContext("2d"),n=t.fontSize||16,o=t.fontFamily||"Arial";a.font=`${n}px ${o}`;const i=e.split(/\s+/);let l="",s="";for(let r=0;r<i.length;r++){const e=i[r],t=l?l+" "+e:e,{width:n}=a.measureText(t);n>280&&l?(s+=l+"\n",l=e):l=t}return l&&(s+=l),s})(t);w(t=>t.map((t,a)=>a===b?{...t,text:e}:t))}},T=(0,n.useCallback)(e=>{if(!e||!e.text)return 0;const t=document.createElement("canvas").getContext("2d"),a=e.fontSize||16,n=e.fontFamily||"Arial",o=e.scale||1;t.font=`${a}px ${n}`;const i=e.text.split("\n");let l=0;for(const s of i){const e=t.measureText(s).width;e>l&&(l=e)}return l*o},[f]),N=(0,n.useCallback)(()=>{S(e=>"user"===e?"environment":"user"),_(Date.now())},[]);return(0,n.useEffect)(()=>("capture"!==s||o||(async()=>{try{j.current&&j.current.getTracks().forEach(e=>e.stop());const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:k}});j.current=e,g.current&&(g.current.srcObject=e,await g.current.play())}catch(e){console.error("Error starting camera:",e)}})(),()=>{j.current&&(j.current.getTracks().forEach(e=>e.stop()),j.current=null,g.current&&(g.current.srcObject=null))}),[k,s,o]),(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("div",{className:"pb_user_photo "+(y?"active_blur":""),style:{position:"relative",display:o||"granted"===a?"flex":"none"},children:["capture"!==s||o?o?(0,l.jsx)("canvas",{ref:u,style:{cursor:m},width:c,height:d,onMouseDown:v,onMouseMove:p,onMouseUp:x,onMouseLeave:x,onTouchStart:e=>{const t=e.type.startsWith("touch");e.preventDefault();const a=e.touches[0],n={clientX:a.clientX,clientY:a.clientY};v(n,t)},onTouchMove:e=>{e.preventDefault();const t=e.touches[0],a={clientX:t.clientX,clientY:t.clientY};p(a)},onTouchEnd:e=>{e.preventDefault(),x()}}):(0,l.jsx)("img",{src:`${i.on}images/photobooth/avatar.png?v=1.0.1`,alt:"default-avatar",width:c,height:d}):(0,l.jsx)("video",{ref:g,playsInline:!0,muted:!0,autoPlay:!0,style:{width:c,height:d,objectFit:"cover",borderRadius:"8px"}},`${M}-${k}`),null===f||void 0===f?void 0:f.map((e,t)=>b===t&&(0,l.jsx)("textarea",{id:`text-${t}`,name:`text-${t}`,value:e.text,onChange:E,wrap:"hard",style:{position:"absolute",top:e.y-(e.fontSize*e.scale*C(e.text)+10)/2+"px",left:e.x-T(e)/2-(I?3:0)+"px",width:`${T(e)}px`,height:e.fontSize*e.scale*C(e.text)+6+"px",fontSize:e.fontSize*e.scale+"px",fontFamily:e.fontFamily||"Arial",transform:`rotate(${e.rotation||0}deg)`,textAlign:e.align||"center",transformOrigin:"center center",background:e.backgroundColor||"transparent",color:e.color||"#000",overflow:"hidden",border:"none",outline:"none",padding:0,maxWidth:"300px",wordBreak:"break-word",whiteSpace:"pre-wrap",overflowWrap:"break-word",resize:"none"}},t)),I&&!o?(0,l.jsx)("button",{onClick:N,children:(0,l.jsx)("img",{src:`${i.on}images/photobooth/camera-flip.svg`,alt:"flip-camera"})}):null,r?(0,l.jsxs)("div",{className:"pb_viewframe",children:[(0,l.jsx)("img",{src:`${i.on}images/photobooth/viewframe-white@3x.svg`,alt:"viewframe"}),(0,l.jsx)("span",{children:r})]}):null]})})},g=n.memo(m),v=e=>{let{addSticker:t,loading:a,stickers:n,selectedStickers:o}=e;return(0,l.jsx)("div",{className:"pb_list_items pb_stickers",children:n.map((e,n)=>{const i=null===o||void 0===o?void 0:o.find(t=>(null===t||void 0===t?void 0:t.url)==e);return(0,l.jsx)("img",{onClick:a?null:()=>t(e),style:{cursor:a?"not-allowed":"pointer"},className:i?"active":"",src:`${e}?v=2.1`,alt:"sticker",width:64,height:64},n)})})},p=["font","align","color","bg"],x=["Arial","Helvetica","Times New Roman","Georgia","Courier New","Verdana","Tahoma","Trebuchet MS","Comic Sans MS","Impact","Lucida Console","Roboto","Open Sans"],f=["left","center","right"],b=["white","black","transparent"],w=e=>{let{canvasElements:t,setCanvasElements:a,activeTextIndex:n}=e;return(0,l.jsx)("div",{className:"pb_text",children:p.map(e=>{var o,s;return(0,l.jsxs)("div",{className:"pb_text_box",children:[(0,l.jsx)("img",{src:`${i.th}/media/images/photobooth/text/${e}.png?v=1`,alt:e,onClick:()=>(e=>{if(null!==n){const d={};if("align"===e){var o,i;const e=null!==(o=null===(i=t[n])||void 0===i?void 0:i.align)&&void 0!==o?o:"center",a=f.find(t=>t===e);d.align=f[(f.indexOf(a)+1)%f.length]}else if("bg"===e){var l,s;const e=null!==(l=null===(s=t[n])||void 0===s?void 0:s.backgroundColor)&&void 0!==l?l:"transparent",a=b.find(t=>t===e);d.backgroundColor=b[(b.indexOf(a)+1)%b.length]}else if("font"===e){var r,c;const e=null!==(r=null===(c=t[n])||void 0===c?void 0:c.fontFamily)&&void 0!==r?r:"Arial",a=x.find(t=>t===e);d.fontFamily=x[(x.indexOf(a)+1)%x.length]}a(e=>e.map((e,t)=>t===n?{...e,...d}:e))}})(e)}),(0,l.jsx)("p",{children:e}),"color"===e&&(0,l.jsx)("input",{type:"color",value:null!==(o=null===(s=t[n])||void 0===s?void 0:s.color)&&void 0!==o?o:"black",onChange:e=>{const t=e.target.value;a(e=>e.map((e,a)=>a===n?{...e,color:t}:e))}})]},e)})})},y=e=>{let{loading:t,imgUrl:a,imgList:n,setImgUrl:o,tabKey:s}=e;return(0,l.jsx)("div",{className:`pb_list_items pb_${s}`,children:[`${i.th}/media/images/photobooth/${s}/none.png`,...n].map((e,n)=>{const i=a?a===e:0===n;return(0,l.jsx)("img",{style:{cursor:t?"not-allowed":"pointer"},src:`${e}?v=2.1`,alt:`img-${n}`,className:i?"active":"",width:64,height:64,onClick:t?null:()=>o(0==n?null:e)},n)})})},k=e=>{let{capturedImage:t,uploadFile:a,canvasRef:o,canvasCursor:s,selectedBg:c,setSelectedBg:d,selectedFrame:m,setSelectedFrame:p,addSticker:x,addTextElement:f,onMouseDown:b,onMouseMove:k,onMouseUp:S,canvasElements:M,setCanvasElements:_,activeTextIndex:j,loading:I,selectedStickers:C,photoBoothSettings:E,setActiveStickerIndex:T,setActiveTextIndex:N,activeText:$}=e;const[A,P]=(0,n.useState)("background"),[R,F]=(0,n.useState)([]),[z,B]=(0,n.useState)([]),[D,L]=(0,n.useState)([]);return(0,n.useEffect)(()=>{"text"===A&&f(),"text"!==A?N(null):"sticker"!==A&&T(null)},[A]),(0,n.useEffect)(()=>{const e=(0,h.S3)((null===E||void 0===E?void 0:E.photo_booth_frames)||[]),t=(0,h.S3)((null===E||void 0===E?void 0:E.photo_booth_backgrounds)||[]),a=(0,h.S3)((null===E||void 0===E?void 0:E.photo_booth_stickers)||[]);B(null===e||void 0===e?void 0:e.map(e=>`${i.on}images/photobooth/frames/${e}`)),F(null===t||void 0===t?void 0:t.map(e=>`${i.on}images/photobooth/backgrounds/${e}`)),L(null===a||void 0===a?void 0:a.map(e=>`${i.on}images/photobooth/stickers/${e}`))},[]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"pb_customization",children:[(0,l.jsx)(g,{loading:I,capturedImage:t,canvasRef:o,canvasCursor:s,onMouseDown:b,onMouseMove:k,onMouseUp:S,canvasElements:M,activeTextIndex:j,setCanvasElements:_,activeText:$}),(0,l.jsxs)("div",{className:"pb_tabs",children:[(0,l.jsx)("div",{className:"pb_tabs_list",children:u.map(e=>(0,l.jsx)("button",{onClick:()=>P(e.id),className:A===e.id?"active":"",children:e.label},e.id))}),(0,l.jsx)("div",{className:"pb_tabs_content",children:(0,l.jsx)("div",{className:"pb_tabs_content_box",children:"background"===A?(0,l.jsx)(y,{loading:I,imgUrl:c,imgList:R,setImgUrl:d,tabKey:"backgrounds"}):"frame"===A?(0,l.jsx)(y,{imgUrl:m,imgList:z,setImgUrl:p,tabKey:"frames"}):"sticker"===A?(0,l.jsx)(v,{stickers:D,addSticker:x,loading:I,selectedStickers:C}):"text"===A?(0,l.jsx)(w,{canvasElements:M,setCanvasElements:_,activeTextIndex:j}):null})})]})]}),(0,l.jsx)("div",{className:"pb_continue_buttons_main",children:(0,l.jsx)(r,{className:"pb_continue_buttons",children:"Continue",onClick:()=>{if(null!==o&&void 0!==o&&o.current){const e=o.current;T(null),N(null),setTimeout(()=>{const t=e.toDataURL("image/png");t&&a(2,t)},100)}}})})]})};var S=a(66345);function M(e){const{snapType:t,uploadType:a,rawImage:n,capturedImage:o,wall:s,uploadImg:r,backAction:c}=e,d=1===t&&1===a||3===t&&!n&&!o;return(0,l.jsxs)("div",{className:"pb_header_bar",onClick:d?()=>window.location.href=`${S.EP}${s.Wall.id}?social-wall=true`:c,children:[(0,l.jsx)("img",{src:`${i.th}/media/images/photobooth/arrow-back.svg`,alt:"arrow-back"}),2==a&&r?(0,l.jsx)("img",{className:"pb_header_logo",src:s.PhotoBoothSettings.photo_booth_logo,height:20,width:130,alt:""}):(0,l.jsx)("span",{className:"header-title",children:d?"Back to Wall":"Back"})]})}const _=(e,t,a)=>{let n="blob"==t?((e,t)=>{try{const[a,n]=e.split(","),o=a.match(/:(.*?);/)[1],i=atob(n),l=i.length,s=new Uint8Array(l);for(let e=0;e<l;e++)s[e]=i.charCodeAt(e);return new File([s],t,{type:o})}catch(a){return console.error("Error converting base64 data to file:",a),null}})(e,"camera.png"):e;if(n){const e=URL.createObjectURL(n);e&&a&&a(e)}},j=(e,t,a)=>{const n=e.img.width*e.scale,o=e.img.height*e.scale,i=(e.rotation||0)*Math.PI/180,l=e.x+n/2,s=e.y+o/2,r=n/2,c=o/2,d=t-(l+(r*Math.cos(i)-c*Math.sin(i))),u=a-(s+(r*Math.sin(i)+c*Math.cos(i)));return Math.sqrt(d*d+u*u)<=$(15,7)/2},I=(e,t,a)=>{const n=e.img.width*e.scale,o=e.img.height*e.scale;return t>e.x&&t<e.x+n&&a>e.y&&a<e.y+o},C=(e,t,a)=>{const{img:n,scale:o,x:i,y:l,rotation:s=0}=e,r=n.width*o,c=n.height*o,d=i+r/2,u=l+c/2,h=r/2,m=-c/2-5,g=s*Math.PI/180,v=t-(d+h*Math.cos(g)-m*Math.sin(g)),p=a-(u+h*Math.sin(g)+m*Math.cos(g));return Math.sqrt(v*v+p*p)<=$(7,7)},E=(e,t,a,n)=>{const o=e.scale||1,i=e.fontSize||20,l=20*n,s=e.text.split("\n").length*i*o+20,r=e.x,c=e.y,d=(0,h.qs)()?o>0?20/o:20:0,u=t-r,m=a-c,g=(e.rotation||0)*Math.PI/180,v=Math.cos(-g),p=Math.sin(-g),x=(u*v-m*p)/o,f=(u*p+m*v)/o;return x>=-l/(2*o)&&x<=l/(2*o)&&f>=-s/(2*o)-d&&f<=s/(2*o)+d},T=(e,t,a,n)=>{var o;const i=e.scale||1,l=e.fontSize||20,s=(null===(o=e.text)||void 0===o?void 0:o.split("\n"))||[],r=1.2*l*Math.max(s.length,1)*i+20,c=n*i+20,d=$(16),u=e.x,h=e.y,m=c/2,g=r/2,v=(e.rotation||0)*Math.PI/180,p=t-(u+m*Math.cos(v)-g*Math.sin(v)),x=a-(h+m*Math.sin(v)+g*Math.cos(v));return p*p+x*x<(d/2)**2},N=(e,t,a,n)=>{var o;const i=e.scale||1,l=e.fontSize||20,s=$(16),r=e.x,c=e.y,d=(null===(o=e.text)||void 0===o?void 0:o.split("\n"))||[],u=(n*i+20)/2,h=-(1.2*l*Math.max(d.length,1)*i+20)/2,m=(e.rotation||0)*Math.PI/180,g=t-(r+u*Math.cos(m)-h*Math.sin(m)),v=a-(c+u*Math.sin(m)+h*Math.cos(m));return g*g+v*v<(s/2)**2},$=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,h.qs)()?2*e+t:e};var A=a(69522);const P=e=>{let{imageUrl:t,photoBtnRef:a,customiseImage:o}=e;const s=(0,n.useRef)(null),r=(0,n.useRef)(null),c=(0,n.useRef)(null),d=(0,n.useRef)(1),[u,h]=(0,n.useState)(!0),[m,g]=(0,n.useState)({width:200,height:200}),[v,p]=(0,n.useState)({x:0,y:0}),[x,f]=(0,n.useState)(1),b=320,w=320,y=(0,n.useCallback)(()=>{const e=r.current;if(!e)return console.error("Original image not loaded."),null;const t=e.naturalWidth/m.width,a=e.naturalHeight/m.height,n=-v.x/x*t,i=-v.y/x*a,l=b/x*t,s=w/x*a,c=document.createElement("canvas");c.width=b,c.height=w;c.getContext("2d").drawImage(e,n,i,l,s,0,0,b,w),c.toBlob(e=>{if(e){const t=new File([e],"capture.png",{type:"image/png"});o(t)}},"image/png")},[v,x,m,b,w]);(0,n.useEffect)(()=>{const e=new Image;e.crossOrigin="anonymous",e.onload=()=>{const t=e.width/e.height;let a=b,n=a/t;n>w&&(n=w,a=n*t),g({width:a,height:n}),p({x:(b-a)/2,y:(w-n)/2})},e.src=t},[t]);const k=m.width*x,S=m.height*x,M=e=>{const[t,a]=e,n=t.clientX-a.clientX,o=t.clientY-a.clientY;return Math.sqrt(n*n+o*o)},_=e=>{2===e.touches.length&&(c.current=M(e.touches),d.current=x)},j=e=>{if(2===e.touches.length){e.preventDefault();const t=M(e.touches),a=c.current,n=d.current;if(!a||!n)return;const o=t/a;let i=Math.max(1,n*o);f(i)}};return(0,n.useEffect)(()=>{const e=s.current;if(e)return e.addEventListener("touchstart",_,{passive:!1}),e.addEventListener("touchmove",j,{passive:!1}),()=>{e.removeEventListener("touchstart",_),e.removeEventListener("touchmove",j)}},[x]),(0,n.useEffect)(()=>{const e=setTimeout(()=>{h(!1)},2500);return()=>clearTimeout(e)},[]),(0,l.jsxs)("div",{ref:s,style:{width:b,height:w,border:"2px dashed #aaa",position:"relative",overflow:"hidden",margin:"0px auto 30px",background:"#f9f9f9",touchAction:"none",borderRadius:"8px"},onWheel:e=>{e.preventDefault();const t=e.deltaY<0?.05:-.05,a=Math.max(1,x+t);if(a<=1.01&&k<=b&&S<=w){f(1);const e=(b-m.width)/2,t=(w-m.height)/2;p({x:e,y:t})}else f(a)},children:[(0,l.jsx)(A.p,{size:{width:k,height:S},position:v,enableResizing:!1,disableDragging:!1,onDragStop:(e,t)=>{let a=t.x,n=t.y;const o=Math.max(0,k-b),i=Math.max(0,S-w);a=Math.min(Math.max(a,-o),0),n=Math.min(Math.max(n,-i),0),p({x:a,y:n})},style:{zIndex:2,pointerEvents:"auto"},children:(0,l.jsx)("img",{ref:r,src:t,alt:"Editable",style:{width:"100%",height:"100%",objectFit:"cover",userSelect:"none",pointerEvents:"none"}})}),(0,l.jsx)("button",{ref:a,style:{display:"none",position:"absolute",top:10,right:10,zIndex:400},onClick:y,children:"Capture"}),u?(0,l.jsxs)("div",{className:"pb_take_photo_crop",children:[(0,l.jsx)("img",{src:`${i.th}/media/images/photobooth/arrow-left.svg`,alt:"arrow-left",width:50,height:50}),(0,l.jsx)("img",{src:`${i.th}/media/images/photobooth/arrow-right.svg`,alt:"arrow-right",width:50,height:50})]}):null]})},R=e=>{var t;let{uploadType:a,rawImage:o,takePhoto:s,canvasRef:c,canvasCursor:d,setRawImage:u,customisePhoto:h}=e;const m=(0,n.useRef)(null),v=(0,n.useRef)(null),p=(0,n.useRef)(null),[x,f]=(0,n.useState)(null),[b,w]=(0,n.useState)("capture"),[y,k]=(0,n.useState)(0),[S,M]=(0,n.useState)(null),j=(0,n.useCallback)(async()=>{["Smile",3,2,1,0].forEach((e,t)=>{setTimeout(()=>f(e),1e3*t)})},[]),I=(0,n.useCallback)(()=>{w("capture"),u(null)},[]),C=(0,n.useCallback)(e=>{var t,a;const n=null===e||void 0===e||null===(t=e.target)||void 0===t||null===(a=t.files)||void 0===a?void 0:a[0];k(y+1),_(n,"file",e=>s(e,!0))},[y]),E=(0,n.useCallback)(async e=>{var t;w(e),"capture"===e&&await j(),"upload"===e&&null!==m&&void 0!==m&&m.current&&await(null===m||void 0===m||null===(t=m.current)||void 0===t?void 0:t.click())},[]);(0,n.useEffect)(async()=>{if(0==x&&null!==v&&void 0!==v&&v.current){f(null);const e=v.current,t=document.createElement("canvas"),{videoWidth:a,videoHeight:n}=e;t.width=a,t.height=n;t.getContext("2d").drawImage(e,0,0,a,n);const o=t.toDataURL("image/png",1);_(o,"blob",e=>s(e,!0))}},[x]);return(0,n.useEffect)(()=>{/Safari/i.test(navigator.userAgent)&&!/Chrome/i.test(navigator.userAgent)||(async()=>{try{const e=await navigator.mediaDevices.getUserMedia({video:!0});v.current&&(v.current.srcObject=e),M("granted")}catch(e){if(console.warn("Camera error:",e.name,e.message),navigator.permissions&&navigator.permissions.query)try{const e=await navigator.permissions.query({name:"camera"});return void M(e.state)}catch{console.log("Permissions API not supported (Safari likely)")}M("prompt")}})()},[]),(0,n.useEffect)(()=>{const e=async()=>{try{const e=await navigator.permissions.query({name:"camera"});e.state!==S&&M(e.state)}catch(e){console.warn("Permissions API not fully supported",e)}};return setInterval(e,2e3),()=>{clearInterval(e)}},[S]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"pb_user_photo_box",children:[o?(0,l.jsx)(P,{photoBtnRef:p,imageUrl:null!==(t=null===o||void 0===o?void 0:o.src)&&void 0!==t?t:"",customiseImage:e=>{_(e,"file",e=>s(e,!1)),setTimeout(h,100)}}):(0,l.jsxs)(l.Fragment,{children:[" ",(0,l.jsx)(g,{cameraPermission:S,mode:b,rawImage:o,canvasRef:c,canvasCursor:d,webcamRef:v,counter:x}),o?null:(0,l.jsxs)("div",{id:"camera-disabled-message",className:"pb-camera-disabled",style:{display:"granted"===S||o?"none":"flex"},children:[(0,l.jsx)("img",{src:`${i.on}images/photobooth/camera-disabled.svg`,alt:"camera-disabled"}),(0,l.jsxs)("p",{className:"pb_camera_disabled_text",children:["Please reload and allow camera",(0,l.jsx)("br",{}),"access when prompted."]}),(0,l.jsxs)("p",{className:"pb_camera_disabled_text_bottom",children:["In case this doesn't work, please",(0,l.jsx)("br",{}),"check the camera permissions in ",(0,l.jsx)("br",{}),"your browser settings."]})]})]}),o?(0,l.jsxs)("div",{className:"pb_take_photo",children:[(0,l.jsx)(r,{className:"pb_buttons_transparent",icon:"retake",children:"Try Again",onClick:I}),(0,l.jsx)(r,{className:"pb_buttons heighlight",children:"Looks Good!",onClick:()=>{var e;return null===p||void 0===p||null===(e=p.current)||void 0===e?void 0:e.click()}})]}):(0,l.jsxs)("div",{className:"pb_user_buttons",children:["granted"===S?(0,l.jsx)(r,{className:"pb_buttons heighlight",icon:"camera",children:"Strike a Pose",onClick:()=>E("capture")}):null,(0,l.jsx)(r,{className:"pb_buttons",icon:"upload",children:"Upload from Gallery",onClick:()=>E("upload")})]})]}),(0,l.jsx)("input",{ref:m,type:"file",accept:"image/*",style:{display:"none"},onChange:C},y)]})};var F=a(48768);let z,B=!1;const D=e=>{var t,a,i,r;const u=(0,n.useRef)(null),m=(0,n.useRef)({}),g=(0,n.useRef)({}),[v,p]=(0,n.useState)(!1),[x,f]=(0,n.useState)(null),[b,w]=(0,n.useState)(null),[y,S]=(0,n.useState)(!1),[_,$]=(0,n.useState)(0),[A,P]=(0,n.useState)(null),[D,L]=(0,n.useState)(null),[U,Y]=(0,n.useState)(null),[O,X]=(0,n.useState)([]),[W,q]=(0,n.useState)([]),[G,H]=(0,n.useState)(null),[K,V]=(0,n.useState)(null),[J,Q]=(0,n.useState)(null),[Z,ee]=(0,n.useState)(null===e||void 0===e?void 0:e.snapType),[te,ae]=(0,n.useState)(null),[ne,oe]=(0,n.useState)(null),[ie,le]=(0,n.useState)(null),[se,re]=(0,n.useState)(null),[ce,de]=(0,n.useState)(null),[ue,he]=(0,n.useState)("default"),[me,ge]=(0,n.useState)({width:c,height:d}),ve=(0,n.useMemo)(h.qs,[]),pe=e=>{p(e)},xe=e=>{const t=u.current,a=t.getBoundingClientRect();return{x:(e.clientX-a.left)*(t.width/a.width),y:(e.clientY-a.top)*(t.height/a.height)}},fe=e=>{const t=null===u||void 0===u?void 0:u.current;if(!t||null===e||void 0===e||!e.text)return 0;const a=t.getContext("2d");if(!a)return 0;a.save(),a.font=`${e.fontSize||20}px ${e.fontFamily||"Arial"}`;const n=e.text.split("\n"),o=Math.max(...n.map(e=>a.measureText(e).width));return a.restore(),o};(0,n.useEffect)(()=>{if(!b||!A)return;const e=u.current;if(!e)return;const t=e.getContext("2d"),a=me.width,n=me.height;e.width=a,e.height=n;const o=document.createElement("canvas");o.width=a,o.height=n;const i=o.getContext("2d");if(i.clearRect(0,0,a,n),G&&U){const e=document.createElement("canvas");e.width=a,e.height=n;const t=e.getContext("2d");t.drawImage(b,0,0,a,n),t.globalCompositeOperation="destination-in",t.drawImage(A,0,0,a,n),t.globalCompositeOperation="source-over",i.drawImage(U,0,0,a,n),i.drawImage(e,0,0,a,n)}else i.drawImage(b,0,0,a,n);i.globalCompositeOperation="source-over",D&&i.drawImage(D,0,0,a,n),O.forEach((e,t)=>{const a=e.img.width*e.scale,n=e.img.height*e.scale,o=e.x+a/2,l=e.y+n/2;if(i.save(),i.translate(o,l),i.rotate((e.rotation||0)*Math.PI/180),i.drawImage(e.img,-a/2,-n/2,a,n),t===ie){i.strokeStyle="#2b2b2b",i.lineWidth=2,i.setLineDash([5,3]),i.strokeRect(-a/2,-n/2,a,n),i.setLineDash([]);const s=10,r="\u2921",c=a/2,d=n/2;i.fillStyle="#000",i.beginPath(),i.arc(c,d,s,0,2*Math.PI),i.fill(),i.fillStyle="white",i.font="bold 16px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText(r,c,d);const u=a/2,h=-n/2,g=10;i.beginPath(),i.fillStyle="#000",i.arc(u,h,g,0,2*Math.PI),i.fill(),i.fillStyle="#fff",i.font="bold 16px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("\u27f3",u,h);const v=22,p=-a/2-v/2+5,x=-n/2-v/2+8;m.current[t]={x:o+p*Math.cos(e.rotation*Math.PI/180)-x*Math.sin(e.rotation*Math.PI/180),y:l+p*Math.sin(e.rotation*Math.PI/180)+x*Math.cos(e.rotation*Math.PI/180),size:v},i.beginPath(),i.arc(p+5,x+5,10,0,2*Math.PI),i.fillStyle="black",i.fill(),i.fillStyle="#fff",i.font="bold 9px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("\u2715",p+5,x+5)}i.restore()}),W.forEach((e,t)=>{var a;i.save(),i.translate(e.x,e.y),i.rotate(e.rotation*Math.PI/180),i.scale(e.scale,e.scale),i.font=`${e.fontSize}px ${e.fontFamily||"Arial"}`,i.textAlign=e.align||"center",i.textBaseline="middle";const n=(null===(a=e.text)||void 0===a?void 0:a.split("\n"))||[""],o=Math.max(...n.map(e=>i.measureText(e).width)),l=n.length,s=e.fontSize*e.scale,r=o+20,c=s*l+10,d=1.2*s,u=o+20,h=s*n.length+30,m=-u/2;if(e.backgroundColor&&(i.fillStyle=e.backgroundColor,i.fillRect(m,-h/2,u,h)),t!==ne&&(i.fillStyle=e.color||"#000000",n.forEach((e,t)=>{let a=0;"center"==i.textAlign?a=0:"left"==i.textAlign?a=-u/2+10:"right"==i.textAlign&&(a=u/2-10),i.fillText(e,a,t*d-(n.length-1)*d/2)})),t===ne){i.strokeStyle="#2b2b2b",i.lineWidth=2,i.setLineDash([5,3]),i.strokeRect(m,-h/2,u,h),i.setLineDash([]);const a=22,n=(e.rotation||0)*Math.PI/180,o=-r/2-a/2,l=-c/2-a/2,s=e.x+o*Math.cos(n)-l*Math.sin(n),d=e.y+o*Math.sin(n)+l*Math.cos(n);g.current[t]={x:s,y:d,size:Math.max(ve?15:10,a*e.scale)},i.fillStyle="black",i.beginPath(),i.arc(m,-h/2,14,0,2*Math.PI),i.fill(),i.fillStyle="#fff",i.font="bold 14px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("\u2715",m,-h/2),i.fillStyle="black",i.beginPath(),i.arc(m+u,-h/2,14,0,2*Math.PI),i.fill(),i.fillStyle="white",i.font="bold 18px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("\u27f3",m+u,-h/2),i.fillStyle="black",i.beginPath(),i.arc(m+u,h/2,14,0,2*Math.PI),i.fill(),i.fillStyle="white",i.font="bold 20px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("\u2921",m+u,h/2)}i.restore()}),t.clearRect(0,0,a,n),t.drawImage(o,0,0)},[b,A,D,O,ie,W,ne,B,U,y,me,Z]),(0,n.useEffect)(()=>{if(!G)return void Y(null);const e=new Image;e.crossOrigin="anonymous",e.src=`https://cdn.taggbox.com/v7/${G}?v=2.1`,pe(!0),e.onload=()=>{Y(e),pe(!1)},e.onerror=()=>{console.error(`Failed to load background image: ${G}`),pe(!1)}},[G]),(0,n.useEffect)(()=>{if(!K)return void L(null);const e=new Image;e.crossOrigin="anonymous",e.src=`https://cdn.taggbox.com/v7/${K}?v=2.1`,pe(!0),e.onload=()=>{L(e),pe(!1)},e.onerror=()=>{console.error(`Failed to load frame image: ${K}`),pe(!1)}},[K]),(0,n.useEffect)(()=>{let e=0,t=!1;const a=[".pb_tabs_content_box"],n=n=>{e=n.touches[0].clientY;const o=n.target.closest(a.join(","));t=!!o},o=a=>{if(t)return;const n=document.documentElement.scrollTop||document.body.scrollTop,o=a.touches[0].clientY-e;0===n&&o>0&&a.preventDefault()};return document.addEventListener("touchstart",n,{passive:!1}),document.addEventListener("touchmove",o,{passive:!1}),()=>{document.removeEventListener("touchstart",n),document.removeEventListener("touchmove",o)}},[]);const be=(e,t)=>{ee(e),Q(t),$(0)};return(0,l.jsx)("div",{className:"pb_photo_booth_main",children:(0,l.jsx)("div",{className:"pb_photo_booth_box",children:(0,l.jsxs)("div",{className:"pb_photo_booth_box_inner",children:[(0,l.jsx)(M,{snapType:e.snapType,rawImage:x,capturedImage:b,uploadImg:J,uploadType:Z,wall:null===e||void 0===e?void 0:e.wall,backAction:()=>{y?(f(b),J&&!_?(S(!0),$(1),ee(3),f(0)):(S(!1),$(0))):(S(!1),f(null),ee(x?J&&2===Z?3:Z:null===e||void 0===e?void 0:e.snapType))}}),(0,l.jsx)("div",{className:"pb_photo_booth_h "+(2===Z?"pb_photo_booth_h_review":""),children:1==Z?(0,l.jsx)(s,{uploadFile:be}):(0,l.jsx)(l.Fragment,{children:2===Z?(0,l.jsx)(F.default,{isPhotoBooth:J,photoBoothInterface:1,wall:null===e||void 0===e?void 0:e.wall,wallId:null===e||void 0===e||null===(t=e.wall)||void 0===t||null===(a=t.Wall)||void 0===a?void 0:a.id,feeds:null===e||void 0===e?void 0:e.feeds,isFreeAdsStatus:null===e||void 0===e?void 0:e.isFreeAdsStatus}):y?(0,l.jsx)(k,{loading:v,capturedImage:b,uploadFile:be,canvasRef:u,canvasCursor:ue,selectedBg:G,setSelectedBg:H,selectedFrame:K,setSelectedFrame:V,addSticker:e=>{const t=new Image;t.crossOrigin="anonymous",pe(!0),t.src=`https://cdn.taggbox.com/v7/${e}?v=2.1`,t.onload=()=>{pe(!1);const a=me.width,n=me.height,o=t.height/t.width*100,i=100/t.width;oe(null),X(l=>{const s=[...l,{img:t,x:a/2-50,y:n/2-o/2,scale:i,url:e,rotation:0}];return le(s.length-1),s})},t.onerror=()=>{pe(!1),console.error(`Failed to load sticker image: ${e}`)}},addTextElement:()=>{const e={text:"Your Text Here",x:me.width/2,y:me.height/2,scale:1,rotation:0,fontSize:28,fontFamily:"Georgia",color:"#000000",backgroundColor:"white",align:"center"};le(null),q(t=>{const a=[...t,e];return oe(a.length-1),a})},onMouseDown:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{x:a,y:n}=xe(e);let o=!1,i=!1;for(let r=O.length-1;r>=0;r--){const e=O[r],t=m.current[r];if(t){const{x:e,y:o,size:i}=t,l=a-e,s=n-o;if(Math.sqrt(l*l+s*s)<i/2)return X(e=>e.filter((e,t)=>t!==r)),void le(null)}if(C(e,a,n)){le(r),re("rotate"),de({x:a,y:n,centerX:e.x+e.img.width*e.scale/2,centerY:e.y+e.img.height*e.scale/2,initialAngle:e.rotation||0}),o=!0;break}if(j(e,a,n)){le(r),re("resize"),de({x:a,y:n,initialScale:e.scale,initialWidth:e.img.width}),o=!0;break}if(I(e,a,n)){le(r),re("move"),de({x:a,y:n,initialX:e.x,initialY:e.y}),o=!0;break}}if(!o)for(let r=W.length-1;r>=0;r--){var l;B=!ve;const e=W[r],o=fe(e),c=null===(l=g.current)||void 0===l?void 0:l[r];if(c){const{x:e,y:t}=c,i=W[r].scale||1,l=a-e,s=n-t;let d=.9;i<.5?d=3.5:i<.6?d=3:i<.7?d=2.4:i<.8?d=1.9:i<.93&&(d=1.6);if(Math.sqrt(l*l+s*s)/d<Math.max(20,.01*o*i))return q(e=>e.filter((e,t)=>t!==r)),oe(null),void ae(null)}if(N(e,a,n,o)){oe(r),ae(null),re("rotate-text"),de({x:a,y:n,centerX:e.x,centerY:e.y,initialAngle:e.rotation||0}),i=!0;break}if(T(e,a,n,o)){ae(null),oe(r),le(null),re("resize-text"),de({x:a,y:n,initialScale:e.scale,initialWidth:o}),i=!0;break}if(E(e,a,n,o)){var s;ae({index:r,count:ne==r?(null===te||void 0===te?void 0:te.count)>=2?2:(null!==(s=null===te||void 0===te?void 0:te.count)&&void 0!==s?s:0)+1:1}),oe(r),t&&(z=setTimeout(()=>{B=!0},300)),re("move-text"),de({x:a,y:n,initialX:e.x,initialY:e.y}),i=!0;break}}o||i||(le(null),oe(null),re(null),de(null),ae(null))},onMouseMove:e=>{const{x:t,y:a}=xe(e);let n="default",o=!1;for(let s=W.length-1;s>=0;s--){const e=W[s],i=fe(e);if(N(e,t,a,i)){n="crosshair",o=!0;break}if(T(e,t,a,i)){n="nwse-resize",o=!0;break}if(E(e,t,a,i)){n="grab",o=!0;break}}if(!o)for(let s=O.length-1;s>=0;s--){const e=O[s];if(C(e,t,a)){n="crosshair",o=!0;break}if(j(e,t,a)){n="nwse-resize",o=!0;break}if(I(e,t,a)){n="grab",o=!0;break}}if("move"!==se||null===ie&&null===ne||(n="grabbing"),he(n),!se||!ce)return;const i=t-ce.x,l=a-ce.y;null!==ie&&X(e=>{const n=[...e],o={...n[ie]};if("move"===se)o.x=ce.initialX+i,o.y=ce.initialY+l;else if("resize"===se){const e=ce.initialWidth*ce.initialScale+i,t=Math.max(.05,e/o.img.width);o.scale=t}else if("rotate"===se){const e=Math.atan2(ce.y-ce.centerY,ce.x-ce.centerX),n=180*(Math.atan2(a-ce.centerY,t-ce.centerX)-e)/Math.PI;o.rotation=(ce.initialAngle+n)%360}return n[ie]=o,n}),null!==ne&&q(e=>{const n=[...e],o={...n[ne]};if(B=!1,z&&clearTimeout(z),"move-text"===se)o.x=ce.initialX+i,o.y=ce.initialY+l;else if("resize-text"===se){const e=ce.initialWidth*ce.initialScale+i,t=Math.max(.1,e/fe(o));o.scale=t}else if("rotate-text"===se){const e=Math.atan2(ce.y-ce.centerY,ce.x-ce.centerX),n=180*(Math.atan2(a-ce.centerY,t-ce.centerX)-e)/Math.PI;o.rotation=(ce.initialAngle+n)%360}return n[ne]=o,n})},onMouseUp:()=>{z&&clearTimeout(z),re(null),de(null),he("default")},canvasElements:W,setCanvasElements:q,activeTextIndex:ne,photoBoothSettings:null!==(i=null===e||void 0===e||null===(r=e.wall)||void 0===r?void 0:r.PhotoBoothSettings)&&void 0!==i?i:{},selectedStickers:O,setActiveStickerIndex:le,setActiveTextIndex:oe,activeText:te}):(0,l.jsx)(R,{uploadType:Z,rawImage:x,takePhoto:async(e,t)=>{if(!e)return void console.error("Failed to capture screenshot from webcam.");const a=new Image;a.crossOrigin="anonymous",a.src=e,a.onload=async()=>{t?f(a):w(a),ge({width:a.width,height:a.height}),await(async e=>{const t=new o.SelfieSegmentation({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${e}`});t.setOptions({modelSelection:1}),t.onResults(e=>{P(e.segmentationMask)});const a=document.createElement("canvas");a.width=e.width,a.height=e.height,a.getContext("2d").drawImage(e,0,0,e.width,e.height);try{await t.send({image:a})}catch(n){console.error("Error sending image to MediaPipe:",n)}})(a)},a.onerror=()=>{console.error("Failed to load captured image.")}},canvasRef:u,canvasCursor:ue,setRawImage:f,customisePhoto:()=>{f(null),L(null),Y(null),X([]),q([]),H(null),V(null),oe(null),le(null),S(!0)}})})})]})})})}}}]);